(function(t,y){var r=t.document;var a=t.encodeURIComponent;var c=t.navigator;var n=t.parseInt;var m=t.performance;var i=t.window;var d=t.Date;var x=t.Error;var p=t.XMLHttpRequest;var e=[];var j=[];function q(B,A,C,z){B.addEventListener?B.addEventListener(A,C,!!z):B.attachEvent&&B.attachEvent("on"+A,C,!!z)}function b(A,z){return(typeof A==="string")&&(A.length>z)?[A.slice(0,z/2),"...",A.length-z,"...",A.slice(-z/2)].join(""):A}function k(D,B){var E=[];for(var C in D){if(!D.hasOwnProperty(C)){continue}var A=B?(B+"["+C+"]"):C,z=D[C];E.push(typeof z=="object"?k(z,A):a(A)+"="+a(z))}return E.join("&")}var o=(function(z){return(z&&z.keys)||function(D){var A=[];var C=z.prototype.hasOwnProperty;for(var B in D){C.call(D,B)&&A.push(B)}return A}})(t.Object);var s=(function(z){return(z&&z.stringify&&function(B){try{return z.stringify(B)}catch(A){v(A);return'"FAILED_JSON_STRINGIFY"'}})||function(){return'"NO_JSON_STRINGIFY"'}})(t.JSON);var f=(function(z){return(z&&z.Features)||(function(){v(new x("Missing Tumblr.Features in exceptions.js"));var A={enable_js_errors_log:true,enable_js_ephemeral_log:true};function B(C,D){return(typeof C==="function")?C.call(this,D):C}return function(D){var C=!!(A[D]);return function E(G,H){var F=B.call(this,(C?G:H),C);return(F!==void 0)?F:E}}})()})(t.Tumblr);function v(z){if(z instanceof x){z.url||(z.url="//www.tumblr.com/");g(z.message,z.url,z.ln,z.col,z)}else{e.push(s(z))}}function g(D,A,C,z,B){try{j.push({path:(r.location||{}).pathname||"NO_LOCATION_OR_PATHNAME",msg:b(D,200)||"",url:b(A,300)||"",ln:n(C,10)||-1,col:n(z,10)||-1,err:s(b(B&&B.stack,1000)||"")})}catch(B){}}function l(C){var B=r.getElementsByTagName("script");var A=[];for(var D=0,z=B.length;D<z;D++){A.push(B[D].src)}return s({name:C,timestamp:+new d(),path:(r.location||{}).href||"NO_HREF",lang:(c||{}).userLanguage||(c||{}).language||"NO_LANG",referrer:r.referrer||"NO_REFERRER",ua:(c||{}).userAgent||"NO_UA",timing:(m||{}).timing||"NO_TIMING",scripts:A,ephemeral:e,errors:j,document:(r.documentElement||{}).innerHTML||"NO_DOCUMENT",cookie:r.cookie,globals:o(t)})}function h(){try{(i.onerror===g)||v(new x("window.onerror from exceptions.js was overridden"));var z;f("enable_js_errors_log")(function(){j.length&&((z||(z={})).errors=j)});f("enable_js_ephemeral_log")(function(){e.length&&((z||(z={})).ephemeral=e)});f("js_debugger_1")(function(){(z||(z={})).ephemeral=[l("js_debugger_1")]});f("js_debugger_2")(function(){(z||(z={})).ephemeral=[l("js_debugger_2")]});if(!z){return}var B=new p();B.open("POST","/svc/log/capture/exceptions",false);B.setRequestHeader("Content-type","application/x-www-form-urlencoded");B.onreadystatechange=function(){if(B.readyState!==4){return}j.length=e.length=0};B.send(k({form_key:(r.getElementById("tumblr_form_key")||r.body).getAttribute("content"),log:z}))}catch(A){if(!t.jQuery){return}v(A);(z||(z={})).errors||(z.errors=j);t.jQuery.ajax({async:false,type:"POST",data:{form_key:t.jQuery("#tumblr_form_key").attr("content"),log:z},url:"/svc/log/capture/exceptions",with_form_key:true})}}function w(){var A=("console" in t&&console.log)?function A(){console.log("Do not call this function - trapped by Blackhole.")}:function A(){};(function z(){if(!t.Ajax){t.Ajax={}}if(!t.Ajax.Responders){t.Ajax.Responders={}}if(!t.Ajax.Responders.register){t.Ajax.Responders.register=A}})()}(function u(){q(i,"beforeunload",h);w();i.onerror=g})();(y.Utils||(y.Utils={})).exceptions=v})(this,this.Tumblr||(this.Tumblr={}));
var video_thumbnail_hover=false;function load_typekit(){if(typeof Typekit!="undefined"){return}TypekitConfig={kitId:"dzi2tiv"};(function(){var a=document.createElement("script");a.src="//use.typekit.com/"+TypekitConfig.kitId+".js";a.type="text/javascript";a.async="true";a.onload=a.onreadystatechange=function(){var c=this.readyState;if(c&&c!="complete"&&c!="loaded"){return}try{Typekit.load(TypekitConfig)}catch(d){}};var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}function select_field(a){var b=document.getElementsById(a);if(b.createTextRange){var c=b.createTextRange();c.moveStart("character",0);c.moveEnd("character",b.value.length);c.select()}else{if(b.setSelectionRange){b.setSelectionRange(0,b.value.length)}}}function get_cookie(d){var b=document.cookie;var g,f=b.split(";");var e,a=f.length;for(e=0;e<a;e+=1){if((g=f[e].replace(/^\s+|\s+$/g,"").split("="))[0]==d){return{name:g[0],value:g[1]}}}return false}function set_cookie(a,f,h,c){c=c||{};var b=new Date();var g=(typeof(c.path)!=="undefined")?c.path:"/";var e=(typeof(c.is_secure)!=="undefined")?true:false;var d=(typeof(c.domain)!=="undefined")?c.domain:"";b.setDate(b.getDate()+h);document.cookie=a+"="+escape(f)+((h==null)?"":";expires="+b.toGMTString())+";path="+g+((e===false)?"":";secure")+((d==="")?"":";domain="+d)}function unset_cookie(a){set_cookie(a,"",-1)}var trackable_follow=function(c,g,f,b,a,d,e){b=b||function(){};a=a||function(){};d=d||function(){};e=e||function(){};Tumblr.follow({tumblelog:f},{init:b,success:a,error:d,complete:e})};function toggle_video_embed(a){var b=jQuery;if(!b("#watch_video_"+a).is(":visible")){b("#video_embed_"+a).html(b("#video_code_"+a).val());b("#video_toggle_"+a).hide();b("#watch_video_"+a).show();if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","click","normal"])}}else{b("#video_embed_"+a).html("");b("#video_toggle_"+a).show();b("#watch_video_"+a).hide();if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","hide","normal"])}}}function cycle_video_thumbnails(b,c){var a=jQuery("#video_thumbnail_"+b);if(!a.attr("thumbnails")){return false}var d=a.attr("thumbnails").split("   |   ");if(!d.length){return false}if(c=="preload"){for(i=0;i<d.length;i++){add_to_image_queue(false,d[i])}}else{if(c=="start"){a.attr("original_src",a.src);a.attr("thumbnail_index",1);a.attr("src",d[1]);video_thumbnail_hover=window.setInterval(function(){index=parseInt(a.attr("thumbnail_index"),10)+1;if(index==d.length){index=0}a.attr("src",d[index]);a.attr("thumbnail_index",index)},500)}else{if(c=="stop"){window.clearInterval(video_thumbnail_hover);a.attr("src",a.attr("original_src"));a.removeAttr("thumbnail_index");a.removeAttr("original_src")}}}};
(function(a,b){a.$window=b(a);a.$document=b(document);b(function(){a.$body=b("body")})}).call(window,window,jQuery);
Tumblr.Utils||(Tumblr.Utils={});(function(e){var d=(function(){var g=document.documentElement.style;var h=[];for(var i in g){if(typeof g[i]==="string"){h.push(i)}}return h.join(" ")})();var b=function(g){return new RegExp("\\b((webkit|moz|ms|o|)"+g.toLowerCase()+")\\b","i")};var a={};function f(h){if(a[h]===void 0){if(b(h).test(d)){var g=RegExp.$1;a[h]={js:g,css:(g[0]+g.slice(1).replace(/[A-Z]/g,"-$&")).toLowerCase()}}else{a[h]=false}}return a[h]}f.style=function c(j,i,l){var h,g;if(l){h={};h[i]=l}else{h=i}if(j.jquery){j=j[0]}for(var k in h){g=h[k];j.style[f(k).js]=g}return j};e.prefixer=f})(Tumblr.Utils);
if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),d=this,b=function(){},c=function(){return d.apply(this instanceof b&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;c.prototype=new b();return c}};
(function(a){function c(f,k,l){if(Array.prototype.indexOf){return f.indexOf(k,l)}for(var h=(l||0),g=f.length;h<g;h++){if(f[h]===k){return h}}return -1}function b(g,f){var i=[];if(!g){return i}for(var h in g){if(g.hasOwnProperty(h)){i.push(h)}}if(f&&f.length){return i.sort(function(k,j){return c(f,k)-c(f,j)})}return i}function e(){var f=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f())}var d=function(f){if(!(this instanceof d)){return new d(f)}if(!f){f={}}if(typeof f==="string"){f={id:f}}this.el=d.create_stylesheet(f.id||e());if(f.media_query){this.set_media_query(f.media_query)}this.selectors={};this.selectors_order=[];if(f.styles){this.import_styles(f.styles)}this.attach();d.register(this);return this};d.prototype={add_px:function(f){if(typeof f==="string"&&f.match(/\D/)){return f}return f+"px"},add_px_value:function(g,f){switch(g){case"top":case"right":case"bottom":case"left":case"width":case"height":return this.add_px(f);default:return f}},import_styles:function(g){for(var f in g){this.set(f,g[f])}},set_media_query:function(f){this.el.media=f||""},set:function(f,i,h,j){if(typeof this.selectors[f]==="undefined"){this.selectors[f]={properties:{},properties_order:[]};this.selectors_order.push(f)}f=this.selectors[f];if(typeof i==="object"){var g=i;j=h;for(i in g){if(typeof f.properties[i]==="undefined"){f.properties_order.push(i)}h=g[i];f.properties[i]=this.add_px_value(i,h)}}else{if(typeof f.properties[i]==="undefined"){f.properties_order.push(i)}f.properties[i]=this.add_px_value(i,h)}if(typeof j==="undefined"){j=true}if(j){this.update()}},get:function(f,g){f=this.selectors[f];if(typeof f==="undefined"){return false}if(!g){return f}g=f.properties[g];if(typeof g==="undefined"){return false}return g},has:function(f,g){f=this.selectors[f];if(typeof f==="undefined"){return false}if(!g){return true}g=f[g];if(typeof g==="undefined"){return false}return(typeof g!=="undefined")&&g!==""},set_selectors_order:function(f){this.selectors_order=b(this.selectors,f);this.update();return true},set_properties_order:function(f,g){if(!f){for(f in this.selectors){if(!this.selectors.hasOwnProperty(f)){continue}f=this.selectors[f];f.properties_order=b(f.properties,g||d.default_properties_order)}this.update();return true}f=this.get(f);if(!f){return false}f.properties_order=b(f.properties,g||d.default_properties_order);this.update();return true},attach:function(){var f=document.getElementsByTagName("head")[0];if(!f){return false}this.update();f.appendChild(this.el);return true},detach:function(){var f=document.getElementsByTagName("head")[0];if(!f){return false}if(this.el.parentNode!==f){return false}this.el.parentNode.removeChild(this.el);return true},update:function(){var f=this.selector_to_text(this.selectors,this.selectors_order).replace(/</g,"&lt;").replace(/>/g,"&gt;");if(this.el.styleSheet){this.el.styleSheet.cssText="\n"+f}else{this.el.innerHTML="\n"+f}},selector_to_text:function(j,g){g||(g=b(j));var f;var k="";for(var h=0;h<g.length;h++){f=g[h];if(!(j.hasOwnProperty(f)&&j[f])){continue}k+=f+" {\n";k+=this.properties_to_text(j[f].properties,j[f].properties_order);k+="}\n"}return k},properties_to_text:function(h,f){f||(f=b(h));var k="";var j;for(var g=0;g<f.length;g++){j=f[g];if(!(h.hasOwnProperty(j)&&h[j]!=="")){continue}k+=j+": "+h[j]+";\n"}return k},toString:function(){return this.selector_to_text(this.selectors,this.selectors_order).replace(/</g,"&lt;").replace(/>/g,"&gt;")}};d.instances=[];d.default_properties_order=["font","font-family","font-size","font-style","font-variant","font-weight","@font-face","font-size-adjust","font-stretch","padding","padding-top","padding-right","padding-bottom","padding-left","margin","margin-top","margin-right","margin-bottom","margin-left","border","border-top","border-top-color","border-top-style","border-top-width","border-right","border-right-color","border-right-style","border-right-width","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","background","background-color","background-position","background-size","background-repeat","background-origin","background-clip","background-attachment","background-image","overflow","overflow-x","overflow-y","transition","transition-property","transition-duration","transition-timing-function","transition-delay","transform","transform-origin","transform-style"];d.create_stylesheet=function(g){var f=document.createElement("style");f.type="text/css";if(g){f.id=g}return f};d.register=function(f){this.instances.push(f)};a.Styler=d})(this.Tumblr||(this.Tumblr={}));
("Tumblr" in window)||(window.Tumblr={});Tumblr.FollowTeaser=(function(){var h=false,o=false,n=false,a=false,l={},c=310,p=110,i=false,b=new Tumblr.Styler({id:"tumblr_teaser_follow_css",styles:{"#tumblr_teaser_follow":{display:"block",opacity:"1",visibility:"hidden",position:"fixed",bottom:"0",right:"0",width:"1px",height:"1px","z-index":"2147483647"},"#tumblr_teaser_follow.open":{visibility:"visible",width:c+"px",height:p+"px"}}});function q(w,t){var x=[];for(var u in w){var s=t?t+"["+u+"]":u,r=w[u];x.push(typeof r=="object"?q(r,s):encodeURIComponent(s)+"="+encodeURIComponent(r))}return x.join("&")}var g=0;var e=9000;var d=200;var f=false;function j(){if(f){return}var s=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0;if((s>e||(Tumblr.FollowTeaser.current_page>=2&&s>500))&&Tumblr.FollowTeaser.can_show()){Tumblr.FollowTeaser.scroll_listener(false);return}if(Tumblr.FollowTeaser.infer_infinite_scroll){var r=document.body.clientHeight;if(r>g+100){Tumblr.FollowTeaser.current_page++;g=r}}f=true;setTimeout(function(){f=false},d)}var m;function k(){if(f){return}clearTimeout(m);m=setTimeout(j,300);f=true;setTimeout(function(){f=false},d)}return{infer_infinite_scroll:false,current_page:1,can_show:function(){n=true;var r=this.open(c,p);if(h){h.contentWindow.postMessage("follow_teaser;show","*")}return r},create_from_tumblr_controls:function(r){if(!(o=document.getElementById("tumblr_controls"))){return false}if(!(url_matches=o.src.match(/([^\?#]+\/)([^\/\?\#]\.html)?(\?_v=[^\&#]+)?([^#]*)(.*)?/i))){return false}this.initialize({url:(r||(url_matches[1]+"follow.html"))+url_matches[4]+url_matches[5]})},create_iframe:function(r){var s=document.createElement("iframe");s.id="tumblr_teaser_follow";s.width=1;s.height=1;s.frameBorder=0;s.scrolling="no";s.src=r;document.body.appendChild(s);return s},scroll_listener:function(r){if(r){if(window.addEventListener){window.addEventListener("scroll",k)}else{if(window.attachEvent){window.attachEvent("onscroll",k)}}}else{if(window.removeEventListener){window.removeEventListener("scroll",k)}else{if(window.detachEvent){window.detachEvent("onscroll",k)}}}},initialize:function(t){if(!Tumblr.PostMessageListener){return false}if(!t){t={}}g=document.body.clientHeight;e=Math.min(e,3*Tumblr.windowDimensions().height);var r=this;Tumblr.PostMessageListener.initialize(function(x,w){r.post_message_event(x,w)});h=document.getElementById("tumblr_teaser_tagged");o=document.getElementById("tumblr_controls");if(!h){var u=t.query||{};var s=t.url||"http://www.tumblr.com/assets/html/follow.html";var v=(s.indexOf("#")<0?"#":"&")+q(u);h=this.create_iframe(s+v)}},post_message_event:function(s,r){if(!s||s.length<2||s[0]!=="follow_iframe"){return false}switch(s[1]){case"resize":if(s.length>3){c=s[2];p=s[3];b.set("#tumblr_teaser_follow.open",{width:c+"px",height:p+"px"})}a=true;this.open(c,p);break;case"dismiss":this.close();break}function t(u,v){if(!(typeof u==="string"&&u.match(/\d+%/))){u=parseInt(u,10)||0}if(!(typeof v==="string"&&v.match(/\d+%/))){v=parseInt(v,10)||0}if(u){tumblelog_iframe.width=u}if(v){tumblelog_iframe.height=v}}},open:function(s,r){if(!h){return false}if(!(n&&a)){return false}if(i){return false}i=true;Tumblr.addClass(h,"open");o.style.display="none";return true},close:function(){if(!h){return}if(!i){return}i=false;n=false;Tumblr.removeClass(h,"open");o.style.display="block"},toggle:function(){if(!h){return}if(i){return this.close()}else{this.open()}}}})();
("Tumblr" in window)||(window.Tumblr={});Tumblr.Teaser=(function(){var a=false,e=false,b=false,f={hide:false,sneeze:false},c=false,d=360;return{is_enabled:function(){return !!e},initialize:function(h){e=document.getElementById("teaser_iframe");if(!e){return false}a=e.parentNode;if(!h){h={}}if(h.slide_page){c=h.slide_page}if(h.width){d=h.width}this.prepare(false);var g=this;a.addEventListener("mouseout",function(i){if(!(i.relatedTarget||i.toElement)){g.close()}})},prepare:function(h){if(!e){return}var g=0.25;var i=0.3;a.style.display="block";a.style.opacity="0";a.style.visibility="hidden";a.style.position="fixed";a.style.top="0";a.style.right="0";a.style.bottom="0";a.style.width="1px";a.style.height="100%";a.style.zIndex="2147483646";a.style.overflow="hidden";a.style.backgroundColor="rgba(0,0,0, 0.6)";a.style.webkitTransition="width "+g+"s ease-in-out";a.style.MozTransition="width "+g+"s ease-in-out";a.style.msTransition="width "+g+"s ease-in-out";a.style.OTransition="width "+g+"s ease-in-out";a.style.transition="width "+g+"s ease-in-out";e.style.display="block";e.style.opacity="1";e.style.visibility="visible";e.style.position="absolute";e.style.top="0";e.style.right="0";e.style.minWidth="100%";e.style.width=d+"px";e.style.height="100%";if(c&&document.body.parentNode){document.body.parentNode.style.position="relative";document.body.parentNode.style.webkitTransition="right "+g+"s ease-in-out";document.body.parentNode.style.MozTransition="right "+g+"s ease-in-out";document.body.parentNode.style.msTransition="right "+g+"s ease-in-out";document.body.parentNode.style.OTransition="right "+g+"s ease-in-out";document.body.parentNode.style.transition="right "+g+"s ease-in-out";document.body.parentNode.style.right="0"}},refresh:function(){if(!e){return}e.contentWindow.postMessage("teaser;prepare_next","*")},reset_timers:function(){clearTimeout(f.hide);f.hide=false;clearTimeout(f.sneeze);f.sneeze=false},reset:function(){if(!e){return}this.reset_timers();a.style.opacity="0";this.refresh()},open:function(){if(!e){return}if(b){return}b=true;a.style.opacity="1";a.style.visibility="visible";a.style.width=d+"px";if(c&&document.body.parentNode){document.body.parentNode.style.right=d+"px"}e.contentWindow.postMessage("teaser;show","*");this.reset_timers();clearTimeout(f.sneeze);f.sneeze=setTimeout(function(){f.sneeze=false},100)},close:function(){if(!e){return}if(!b||f.sneeze){return}b=false;a.style.opacity="1";a.style.visibility="visible";a.style.width="1px";if(c&&document.body.parentNode){document.body.parentNode.style.right="0"}e.contentWindow.postMessage("teaser;hide","*");this.reset_timers();var g=this;f.hide=setTimeout(function(){g.reset()},300)},toggle:function(){if(!e){return}if(b){return this.close()}else{this.open()}}}})();
("Tumblr" in window)||(window.Tumblr={});Tumblr.TaggedTeaser=(function(){var e=false,f={},c=true,a=144,b=false;function d(m,j){var n=[];for(var l in m){var i=j?j+"["+l+"]":l,h=m[l];n.push(typeof h=="object"?d(h,i):encodeURIComponent(i)+"="+encodeURIComponent(h))}return n.join("&")}function g(h){e.style.position=h||"absolute"}return{create_iframe:function(h){var i=document.createElement("iframe");i.id="tumblr_teaser_tagged";i.width="100%";i.height=1;i.frameBorder=0;i.scrolling="no";i.src=h;document.body.appendChild(i);return i},initialize:function(h){if(!h){h={}}if(h.height){a=h.height}if(e&&h.once){return}e=document.getElementById("tumblr_teaser_tagged");if(!e&&!h.once){f=h.query||{};f.tag=h.tag;e=this.create_iframe((h.url||"http://www.tumblr.com/assets/html/iframe/tagged.html")+"#"+d(f))}return this.prepare(h.open)},prepare:function(j){if(!e){return}var h=0.25;e.style.display="block";e.style.opacity="1";e.style.visibility="hidden";e.style.position="absolute";e.style.bottom="0";e.style.right="0";e.style.minWidth="100%";e.style.width="100%";e.style.height="1px";e.style.zIndex="2147483647";e.style.webkitTransition="height "+h+"s ease-in-out";e.style.MozTransition="height "+h+"s ease-in-out";e.style.msTransition="height "+h+"s ease-in-out";e.style.OTransition="height "+h+"s ease-in-out";e.style.transition="height "+h+"s ease-in-out";if(j){var i=this;setTimeout(function(){i.open()},0)}return this},open:function(h){if(!e){return}if(b){return}b=true;e.style.height=(h||a)+"px";e.style.visibility="visible";if(c&&document.body.parentNode){document.body.style.position="relative";document.body.style.paddingBottom=(h||a)+"px";document.body.parentNode.style.minHeight="100%"}g("fixed")},close:function(){if(!e){return}if(!b){return}b=false;e.style.height="1px";setTimeout(function(){e.style.visibility="hidden"},300)},toggle:function(){if(!e){return}if(b){return this.close()}else{this.open()}}}})();
("Tumblr" in window)||(window.Tumblr={});Tumblr.flashVersion=function(){if(navigator.plugins&&navigator.plugins.length>0){var a=navigator.mimeTypes;if(a&&a["application/x-shockwave-flash"]&&a["application/x-shockwave-flash"].enabledPlugin&&a["application/x-shockwave-flash"].enabledPlugin.description){return parseInt(a["application/x-shockwave-flash"].enabledPlugin.description.split(" ")[2].split(".")[0],10)}}else{if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var b=c.GetVariable("$version");return b.split(",")[0].split(" ")[1]}catch(d){}return 0}}};Tumblr.replaceIfFlash=function(b,a,c){if(Tumblr.flashVersion()>=b){document.getElementById(a).innerHTML=c}};Tumblr.renderVideo=function(c,g,e,a,b){var d=navigator.userAgent.toLowerCase();var f=(d.indexOf("iphone")!=-1);if(f){document.getElementById(c).innerHTML='<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" width="'+e+'" height="'+a+'" codebase="http://www.apple.com/qtactivex/qtplugin.cab"><param name="src" value="'+g+'"><param name="qtsrc" value="'+g+'"><param name="autoplay" value="false"><embed src="'+g+'" qtsrc="'+g+'" width="'+e+'" height="'+a+'" pluginspage="http://www.apple.com/quicktime/"></embed></object>'}else{replaceIfFlash(10,c,'<embed type="application/x-shockwave-flash" src="http://assets.tumblr.com/swf/video_player.swf?22" bgcolor="#000000" quality="high" class="video_player" wmode="transparent" allowfullscreen="true" height="'+a+'" width="'+e+'" flashvars="file='+encodeURIComponent(g)+(b?"&amp;"+b:"")+'"></embed>')}};Tumblr.windowDimensions=function(){if(window.innerWidth!==undefined){return{width:window.innerWidth,height:window.innerHeight}}else{if(document.documentElement){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}else{return{width:document.body.clientWidth,height:document.body.clientHeight}}}};Tumblr.Lightbox=(function(){var f=false;var h=false;var n=false;var d=[];var i=false;var g=false;var o=false;var e=false;var c={left:false,center:false,right:false};function m(r,u){if(document.getElementById("tumblr_lightbox")){return}if(!u){u=1}d=r;if(navigator&&navigator.userAgent.indexOf("Firefox")!=-1){var y=document.createElement("input");y.setAttribute("id","Tumblr_Lightbox_focus_input");y.setAttribute("type","text");y.style.position="fixed";y.style.top=0;y.style.left=0;document.body.appendChild(y);y.focus();document.body.removeChild(y)}else{window.focus()}if(!f){if(window.onkeydown){h=window.onkeydown}window.onkeydown=function(B){if(document.getElementById("tumblr_lightbox")){if(!B){B=window.event}var A=B.charCode?B.charCode:B.keyCode;if(!B.shiftKey&&!B.ctrlKey&&!B.altKey&&!B.metaKey){if(A==37){if(g>1){k(g-1)}}else{if(A==39){if(g<d.length){k(g+1)}}else{if(A==27||A==32||A==74||A==75){l()}}}}else{if((B.ctrlKey||B.metaKey)&&A==87){l();return false}}}if(h){h()}};if(window.onresize){n=window.onresize}window.onresize=function(){if(document.getElementById("vignette")){document.getElementById("vignette").style.display="none";if(e){clearTimeout(e)}e=setTimeout(function(){document.getElementById("vignette").style.display="inline-block"},100)}j();if(n){n()}};if(navigator&&navigator.userAgent.search("iPad")!=-1){document.addEventListener("touchmove",function(){l()},false)}f=true}document.body.style.overflow="hidden";var p=document.createElement("div");p.setAttribute("id","tumblr_lightbox");if(navigator&&navigator.userAgent.search("iPad")!=-1){p.style.position="absolute";p.style.top=document.body.scrollTop+"px";p.style.height=window.innerHeight+"px"}else{p.style.position="fixed";p.style.top="0px";p.style.bottom="0px"}p.style.left="0px";p.style.right="0px";p.style.zIndex=4294967294;p.style.overflow="hidden";p.style.backgroundColor=(navigator&&navigator.userAgent.indexOf("MSIE")!=-1)?"#222":"rgba(17,17,17,0.92)";p.onclick=function(){if(i){i=false}else{l()}};if(!(navigator&&navigator.userAgent.search("iPad")!=-1)&&!(navigator&&navigator.userAgent.search("MSIE")!=-1)){var x=document.createElement("img");x.setAttribute("id","vignette");x.setAttribute("src","http://assets.tumblr.com/images/full_page_vignette.png");x.style.position="absolute";x.style.width="100%";x.style.height="100%";x.style.left="0px";x.style.top="0px";p.appendChild(x);var w=document.createElement("div");w.style.position="absolute";w.style.width="100%";w.style.height="100%";w.style.left="0px";w.style.top="0px";p.appendChild(w)}var s=document.createElement("div");s.style.position="absolute";s.style.left="50%";s.style.top="50%";if(!document.getElementById("tumblr_form_key")){s.style.width="100%"}p.appendChild(s);var q=["left","center","right"];while(stage_name=q.pop()){var v=document.createElement("a");v.setAttribute("id","tumblr_lightbox_"+stage_name+"_link");v.setAttribute("href","#");if(d.length<2){v.style.cursor="default"}s.appendChild(v);var t=document.createElement("img");t.setAttribute("id","tumblr_lightbox_"+stage_name+"_image");t.setAttribute("src","http://assets.tumblr.com/images/x.gif");t.style.mozBorderRadius="3px";t.style.webkitBorderRadius="3px";t.style.borderRadius="3px";if(navigator&&navigator.userAgent.indexOf("Chrome")!=-1){t.style.moxBoxShadow="0 4px 30px rgba(0,0,0,1)";t.style.webkitBoxShadow="0 4px 30px rgba(0,0,0,1)";t.style.boxShadow="0 4px 30px rgba(0,0,0,1)"}t.style.borderWidth="0px";t.style.position="absolute";if(stage_name=="center"){t.style.zIndex=4294967295}v.appendChild(t)}var z=document.createElement("div");z.setAttribute("id","tumblr_lightbox_caption");z.style.position="absolute";z.style.textAlign="center";z.style.font="bold 17px 'HelveticaNeue','Helvetica','Arial',sans-serif";z.style.color="#fff";z.style.paddingTop="20px";z.style.textShadow="0 4px 30px rgba(0,0,0,1)";z.style.display="inline-block";z.style.textRendering="optimizeLegibility";s.appendChild(z);document.body.appendChild(p);k(u);j()}function l(){document.body.style.overflow="";document.getElementById("tumblr_lightbox").style.display="none";document.body.removeChild(document.getElementById("tumblr_lightbox"))}function k(q){g=q;o=Math.round(Math.random()*1000000000000);document.getElementById("tumblr_lightbox_left_link").onclick=function(){i=true;k(q-1);return false};if(d.length==1){document.getElementById("tumblr_lightbox_center_link").onclick=function(){return false}}else{if(q<d.length){document.getElementById("tumblr_lightbox_center_link").onclick=function(){i=true;k(q+1);return false}}else{document.getElementById("tumblr_lightbox_center_link").onclick=function(){i=true;k(1);return false}}}document.getElementById("tumblr_lightbox_right_link").onclick=document.getElementById("tumblr_lightbox_center_link").onclick;c.left=false;c.center=false;c.right=false;b("center",q-1);if(q>1){b("left",q-2)}if(q<d.length){b("right",q)}if(q+1<d.length){var p=new Image();p.src=d[q+1].low_res}}function b(q,s){var p=new Image();var r=false;p.className=o;p.onload=function(){if(this.className==o){this.className="high-res";c[q]=this;j()}};p.src=d[s].high_res;if(!p.complete){r=new Image();r.className=o;r.onload=function(){if(this.className==o&&(!c[q]||c[q].className=="placeholder")){this.className="low-res";c[q]=this;j()}};r.src=d[s].low_res;if(d[s].width&&d[s].height){if(r){r.style.maxWidth=d[s].width+"px";r.style.maxHeight=d[s].height+"px"}p.style.maxWidth=d[s].width+"px";p.style.maxHeight=d[s].height+"px"}if(!r.complete&&(d[s].width&&d[s].height)){c[q]=new Image(d[s].width,d[s].height);c[q].style.maxWidth=d[s].width+"px";c[q].style.maxHeight=d[s].height+"px";c[q].src="http://assets.tumblr.com/images/x.gif";c[q].className="placeholder"}}}function j(){var u=["right","left","center"];while(stage_name=u.pop()){var r=document.getElementById("tumblr_lightbox_"+stage_name+"_image");if(!r){continue}var s=c[stage_name];if(!s){r.style.display="none";continue}else{r.style.display="inline-block"}var q=s.style.maxWidth?parseInt(s.style.maxWidth,10):s.width;var p=s.style.maxHeight?parseInt(s.style.maxHeight,10):s.height;if(Tumblr.windowDimensions().width/Tumblr.windowDimensions().height<q/p){var t=(d.length==1)?0.85:0.75;if(Tumblr.windowDimensions().width*t>q&&(s.className=="high-res"||s.style.maxWidth)){r.style.width=q+"px";r.style.height=p+"px"}else{r.style.height=(p*((Tumblr.windowDimensions().width*t)/q))+"px";r.style.width=(Tumblr.windowDimensions().width*t)+"px"}}else{if(Tumblr.windowDimensions().height*0.85>p&&(s.className=="high-res"||s.style.maxHeight)){r.style.width=q+"px";r.style.height=p+"px"}else{r.style.width=(q*((Tumblr.windowDimensions().height*0.85)/p))+"px";r.style.height=(Tumblr.windowDimensions().height*0.85)+"px"}}if(stage_name=="center"){r.style.left=(0-parseInt(r.style.width,10)/2)+"px";r.style.top=(0-parseInt(r.style.height,10)/2)+"px"}else{r.style[stage_name]=(0-(parseInt(r.style.width,10)+Tumblr.windowDimensions().width*0.42))+"px";r.style.top=(0-parseInt(r.style.height,10)/2)+"px"}r.src=s.src;r.style.backgroundColor=(s.className=="placeholder")?((navigator&&navigator.userAgent.indexOf("MSIE")!=-1)?"#444":"rgba(255,255,255,0.05)"):"transparent";if(stage_name=="center"&&d[g-1].caption){document.getElementById("tumblr_lightbox_caption").innerHTML=d[g-1].caption;document.getElementById("tumblr_lightbox_caption").style.width=(Tumblr.windowDimensions().width*0.7)+"px";document.getElementById("tumblr_lightbox_caption").style.top=(parseInt(r.style.height,10)*0.5)+"px";document.getElementById("tumblr_lightbox_caption").style.left=(0-Tumblr.windowDimensions().width*0.35)+"px";document.getElementById("tumblr_lightbox_caption").style.display="block"}else{if(stage_name=="center"){document.getElementById("tumblr_lightbox_caption").style.display="none"}}}}function a(){return !!document.getElementById("tumblr_lightbox")}return{init:m,isOpen:a}})();Tumblr.IframePreloader=function(a){for(var b in a){if(typeof b=="object"){for(var c in b){this.options[b][c]=b[c]}}else{this.options[b]=a[b]}}this.__create()};Tumblr.IframePreloader.prototype={options:{iframe_src:"",iframe_before_onload:function(){},iframe_after_onload:function(){},iframe_class:"",iframe_styles:{zIndex:8675309,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent",border:"0px",overflow:"hidden"},preloader_class:"",preloader_innerHTML:'<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent center no-repeat url(\'/images/loading_big_fff_on_2e3133.gif?709\')"><img style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0.3;" src="http://assets.tumblr.com/images/full_page_vignette.png?709"/></div>',preloader_styles:{zIndex:8675310,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",overflow:"hidden",background:"rgba(17,17,17,0.92)"},close_class:"",close_innerHTML:"&times;",close_styles:{zIndex:8675311,position:"fixed",top:"10px",right:"15px",cursor:"pointer",font:"bold 20px Helvetica, sans-serif"}},iframe_loaded:false,__create:function(){this.id=Math.random().toString().split(".")[1];this.$container=document.createElement("div");this.$preloader=document.createElement("div");this.$preloader.id="iframe_preloader-preloader-"+this.id;this.$preloader.className=this.options.preloader_class;for(var d in this.options.preloader_styles){this.$preloader.style[d]=this.options.preloader_styles[d]}this.$preloader.innerHTML=this.options.preloader_innerHTML;this.$iframe=document.createElement("iframe");this.$iframe.id="iframe_preloader-iframe-"+this.id;this.$iframe.className=this.options.iframe_class;for(var c in this.options.iframe_styles){this.$iframe.style[c]=this.options.iframe_styles[c]}this.$iframe.src=this.options.iframe_src;this.$iframe.scrolling="no";this.$iframe.frameborder="0";this.$close=document.createElement("div");this.$close.id="iframe_preloader-close-"+this.id;this.$close.className=this.options.close_class;for(var b in this.options.close_styles){this.$close.style[b]=this.options.close_styles[b]}this.$close.innerHTML=this.options.close_innerHTML;var a=this;this.$close.onclick=function(){if(typeof pano_iframe_preloader!="undefined"&&pano_iframe_preloader){pano_iframe_preloader.remove()}};this.$iframe.onload=function(){a.options.iframe_before_onload();a.iframe_loaded=true;a.show();a.$close.style.display="none";a.options.iframe_after_onload()};this.hide_iframe();this.lock_body();this.$container.appendChild(this.$preloader);this.$container.appendChild(this.$iframe);this.$container.appendChild(this.$close);document.body.appendChild(this.$container)},hide:function(){this.hide_iframe();this.hide_preloader();this.unlock_body()},show:function(){if(this.iframe_loaded){this.show_iframe();this.hide_preloader()}else{this.hide_iframe();this.show_preloader()}this.lock_body()},remove:function(){this.hide();document.body.removeChild(this.$container);delete this.$container;delete this.$preloader;delete this.$iframe},lock_body:function(){document.body.style.overflow="hidden"},unlock_body:function(){document.body.style.overflow=""},show_preloader:function(){this.window.focus();this.$preloader.style.display="block"},hide_preloader:function(){this.$preloader.style.display="none"},show_iframe:function(){this.$iframe.contentWindow.focus();this.$iframe.style.opacity=1},hide_iframe:function(){this.$iframe.style.opacity=0}};var pano_iframe_preloader=false;Tumblr.PanoLightboxInit=function(b,a){if((!b&&window.event&&(window.event.metaKey||window.event.altKey))||(b&&(b.metaKey||b.altKey))){return true}pano_iframe_preloader=new Tumblr.IframePreloader({iframe_src:a});return false};Tumblr.hasClass=function(b,a){return new RegExp("(\\s|^)"+a+"(\\s|$)").test(b.className)};Tumblr.addClass=function(b,a){if(!Tumblr.hasClass(b,a)){b.className+=" "+a}};Tumblr.removeClass=function(c,a){if(Tumblr.hasClass(c,a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");c.className=c.className.replace(b," ")}};Tumblr.toggleClass=function(b,a){if(Tumblr.hasClass(b,a)){Tumblr.removeClass(b,a)}else{Tumblr.addClass(b,a)}};Tumblr.IframeContent=function(){var e,g,h,b;function i(){e=document.createElement("iframe");e.width=b.width;e.height=b.height;e.src="about:blank";for(var j in b.attr){e.setAttribute(j,b.attr[j])}e.setAttribute("frameborder","0");e.setAttribute("scrolling","no");e.setAttribute("webkitAllowFullScreen","");e.setAttribute("mozallowfullscreen","");e.setAttribute("allowFullScreen","");e.setAttribute("seamless","");e.setAttribute("style","display:block;background-color:transparent;overflow:hidden;");g.appendChild(e)}function d(){h="<!DOCTYPE html><html><head><title>Tumblr Video</title></head>";h+='<body class="'+b.body_class+'">';h+=b.content;h+="</body></html>"}function a(){e.onload=f;e.contentWindow.document.open("text/html","replace");e.contentWindow.document.write(h);e.contentWindow.document.close()}function c(){var j=e.contentWindow.document.body.offsetHeight;if(!j){return}e.height=j}function f(){c();if(typeof(b.onload)==="function"){b.onload()}}return{initialize:function(j){b=j;b.width=b.width||500;b.height=b.height||Math.floor(b.width*0.75);g=document.getElementById(b.container);if(!g){return false}i();d();a()}}};Tumblr.Asset=(function(){return{load:function(e,d){d=d||{};var b,f=d.callback||function(){},a=e.split("?")[0],c=a.split(".");c=c[c.length-1];if(c==="js"){b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",e)}if(c==="css"){b=document.createElement("link");b.setAttribute("type","text/css");b.setAttribute("rel","stylesheet");b.setAttribute("href",e)}if(typeof(b)!="undefined"){b.onload=f;document.getElementsByTagName("head")[0].appendChild(b)}}}})();Tumblr.PostMessageListener=(function(){return{initialize:function(d){d=d||function(){};var c=window.addEventListener?"addEventListener":"attachEvent";var b=window[c];var a=c=="attachEvent"?"onmessage":"message";b(a,function(g){if(typeof g.data!=="string"){return}var f=g.data.split(";");d(f,g.origin)},false)}}})();Tumblr.PostMessageListener.initialize(function(b,a){Tumblr.VideoFeatureSupport.post_message_event(b,a);Tumblr.AudioFeatureSupport.post_message_event(b,a);Tumblr.IframeFeatureSupport.post_message_event(b,a);Tumblr.AnalyticsFeatureSupport.post_message_event(b,a);Tumblr.TumblelogFormResize.post_message_event(b,a);Tumblr.PhotosetResize.post_message_event(b,a);Tumblr.LikeButtonUpdate.post_message_event(b,a);Tumblr.LikeButton.logged_in_iframe_loaded(b,a);Tumblr.LikeButton.post_message_event(b,a);Tumblr.LikeButton.like_iframe_loaded(b,a)});Tumblr.LikeButtonUpdate=(function(){return{post_message_event:function(c,a){if(c[0]==="tumblelog_like"){if(c[1]&&document.getElementById("like_button_"+c[1])){var b=document.getElementById("like_button_"+c[1]);if(c[2]==="liked"){Tumblr.addClass(b,"liked")}else{Tumblr.removeClass(b,"liked")}}}}}})();Tumblr.LikeButton={loaded_iframes:{},like_statuses:{},get_status_by_page:function(c){var a=document.getElementById("tumblr_controls");if(a){var b="get_like_states;"+JSON.stringify({page:c});a.contentWindow.postMessage(b,"*")}},get_status_by_post_ids:function(b){var a=document.getElementById("tumblr_controls");if(a){var c="get_like_states;"+JSON.stringify({ids:b});a.contentWindow.postMessage(c,"*")}},post_message_event:function(d,b){if(d[0]==="like_state_update"){var e=JSON.parse(d[1]);if(e.length){for(var c=0,a=e.length;c<a;c++){Tumblr.LikeButton.queue_like_status(e[c]);Tumblr.LikeButton.update_like_state(e[c])}}else{Tumblr.LikeButton.queue_like_status(e);Tumblr.LikeButton.update_like_state(e)}}},logged_in_iframe_loaded:function(m,h){if(m[0]==="logged_in_iframe_loaded"){var g="";var k="";var l=window.location.pathname;if(l.indexOf("page")!==-1||l.indexOf("post")!==-1){var e=l.split("/");for(var c=0;c<e.length;c++){if(e[c]==="page"&&e[c++]){g=e[c++];break}if(e[c]==="post"&&e[c++]){k=e[c++];break}}}if(k){Tumblr.LikeButton.get_status_by_post_ids([k])}else{if(g){Tumblr.LikeButton.get_status_by_page(g)}else{var f=[];var b=document.querySelectorAll(".like_button");for(var a=0;a<b.length;a++){var d=b[a];if(d.attributes["data-post-id"]){f.push(d.attributes["data-post-id"].value)}}if(f.length>0){Tumblr.LikeButton.get_status_by_post_ids(f)}}}}},like_iframe_loaded:function(b,a){if(b[0]==="like_iframe_load"){var c=JSON.parse(b[1]);if(c.post_id){Tumblr.LikeButton.loaded_iframes[c.post_id]=1;Tumblr.LikeButton.check_like_status(c.post_id,true)}}},check_like_status:function(b,a){var d=Tumblr.LikeButton.like_statuses[b];if(d){var c={post_id:b,state:(d==="liked")?true:false};Tumblr.LikeButton.update_like_state(c)}},queue_like_status:function(a){if(a.post_id){Tumblr.LikeButton.like_statuses[a.post_id]=(a.state)?"liked":"unliked"}},update_like_state:function(b){if(b.post_id){var a=document.getElementById("like_iframe_"+b.post_id);if(a){a.contentWindow.postMessage("state_update;"+JSON.stringify(b),"http://assets.tumblr.com")}}}};Tumblr.TumblelogFormResize=(function(){return{post_message_event:function(d,b){if(d[0]==="resize_tumblelog_form_iframe"){var e=d[1];var c=document.getElementById(e);var a=parseInt(d[2],10);if(e){c.height=a}}}}})();Tumblr.PhotosetResize=(function(){return{post_message_event:function(c,b){if(c[0]==="resize_photoset_iframe"){var d=c[1],a=parseInt(c[2],10);document.getElementById("photoset_iframe_"+d).height=a}}}})();Tumblr.AnalyticsFeatureSupport=(function(){return{post_message_event:function(c,a){if(c[0]==="openInMobileAppSuccess"){if(typeof(open_in_mobile_app)==="function"){if(c[1]&&c[1].length){var b=parseInt(c[1],10);open_in_mobile_app(b)}}}}}})();Tumblr.IframeFeatureSupport=(function(){var g,d,a,b=new Tumblr.Styler({id:"tumblr_iframe_css",styles:{"#tumblr_controls":{display:"block",opacity:"1",visibility:"hidden",position:"absolute",top:"0",right:"0",width:"1px",height:"1px","z-index":"2147483647"},"#tumblr_controls.visible":{visibility:"visible"},".tumblr_mobile_banner":{position:"relative"},"html.tumblr_mobile_banner body iframe#tumblr_controls.visible.tumblr_sticky_iframe":{position:"absolute !important",visibility:"visible !important",top:"0 !important",opacity:"1 !important"},".tumblr_mobile_banner #tumblr_controls":{position:"absolute !important",visibility:"visible !important",top:"0 !important","-webkit-transform":"translateY(-100%)","-moz-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)","-o-transform":"translateY(-100%)",transform:"translateY(-100%)","-webkit-transition":"-webkit-transform 0.2s ease-out","-moz-transition":"-moz-transform 0.2s ease-out","-ms-transition":"-ms-transform 0.2s ease-out","-o-transition":"-o-transform 0.2s ease-out",transition:"transform 0.2s ease-out"},".tumblr_mobile_banner #tumblr_controls.visible":{"-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none","-o-transform":"none",transform:"none"}}});function e(){var i,j,h=document.querySelector('meta[name="color:Tumblr Controls"]');if(h){i=h.getAttribute("content")}if(!i){i="default"}g.contentWindow.postMessage("color_match;"+i,d)}function f(h,i){if(!(typeof h==="string"&&h.match(/\d+%/))){h=parseInt(h,10)||0}if(!(typeof i==="string"&&i.match(/\d+%/))){i=parseInt(i,10)||0}Tumblr.addClass(g,"visible");if(h){g.width=h;b.set("#tumblr_controls","width",h+"px")}if(i){g.height=i;b.set("#tumblr_controls","height",i+"px")}}function c(l,k){if(!l){l=200}var i=false;var j=k?document.getElementById(k):g;if(!j){return}var h=d;window.addEventListener("scroll",function(){if(i){return}var m=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0;var q=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft||0;var p=Tumblr.windowDimensions();var o=document.body.offsetWidth-(q+p.width);var n=document.body.offsetHeight-(m+p.height);j.contentWindow.postMessage("parent_scroll;"+m+";"+q+";"+o+";"+n,h);i=true;setTimeout(function(){i=false},l)})}return{post_message_event:function(q,o){a=document.getElementById("mobile_iframe");g=document.getElementById("tumblr_controls");d=q[q.length-1];if(a){if(q[0]==="show_mobile_banner"){if(q[1]==="1"){Tumblr.MobileBanner.showBanner();Tumblr.MobileBanner.mobile_origin=d}else{Tumblr.MobileBanner.showHeaderBanner()}}}else{if(g&&d){if(q[0]==="color_match"){e()}if(q[0]==="location_change"){if(!document.getElementById("iframe_flash_fix")){var i=document.createElement("div");i.id="iframe_flash_fix";i.innerHTML="&shy;<style> #tumblr_controls { visibility: hidden; } </style>";document.body.appendChild(i);document.getElementById("tumblr_controls").onload=function(){document.body.removeChild(i)}}}if(q[0]==="request_keywords"){if(typeof tumblr_meta_keyboards!="undefined"){g.contentWindow.postMessage("keywords;"+tumblr_meta_keyboards,d)}}if(q[0]==="teaser_iframe"){if(q.length<2||!Tumblr.Teaser){return false}switch(q[1]){case"initialize":g.contentWindow.postMessage("teaser;enable",d);return Tumblr.Teaser.initialize({slide_page:(q.length>2&&q[2]==="slide")});case"load":return Tumblr.Teaser.load_once();case"open":return Tumblr.Teaser.open();case"close":return Tumblr.Teaser.close();case"toggle":return Tumblr.Teaser.toggle();default:break}}if(q[0]==="tagged_teaser_iframe"){if(q.length<2||!Tumblr.TaggedTeaser){return false}switch(q[1]){case"show":Tumblr.TaggedTeaser.initialize({once:true,open:true});return;case"open":return Tumblr.TaggedTeaser.open(q.length>2?q[2]:false);case"close":return Tumblr.TaggedTeaser.close();case"toggle":return Tumblr.TaggedTeaser.toggle();default:break}}if(q[0]==="resize_iframe"){f(q[1],q[2]);if(q.length>2){switch(q[3]){case"body_class":if(q.length>3&&q[4]){Tumblr.addClass(document.body,q[4])}break;default:break}}}if(q[0]==="mobile_resize_iframe"){f(q[1],q[2]);var j=g.width;var p=g.height;var n=0;var h=false;var k=3;while(k<q.length){switch(q[k]){case"corner_buttons":h=true;k++;break;case"add_iframe_class":if(k+1<q.length){Tumblr.addClass(g,q[++k])}break;case"remove_iframe_class":if(k+1<q.length){Tumblr.removeClass(g,q[++k])}break;case"margin_bottom":if(k+1<q.length){n=parseInt(q[++k],10);if(!n){n=0}}break;default:break}k++}if(!h){Tumblr.addClass(document.body.parentNode,"tumblr_mobile_banner");b.set(".tumblr_mobile_banner",{top:(p-n)+"px !important"});b.set(".tumblr_mobile_banner #tumblr_controls",{top:(n-p)+"px !important"})}else{Tumblr.removeClass(document.body.parentNode,"tumblr_mobile_banner");b.set(".tumblr_mobile_banner",{position:"fixed !important",top:""});b.set(".tumblr_mobile_banner #tumblr_controls",{position:"fixed !important",top:""})}}if(q[0]==="scroll_listen"){var l=(q.length>2)?q[1]:false;var m=(q.length>3)?q[2]:false;c(l,m)}}}}}})();Tumblr.VideoFeatureSupport=(function(){var b={setup_controls:{}};function f(){if(document.getElementById("tumblr_video_iframe_fullscreen")){return true}var j=document.createElement("style");j.id="tumblr_video_iframe_fullscreen";j.innerHTML=".tumblr_video_iframe.fullwindow { top: 0; bottom: 0; right: 0; left: 0; position: fixed; z-index: 8675309; height: 100%; width: 100%; }";document.body.appendChild(j)}function e(j){f();if(j){b.iframe.className="tumblr_video_iframe fullwindow"}else{b.iframe.className="tumblr_video_iframe"}}function i(j){var k=document.getElementById("tumblr_controls");if(!j){if(b.parent_post){b.parent_post.className=b.parent_post.className.replace(/\s+is_lightbox/g,"")}document.body.className=document.body.className.replace(/\s+is_lightbox/g,"");document.body.style.overflow="visible";b.iframe.style.position="static";b.iframe.style.height="100%";b.iframe.style.width="100%";b.iframe.style.zIndex=0;if(k){k.style.display="block"}return}a();if(b.parent_post){b.parent_post.className+=" is_lightbox"}document.body.className+=" is_lightbox";document.body.style.overflow="hidden";b.iframe.style.position="fixed";b.iframe.style.height="100%";b.iframe.style.width="100%";b.iframe.style.top=0;b.iframe.style.right=0;b.iframe.style.left=0;b.iframe.style.bottom=0;b.iframe.style.zIndex=90210;if(k){k.style.display="none"}}function g(j){if(!j){if(b.parent_post){b.parent_post.className=b.parent_post.className.replace(/\s+is_fullscreen/g,"")}document.body.className=document.body.className.replace(/\s+is_fullscreen/g,"");return}if(b.parent_post){b.parent_post.className+=" is_fullscreen"}document.body.className+=" is_fullscreen"}function a(){if(b.setup_controls[b.id]){return}var k=document.querySelector("#post_"+b.id+" .tumblr_lightbox_controls .close_button");if(k){k.addEventListener("click",function(l){b.iframe.contentWindow.postMessage("exit_lightbox",b.origin_url);return false})}var j=document.querySelector("#post_"+b.id+" .tumblr_lightbox_controls .like_button");if(j){j.addEventListener("click",function(m){var l=this;var n={id:l.getAttribute("data-post-id"),key:l.getAttribute("data-reblog-key")};if(Tumblr.hasClass(l,"already_like")){Tumblr.unlike(n,{success:function(){Tumblr.removeClass(l,"already_like")}})}else{Tumblr.like(n,{success:function(){Tumblr.addClass(l,"already_like")}})}return false})}b.setup_controls[b.id]=true}function h(){if(typeof(get_cookie)==="function"){var j=get_cookie("supress_lightbox"),k=parseInt(j.value,10)||0;if(j&&k>3){return"supress_lightbox"}if(!j){return"enable_lightbox"}}return false}function d(k){if(typeof(set_cookie)==="function"){var j=get_cookie("supress_lightbox"),l=parseInt(j.value,10)||0;if(k>0&&k<5){}if(k===-1){if(l>1){}else{}}c(h())}}function c(l){if(!l){return}var k=document.querySelectorAll(".tumblr_video_iframe.has_lightbox");for(var j=0;j<k.length;j++){k[j].contentWindow.postMessage(l,"http://"+k[j].getAttribute("data-origin"))}}return{post_message_event:function(l,j){var k=l[2];b.iframe=document.getElementById("tumblr_video_iframe_"+k);if(!b.iframe){return}b.id=k;b.origin_url="http://"+b.iframe.getAttribute("data-origin");b.parent_post=document.getElementById("post_"+k);if(l[0]==="lightbox"){i((l[1]==="true")?true:false)}if(l[0]==="full_window"){e((l[1]==="true")?true:false)}if(l[0]==="full_screen"){g((l[1]==="true")?true:false)}}}})();Tumblr.AudioFeatureSupport=(function(){return{post_message_event:function(d,a){var c,b;if(d[0]==="audioPlayerReady"){c=document.getElementsByClassName("tumblr_audio_player");for(b=0;b<c.length;b++){if(c[b].className.indexOf(" tumblr_audio_player_"+d[1])>=0){try{if(!c[b].style.webkitTransform){c[b].style.webkitTransform="translate3d(0px, 0px, 0px)"}}catch(f){}}}}else{if(d[0]==="audioPlayerPlaying"){c=document.getElementsByClassName("tumblr_audio_player");for(b=0;b<c.length;b++){if(c[b].className.indexOf(" tumblr_audio_player_"+d[1])<0){c[b].contentWindow.postMessage("pause","*")}}c=document.getElementsByClassName("tumblr_video_iframe");for(b=0;b<c.length;b++){c[b].contentWindow.postMessage("pause","*")}}}}}})();Tumblr.mobileFullscreenIframe={og_store:function(){this.og_body_position=document.body.style.position;this.og_body_overflow=document.body.style.overflow;this.og_html_bg=this.html_el.style.backgroundColor;this.win_height=window.innerHeight+"px"},set_frame_height:function(){this.win_height=window.innerHeight+"px";this.win_width=window.innerWidth+"px";this.frame.style.height=this.win_height;this.frame.style.minWidth=this.win_width},enable:function(a){this.frame=document.getElementById(a);if(!this.frame){return}this.html_el=document.getElementsByTagName("html")[0];this.og_store();this.orientation_height_change=this.set_frame_height.bind(this);window.addEventListener("orientationchange",this.orientation_height_change,false);window.addEventListener("resize",this.orientation_height_change,false);this.frame.className+=" is_lightbox";document.body.className+=" is_lightbox";document.body.style.position="relative";document.body.style.left="-99999px";document.body.style.overflow="hidden";this.html_el.style.backgroundColor="#000000";this.frame.style.cssText="position:fixed; overflow:hidden; width: 100%; top:0; left:0; right:0; bottom:0; z-index: 90210;";this.frame.style.height=this.win_height;if(document.getElementById("tumblr_controls")){document.getElementById("tumblr_controls").style.display="none"}},disable:function(a){this.frame=this.frame||document.getElementById(a);if(!this.frame){return}this.frame.className=this.frame.className.replace(/\s+is_lightbox/,"");document.body.className=document.body.className.replace(/\s+is_lightbox/,"");document.body.style.overflow=this.og_body_overflow;document.body.style.position=this.og_body_position;this.html_el.style.backgroundColor=this.og_html_bg;this.frame.style.cssText="";if(document.getElementById("tumblr_controls")){document.getElementById("tumblr_controls").style.display="block"}window.removeEventListener("orientationchange",this.orientation_height_change,false);window.removeEventListener("resize",this.orientation_height_change,false)}};function flashVersion(){return Tumblr.flashVersion()}function renderVideo(c,e,d,a,b){Tumblr.renderVideo(c,e,d,a,b)}function replaceIfFlash(b,a,c){Tumblr.replaceIfFlash(b,a,c)}(function(){function a(){var g=document.getElementById("tumblr_controls");if(!g){return}var l=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight;var i=g.offsetTop;var e=l-(g.offsetTop+g.offsetHeight);if(i===0||e===0){g.style.position="fixed";return}if(!g.classList){return}var k=g.clientHeight;var h="        html body iframe#tumblr_controls {            -webkit-transition-property: opacity;               -moz-transition-property: opacity;                -ms-transition-property: opacity;                 -o-transition-property: opacity;                    transition-property: opacity;            -webkit-transition-duration: .3s;               -moz-transition-duration: .3s;                -ms-transition-duration: .3s;                 -o-transition-duration: .3s;                    transition-duration: .3s;            -webkit-transition-timing-function: ease;               -moz-transition-timing-function: ease;                -ms-transition-timing-function: ease;                 -o-transition-timing-function: ease;                    transition-timing-function: ease;        }        html body iframe#tumblr_controls.tumblr_sticky_iframe {            position: fixed !important;            top: 0 !important;        }        ";var b;var d="tumblr_sticky_iframe_style";var j=document;if(j.createStyleSheet){b=j.createStyleSheet();b.cssText=h;if(d){b.owningElement.id=d}}else{b=j.createElementNS?j.createElementNS("http://www.w3.org/1999/xhtml","style"):j.createElement("style");b.appendChild(j.createTextNode(h));if(d){b.id=d}j.getElementsByTagName("head")[0].appendChild(b)}function f(){g.style.visibility="visible";g.style.opacity=1}function c(){var m=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;if(m>=(i+k)){if(g.classList.contains("tumblr_sticky_iframe")){return}g.style.visibility="hidden";g.style.opacity=0;g.classList.add("tumblr_sticky_iframe");setTimeout(f,400)}else{g.classList.remove("tumblr_sticky_iframe")}}window.setInterval(c,500)}if(window.addEventListener){window.addEventListener("DOMContentLoaded",a,false)}else{window.attachEvent("onload",a)}})();
(function(i,k,a){var e=["webkit","Moz","ms","O"];var p={};var o;function g(q,t){var r=k.createElement(q||"div");var s;for(s in t){r[s]=t[s]}return r}function h(r){for(var q=1,s=arguments.length;q<s;q++){r.appendChild(arguments[q])}return r}var j=function(){var q=g("style");h(k.getElementsByTagName("head")[0],q);return q.sheet||q.styleSheet}();function c(u,q,v,y){var r=["opacity",q,~~(u*100),v,y].join("-");var s=0.01+v/y*100;var x=Math.max(1-(1-u)/q*(100-s),u);var w=o.substring(0,o.indexOf("Animation")).toLowerCase();var t=w&&"-"+w+"-"||"";if(!p[r]){j.insertRule("@"+t+"keyframes "+r+"{0%{opacity:"+x+"}"+s+"%{opacity:"+u+"}"+(s+0.01)+"%{opacity:1}"+(s+q)%100+"%{opacity:"+u+"}100%{opacity:"+x+"}}",0);p[r]=1}return r}function n(u,v){var t=u.style;var q;var r;if(t[v]!==a){return v}v=v.charAt(0).toUpperCase()+v.slice(1);for(r=0;r<e.length;r++){q=e[r]+v;if(t[q]!==a){return q}}}function f(q,s){for(var r in s){q.style[n(q,r)||r]=s[r]}return q}function m(s){for(var q=1;q<arguments.length;q++){var r=arguments[q];for(var t in r){if(s[t]===a){s[t]=r[t]}}}return s}function l(q){var r={x:q.offsetLeft,y:q.offsetTop};while((q=q.offsetParent)){r.x+=q.offsetLeft;r.y+=q.offsetTop}return r}var d={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto"};var b=function b(q){if(!this.spin){return new b(q)}this.opts=m(q||{},b.defaults,d)};b.defaults={};b.prototype={spin:function(x){this.stop();var B=this;var q=B.opts;var r=B.el=f(g(0,{className:q.className}),{position:"relative",zIndex:q.zIndex});var A=q.radius+q.length+q.width;var C;var z;if(x){x.insertBefore(r,x.firstChild||null);z=l(x);C=l(r);f(r,{left:(q.left=="auto"?z.x-C.x+(x.offsetWidth>>1):q.left+A)+"px",top:(q.top=="auto"?z.y-C.y+(x.offsetHeight>>1):q.top+A)+"px"})}r.setAttribute("aria-role","progressbar");B.lines(r,B.opts);if(!o){var u=0;var s=q.fps;var w=s/q.speed;var v=(1-q.opacity)/(w*q.trail/100);var y=w/q.lines;!function t(){u++;for(var D=q.lines;D;D--){var E=Math.max(1-(u+D*y)%w*v,q.opacity);B.opacity(r,q.lines-D,E,q)}B.timeout=B.el&&setTimeout(t,~~(1000/s))}()}return B},stop:function(){var q=this.el;if(q){clearTimeout(this.timeout);if(q.parentNode){q.parentNode.removeChild(q)}this.el=a}return this},lines:function(s,u){var r=0;var q;function t(v,w){return f(g(),{position:"absolute",width:(u.length+u.width)+"px",height:u.width+"px",background:v,boxShadow:w,transformOrigin:"left",transform:"rotate("+~~(360/u.lines*r)+"deg) translate("+u.radius+"px,0)",borderRadius:(u.width>>1)+"px"})}for(;r<u.lines;r++){q=f(g(),{position:"absolute",top:1+~(u.width/2)+"px",transform:u.hwaccel?"translate3d(0,0,0)":"",opacity:u.opacity,animation:o&&c(u.opacity,u.trail,r,u.lines)+" "+1/u.speed+"s linear infinite"});if(u.shadow){h(q,f(t("#000","0 0 4px #000"),{top:2+"px"}))}h(s,h(q,t(u.color,"0 0 1px rgba(0,0,0,.1)")))}return s},opacity:function(r,q,s){if(q<r.childNodes.length){r.childNodes[q].style.opacity=s}}};!function(){var r=f(g("group"),{behavior:"url(#default#VML)"});var q;if(!n(r,"transform")&&r.adj){for(q=4;q--;){j.addRule(["group","roundrect","fill","stroke"][q],"behavior:url(#default#VML)")}b.prototype.lines=function(v,u){var t=u.length+u.width;var B=2*t;function A(){return f(g("group",{coordsize:B+" "+B,coordorigin:-t+" "+-t}),{width:B,height:B})}var w=-(u.width+u.length)*2+"px";var z=f(A(),{position:"absolute",top:w,left:w});var y;function x(C,s,D){h(z,h(f(A(),{rotation:360/u.lines*C+"deg",left:~~s}),h(f(g("roundrect",{arcsize:1}),{width:t,height:u.width,left:u.radius,top:-u.width>>1,filter:D}),g("fill",{color:u.color,opacity:u.opacity}),g("stroke",{opacity:0}))))}if(u.shadow){for(y=1;y<=u.lines;y++){x(y,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(y=1;y<=u.lines;y++){x(y)}return h(v,z)};b.prototype.opacity=function(t,s,v,u){var w=t.firstChild;u=u.shadow&&u.lines||0;if(w&&s+u<w.childNodes.length){w=w.childNodes[s+u];w=w&&w.firstChild;w=w&&w.firstChild;if(w){w.opacity=v}}}}else{o=n(r,"animation")}}();i.Spinner=b})(window,document);
(function(b,a){var c=function(d,e){this.$container=b(d);this.container=this.$container[0];this.options=b.extend({on_infinite_scroll:function(){},on_scroll:function(){}},e||{});this.$wrapper=b('<div class="popover_scrollbar"></div>');this.$track=b('<div class="popover_scrollbar_track"></div>');this.$thumb=b('<div class="popover_scrollbar_thumb"></div>');this.is_scrollable=false;this.is_scrolling=false;this.$track.on("mousedown",b.proxy(this.on_scrollbar_mousedown,this));this.$container.on("scroll.popover_scrollbar",b.proxy(this.on_scroll,this));this.init()};c.prototype={init:function(){this.$container.wrap(this.$wrapper);this.update()},update:function(){if(!this.is_scrollable&&this.container.scrollHeight>this.$container.height()){this.is_scrollable=true;this.$container.after(this.$track);this.$track.append(this.$thumb);if(!("ontouchstart" in document.documentElement)){this.$container.on("mousewheel DOMMouseScroll",b.proxy(this.steal_scroll,this))}}if(this.is_scrollable){var d=this.$container.height()/this.container.scrollHeight;this.$thumb.height(this.$track.height()*d)}this.on_scroll()},steal_scroll:function(f){var d=f.currentTarget,g=f.originalEvent.wheelDelta||-f.originalEvent.detail;if(g>0&&d.scrollTop<=0){f.preventDefault()}if(g<0&&d.scrollTop>=d.scrollHeight-b(d).height()){f.preventDefault()}},on_scrollbar_mousedown:function(d){d.preventDefault();this.$track.addClass("is_scrolling");b(window).on("mousemove.popover_scrollbar",b.proxy(this.on_scrollbar_mousemove,this));b(window).on("mouseup.popover_scrollbar",b.proxy(this.on_scrollbar_mouseup,this));this.on_scrollbar_mousemove(d)},on_scrollbar_mousemove:function(h){var f=h.pageY-this.$track.offset().top,g=f/this.$track.height(),d=this.container.scrollHeight-this.$container.height();if(g>=0&&g<=1){this.$container.scrollTop(d*g)}},on_scrollbar_mouseup:function(d){this.$track.removeClass("is_scrolling");b(window).off(".popover_scrollbar")},on_scroll:function(g){var f=this.container.scrollTop/(this.container.scrollHeight-this.$container.height()),d=this.$track.height()-this.$thumb.height();this.$thumb.css("top",d*f);this.options.on_scroll(this.container.scrollTop,f);if(f>0.9){this.options.on_infinite_scroll()}},destroy:function(){if(this.is_scrollable){this.$track.off().remove();this.$thumb.remove();this.$container.off(".popover_scrollbar")}this.$container.unwrap();this.is_scrollable=false;this.is_scrolling=false}};a.PopoverScroll=c})(jQuery,Tumblr);
(function(b,a){var c={init:function(l){var h=b(document);var d="placeholder" in document.createElement("input");var j="placeholder" in document.createElement("textarea");l=b.extend({},l);var k=(l.els)?b(l.els):b("input, textarea");var i=l.clear_on_submit;var e=l.force;function m(p){var n=b(p.target);var o=n.get(0).nodeName.toLowerCase();if(!d||!j||e){if(n.hasClass("placeholder")){n.val("").removeClass("placeholder")}if(n.attr("data-type")=="password"){try{n.get(0).type="password"}catch(q){}}}}function f(n){if(!d||!j||e){g(n.target)}}function g(n){$input=b(n);var o=$input.attr("placeholder");if(o&&$input.val()===""){$input.addClass("placeholder").val(o)}if($input.attr("type")=="password"&&($input.val()===""||$input.val()===o)){try{$input.get(0).type="text"}catch(p){}$input.attr("data-type","password")}}if(!d||!j||e){h.on("focus",k.selector,m);h.on("blur",k.selector,f);_.each(k,function(o){g(o);if(i){var n=b(o);n.parents("form").on("submit",function(){if(n.val()===n.attr("placeholder")){n.val("")}})}})}}};a.PlaceHolders=c})(jQuery,this.Tumblr||(this.Tumblr={}));
(function(b,a,c){if(c==null||c.Events==null){throw"Tumblr.Events depends on Backbone.Events"}a.Events=_.extend({},c.Events)})(jQuery,Tumblr,Backbone);
(function(o,g,n,f,j,k){var e=g(k);var a=g(j);var m={};var i={};m.documentHeight=i.documentHeight=null;m.windowHeight=i.windowHeight=null;m.windowWidth=i.windowHeight=null;m.windowScrollTop=i.windowScrollTop=null;m.windowScrollY=i.windowScrollY=null;var l=(!Object.hasOwnProperty.call(j,"requestAnimationFrame")&&j.requestAnimationFrame)||(!Object.hasOwnProperty.call(j,"webkitRequestAnimationFrame")&&j.webkitRequestAnimationFrame)||(!Object.hasOwnProperty.call(j,"mozRequestAnimationFrame")&&j.mozRequestAnimationFrame)||(!Object.hasOwnProperty.call(j,"oRequestAnimationFrame")&&j.oRequestAnimationFrame)||(function(r){j.setTimeout(function(){r()},1000/20)});function b(){var s;function r(t){q();f.Events.trigger("DOMEventor:flatresize",m);s=false}a.on("resize.DOMEventor-nextResizeLoop",function(){if(!s){l(r);s=true}})}function d(){var s;var r=0;function t(u){if(!(r--)){i.documentHeight=m.documentHeight;m.documentHeight=e.height();r=1}i.windowScrollTop=i.windowScrollY=m.windowScrollTop;m.windowScrollTop=m.windowScrollY=a.scrollTop();f.Events.trigger("DOMEventor:flatscroll",m);s=false}a.on("scroll.DOMEventor-nextScrollLoop",function(){if(!s){l(t);s=true}})}function q(){i.documentHeight=m.documentHeight;m.documentHeight=e.height();i.windowHeight=m.windowHeight;m.windowHeight=a.height();i.windowWidth=m.windowWidth;m.windowWidth=a.width();i.windowScrollTop=i.windowScrollY=m.windowScrollTop;m.windowScrollTop=m.windowScrollY=a.scrollTop()}function h(){var r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};e.on("keydown.DOMEventor keyup.DOMEventor",function(v){var w=v.target.nodeName.toUpperCase();if(w==="INPUT"||w==="TEXTAREA"||w==="SELECT"){return}var s=v.type;if(!(s==="keyup"||s==="keydown")){return}var u=v.which;var t=s+":"+(v.altKey&&u!==18?"alt+":"")+(v.ctrlKey&&u!==17?"ctrl+":"")+(v.metaKey&&(u!==91&&u!==92&&u!==93)?"meta+":"")+(v.shiftKey&&u!==16?"shift+":"")+(r[u]||"");f.Events.trigger("DOMEventor:"+t,v,t)});f.Events.off("DOMEventor:startKeyboardObserver");f.Events.on("DOMEventor:stopKeyboardObserver",c)}function c(){e.off("keydown.DOMEventor keyup.DOMEventor");f.Events.on("DOMEventor:startKeyboardObserver",h);f.Events.off("DOMEventor:stopKeyboardObserver")}var p={init:function(){if(!(f.Events instanceof Object)||f.Events.on!==n.Events.on||f.Events.off!==n.Events.off||f.Events.trigger!==n.Events.trigger){throw"DOMEventor depends on Tumblr.Events being a mixin of Backbone.Events"}q();d();b();h();f.Events.on("DOMEventor:updateRect",q)},rect:function(){return m},lastRect:function(){return i}};f.DOMEventor=p})(_,jQuery,Backbone,Tumblr,window,document);
(function(c,a){var b=new (Backbone.View.extend({id:"glass_overlay",events:{click:"click"},locked:false,initialize:function(){},render:function(){c(document.body).prepend(this.$el);this.rendered=true;c(document).on("keydown",_.bind(this.keydown,this))},click:function(){if(this.locked){return}this.hide()},keydown:function(d){if(this.locked){return}if(this.visible){if(d.keyCode==27){this.hide()}}},show:function(e,d){if(Tumblr.KeyCommands&&!Tumblr.KeyCommands.suspended){Tumblr.KeyCommands.suspend();this.glass_suspended_keys=true}if(!this.rendered){this.render()}d=d||"";this.on_close=e||function(){};this.visible=true;this.$el.addClass("show");setTimeout(_.bind(function(){this.$el.addClass(d)},this),0)},hide:function(){this.visible=false;this.$el.removeClass("show");this.on_close();if(this.glass_suspended_keys){Tumblr.KeyCommands.resume();this.glass_suspended_keys=false}},lock:function(){this.locked=true},unlock:function(){this.locked=false}}))();a.Glass=b})(jQuery,Tumblr);
(function(c,b){var a={get:function(d){return new RegExp(d+"=([^;]+)").test(unescape(document.cookie))?RegExp.$1:null},set:function(d,j,i,f){f=f||{};var e=new Date();var k=f.path?f.path:"/";var h=f.is_secure?true:false;var g=f.domain?f.domain:"";e.setTime(e.getTime()+(i*1000));document.cookie=d+"="+escape(j)+((i==null)?"":";expires="+e.toGMTString())+";path="+k+((h===false)?"":";secure")+((g==="")?"":";domain="+g)},unset:function(d){a.set(d,"",-1)}};b.Cookie=a})(jQuery,Tumblr);
(function(d,b){var a=Backbone.View.extend({events:{click:"click"},initialize:function(e){this.button=d(e.el||this.$el);this.popover=e.popover||this.$el.find(".popover");this.on_hide=e.on_hide||function(){};this.on_show=e.on_show||function(){};this.auto_show=e.auto_show||false;if(this.auto_show){this.show()}a.register(this)},click:function(){this.toggle()},is_showing:false,show:function(){var e=this;Tumblr.Glass.show(function(){this.hide();this.on_hide()}.bind(this));this.popover.show();this.on_show();this.is_showing=true},hide:function(){var e=this;Tumblr.Glass.on_close=function(){if(e.is_showing){e.popover.hide()}};Tumblr.Glass.hide();this.is_showing=false},toggle:function(){return this.is_showing?this.hide():this.show()},});a.instances=[];a.register=function(e){this.instances.push(e)};a.hide_all=function(){for(var e=0;e<this.instances.length;e++){this.instances[e].hide()}};var c=a.extend({initialize:function(e){Tumblr.BasePopover.prototype.initialize.apply(this,arguments);this.skip_glass=e.skip_glass||false;this.skip_offset=e.skip_offset||false;this.direction=e.direction||"down";this.align=e.align||"left";this.options=e||{};this.options.left=e.left||0;this.options.right=e.right||0;this.options.top=e.top||0;this.options.bottom=e.bottom||0},click:function(){if(!this.options.disable_auto_show){this.show()}return},show:function(){if(this.options.directional){this.position()}var e=this;if(!this.skip_glass){Tumblr.Glass.show(function(){e.hide();e.on_hide()})}if(!this.$el.is(this.popover.parent())){var g={top:0,left:0};var f={};if(!this.skip_offset){g=this.button.position()}if(this.direction!=="up"){f.top=(this.options.top+g.top)+"px"}else{f.bottom=(this.options.bottom-g.top-this.button.height())+"px"}if(this.align!=="right"){f.left=(this.options.left+g.left)+"px"}else{f.right=(this.options.right-g.left-this.button.width())+"px"}this.popover.css(f)}this.popover.show();this.on_show();this.is_showing=true},hide:function(){var e=this;if(!this.skip_glass){Tumblr.Glass.on_close=function(){if(e.is_showing){e.popover.hide()}};Tumblr.Glass.hide()}this.is_showing=false},position:function(){this.popover.show();var i=d(window);var e={top:i.scrollTop(),left:i.scrollLeft()};this.popover.removeClass("up nipple_on_bottom");e.right=e.left+i.width();e.bottom=e.top+i.height();var h=this.popover.offset();var g=this.popover.outerHeight();var f=i.height();h.right=h.left+this.popover.outerWidth();h.bottom=h.top+g;if(f>g&&e.bottom<h.bottom){this.popover.addClass("up nipple_on_bottom")}}});b.BasePopover=a;b.Popover=c})(jQuery,Tumblr);
(function(c,b){var a=Tumblr.Popover.extend({initialize:function(d){this.options=d||{};this.form=this.$("form");this.form.submit(_.bind(this.submit_form,this));Tumblr.Popover.prototype.initialize.apply(this,arguments)},show:function(){Tumblr.Popover.prototype.show.call(this);if(!this.options.no_autofocus){this.$("form :input").first().focus()}},submit_form:function(){var d=this.form.serializeArray();d.push({name:"form_key",value:c("#tumblr_form_key").attr("content")});c.ajax({url:this.form.attr("action"),type:this.form.attr("method")||"post",data:d,success:_.bind(this.on_success,this)||function(){},error:_.bind(function(){if(_.isFunction(this.on_error)){this.on_error()}Tumblr.Dialog.alert(l10n_str.ajax_error)},this),complete:_.bind(function(){if(!this.options.wait){this.hide()}if(_.isFunction(this.on_complete)){this.on_complete()}},this)});this.on_submit&&this.on_submit();return false}});b.PopoverWithForm=a})(jQuery,Tumblr);
(function(c,a){var b=function(d){return function(g,f){if(!d){return}g=g||{};f=f||{};if(f.init){f.init()}var e=c.ajax({url:d,type:"POST",data:{form_key:c("#tumblr_form_key").attr("content"),data:g}});e.success(function(){if(f.success){f.success()}});e.error(function(){if(f.error){f.error()}else{Tumblr.Dialog.alert(l10n_str.ajax_error)}});e.complete(function(){if(f.complete){f.complete()}});return e}};a.follow=b("/svc/follow");a.unfollow=b("/svc/unfollow");a.like=b("/svc/like");a.unlike=b("/svc/unlike");a.ignore=b("/svc/ignore");a.report=b("/svc/report");a.reply=b("/svc/reply")})(jQuery,Tumblr||{});
(function(c,b){var a=Tumblr.Popover.extend({is_scroll_disabled:false,initialize:function(d){this.options=d||{};Tumblr.Popover.prototype.initialize.apply(this,arguments);this.$container=this.$el.find(".popover_inner");this.$scroll=this.$el.find(".popover_scroll");this.options.disable_infinite_scroll=d.disable_infinite_scroll||false;this.on_load_more=d.on_load_more||function(){};this.scrollbar=null;if(!this.$scroll.length){this.is_scroll_disabled=true}},show:function(){Tumblr.Popover.prototype.show.apply(this,arguments);this.position_vertical();if(Tumblr.PopoverScroll){this.scrollbar=new Tumblr.PopoverScroll(this.$scroll,{on_infinite_scroll:c.proxy(this.load_more,this)})}this.$scroll.attr("tabindex","-1").focus()},hide:function(){if(this.$container){this.$container.css({top:"",height:""})}if(this.$scroll){this.$scroll.css("height","")}if(this.scrollbar){this.scrollbar.destroy();this.scrollbar=null}Tumblr.Popover.prototype.hide.apply(this,arguments)},update:function(){if(this.scrollbar){this.scrollbar.update()}this.position_vertical()},load_more:function(){if(this.is_scroll_disabled||this.options.disable_infinite_scroll){return}this.on_load_more()},position_vertical:function(){if(!this.$container||!this.$scroll){return}var e=50-(this.$container.height()*0.5),f=c(window).height(),h,g,d;this.$container.css("top",(e<15)?e:15);if(this.$scroll.height()>f-80){this.$scroll.css("height",f-80)}d=this.$container.height();h=this.$container.offset().top-c(window).scrollTop(),g=parseInt(this.$container.css("top"),10);if(h<30){g=g-(h-30);this.$container.css("top",(g<15)?g:15)}else{if(h+d>f-30){g=g-((h+d)-f+50);this.$container.css("top",(g>-(d-80))?g:-(d-80))}}if(this.scrollbar){this.scrollbar.update()}}});b.PopoverWithScroll=a})(jQuery,Tumblr);(function(c,a){var b=Tumblr.Popover.extend({events:{click:"click"},initialize:function(d){this.$popover=this.$el;this.popover=this.el},click:function(e){var d=e.target;if(d.id=="modal_alert_accept_button"){this.on_accept()}if(d.id=="modal_alert_cancel_button"){this.on_cancel()}},show:function(){Tumblr.Glass.show(null,"dark");this.$popover.removeClass("belowscreen").removeClass("abovescreen").addClass("up").addClass("modal_is_visible");c(document.body).addClass("popover_alert_active");this.on_show()},hide:function(){Tumblr.Glass.hide();this.$popover.addClass("abovescreen").removeClass("up").removeClass("belowscreen").removeClass("modal_is_visible");c(document.body).removeClass("popover_alert_active");this.on_hide()},cancel:function(){this.on_cancel()},on_accept:function(){this.hide()},on_show:function(){},on_hide:function(){},on_cancel:function(){}});a.Alert=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(){if(!this.$el.length){return}this.popover=new Tumblr.Popover({el:this.$el,on_show:_.bind(function(){this.$el.addClass("show");this.$el.closest("#sidebar_footer_nav").addClass("show_popover");this.close_on_scroll()},this),on_hide:_.bind(function(){this.$el.removeClass("show");this.$el.closest("#sidebar_footer_nav").removeClass("show_popover")},this)});this.popover_button=this.$el.find(".popover_legal_link");this.popover_button.on("click",_.bind(function(d){this.popover.show();return false},this));this.update_position()},update_position:function(){var d=Math.floor(this.popover.popover.outerWidth()/2);this.popover.popover.css({marginLeft:-d+"px"})},close_on_scroll:function(){c(window).on("scroll.legalpopover",_.bind(function(){this.popover.hide();c(window).off("scroll.legalpopover")},this))}});Tumblr.LegalPopover=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#user_tools",events:{"focus #search_query":"focus_search_query","click #popover_tracked_tags .popover_menu_item":"click_popover","submit #search_form":"submit","mouseenter #popover_tracked_tags":"mouseenter"},initialize:function(d){this.options=d||{};this.popover_selector=this.options.popover_selector||"#popover_tracked_tags";this.$search_field=this.$("#search_field");this.$search_form=this.$("#search_form");this.$search_query=this.$("#search_query");this.$popover=this.$(this.popover_selector);this.$tracked_tags=this.$(this.popover_selector+" .tracked_tags");this.$autocomplete_results=this.$(this.popover_selector+" .autocomplete_results");this.popover=new Tumblr.Popover({el:this.$search_query,popover:this.$popover,disable_auto_show:true,on_show:_.bind(function(){this.bind_key_nav()},this),on_hide:_.bind(function(){c("#unread_tag_notice").show();c("#search_query").addClass("with_unread");this.$search_field.removeClass("active");this.unbind_key_nav()},this)});this.setup_autocomplete();this.keyevents={bind_key_down:_.bind(this.keydown,this),bind_key_up:_.bind(this.keyup,this)}},setup_autocomplete:function(){this.auto_complete=new Tumblr.AutoCompleteTags({el:this.$search_query,store:"/svc/tags/featured",popover:this.popover,include:Tumblr.EXISTING_TAGS})},focus_search_query:function(){this.$search_field.addClass("active");this.currentIndex=-1;if(!this.has_children(this.$tracked_tags)&&!this.has_children(this.$autocomplete_results)){return}this.popover.show();this.$("#unread_tag_notice").hide();this.$search_query.removeClass("with_unread")},mouseenter:function(d){if(this.in_popover(this.in_focus())){this.in_focus().blur()}},has_children:function(d){return(d.children().length>0)?true:false},click_popover:function(g){var f=this.$(g.currentTarget);var d=f.find("a").attr("href");if(g.metaKey||g.altKey){window.open(d)}else{window.location=d}this.popover.hide();g.stopPropagation();g.preventDefault()},bind_key_nav:function(){c(document).off("keydown",this.keyevents.bind_key_down);c(document).off("keyup",this.keyevents.bind_key_up);c(document).on("keydown",this.keyevents.bind_key_down);c(document).on("keyup",this.keyevents.bind_key_up)},unbind_key_nav:function(){c(document).off("keyup",this.keyevents.bind_key_up);c(document).off("keydown",this.keyevents.bind_key_down)},next:function(){this.$search_query.blur();this.currentIndex++;this.set_active("next")},previous:function(){this.$search_query.blur();this.currentIndex--;this.set_active("previous")},set_active:function(f){var d=c(this.popover_selector+" .popover_menu_item a").filter(":visible");var e=d.filter(":focus");if(e.length){this.currentIndex=(f==="previous")?d.index(e)-1:d.index(e)+1}if(this.currentIndex>=0&&this.currentIndex<d.length){d.get(this.currentIndex).focus()}else{if(this.currentIndex==-2&&f==="previous"){d.get(d.length-1).focus();this.currentIndex=d.length-1}else{this.currentIndex=-1;this.$search_query.focus()}}},in_focus:function(){return c(document.activeElement)},contains:function(d){return(this.in_popover(d)||this.$search_query.is(d))?true:false},in_popover:function(d){return this.$popover.has(d).length},keyup:function(d){if(d.keyCode===9){if(!this.contains(this.in_focus())){this.popover.hide();this.unbind_key_nav();this.in_focus().blur()}}},keydown:function(d){switch(d.keyCode){case 27:this.$search_query.blur();return;case 38:d.preventDefault();this.previous();break;case 40:d.preventDefault();this.next();break;default:break}},submit:function(d){if(c.trim(this.$search_query.val())===""){return false}return true}});b.TagPopover=a})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{keyup:"keyup"},initialize:function(d){this.options=d||{};this.init=true;this.init_value=this.$el.val();this.related_base_url=this.options.related_url||"/related_tags/";this.threshold=this.options.threshold||1;this.store=this.options.store||[];this.include=this.options.include||[];if(typeof this.store==="string"){this.ajax_store=true}this.popover=this.options.popover;this.$auto_results=b("#popover_tracked_tags .autocomplete_results");this.$tracked=b("#popover_tracked_tags .tracked_tags");this.$related=b("#popover_tracked_tags .related_tags");this.tags_template=b("#autocomplete_tags_template").html();this.related_template=b("#related_tags_template").html()},keyup:_.throttle(function(d){this.lookup()},100),get_store:function(d){if(this.store_cache){if(typeof d==="function"){d.call(this)}return}if(this.store_xhr){this.store_xhr.abort()}this.store_xhr=b.ajax({url:this.store,dataType:"json"});this.store_xhr.done(_.bind(function(e){this.store_cache=this.include_unique(e,this.include,"tag_id","tag");if(typeof d==="function"){d.call(this)}},this))},include_unique:function(j,d,h,e){if(!d.length){return j}if(h){var f=[];_.each(d,function(k){f.push(k[h])});var g=[];_.each(j,function(k){if(_.indexOf(f,k[h])===-1){g.push(k)}});j=b.merge(g,d);j.sort(function(n,l){var m=n[e].toLowerCase();var k=l[e].toLowerCase();if(m<k){return -1}if(m>k){return 1}return 0})}else{j=b.merge(d,j)}return j},lookup:function(){var e=b.trim(this.$el.val());var f=e.length;var d;if(f>=this.threshold&&!this.init&&e!==this.init_value){if(this.ajax_store){this.get_store(_.bind(function(){d=this.filter(this.store_cache,e);this.update(d)},this))}else{d=this.filter(this.store,e);this.update(d)}}else{this.update([])}this.init=false;this.init_value=""},escapeRegex:function(d){return d.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(f,e){var d=new RegExp(this.escapeRegex(e),"i");return b.grep(f,function(g){return d.test(g.tag||g)})},update:function(e){if(e.length){this.popover.show();var d={items:e};var f=_.template(this.tags_template);this.$auto_results.html(f(d));this.$tracked.hide();if(e.length===1){this.get_related(e[0]["tag"])}else{this.$related.empty()}}else{if(this.$tracked.children().length>0){this.$tracked.show()}else{this.popover.hide()}this.$auto_results.empty();this.$related.empty()}},get_related:function(d){var e=encodeURIComponent(d.toLowerCase());if(this.cache[e]){this.update_related(this.cache[e]);return}if(this.xhr){this.xhr.abort()}this.xhr=b.ajax({url:this.related_base_url+e,dataType:"json"});this.xhr.done(_.bind(function(f){this.cache[e]=f;this.update_related(f)},this))},update_related:function(d){if(d.length){var e=_.template(this.related_template);this.$related.html(e({items:d}))}},cache:{}});a.AutoCompleteTags=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({el:"#dashboard_controls_open_blog",events:{"click #popover_button_blogs":"click_popover_button","click #popover_blogs .popover_menu_item":"click_popover_blogs"},initialize:function(){if(c("#popover_blogs").length){this.popover=new Tumblr.Popover({el:this.$("#popover_button_blogs"),popover:this.$("#popover_blogs"),disable_auto_show:true,on_hide:function(){c("#all_channel_count_notice").show()}});this.sortable=new Tumblr.SortableView({el:this.$("#popover_blogs"),items:".item",callback:_.bind(this.save,this),scrollable:true})}},click_popover_button:function(d){if(d.target.id=="open_blog_link"){return}d.stopPropagation();d.preventDefault();this.popover.show();c("#all_channel_count_notice").hide()},click_popover_blogs:function(f){var e=this.$(f.currentTarget);var d=e.find("a").attr("href");if(f.metaKey||f.altKey){window.open(d)}else{window.location=d}this.popover.hide();f.stopPropagation();f.preventDefault()},save:function(e){var d=_.map(e.sequence(),function(f){return f.replace("menuitem-","")});c.ajax({type:"POST",url:"/order",data:"channel_names="+JSON.stringify(d)})}});a.BlogMenu=b})(jQuery,Tumblr);(function(c,b){var a=Tumblr.Popover.extend({events:{click:"toggle","click .popover_menu_item a":"select_language"},initialize:function(){if(!this.$el.length){return}Tumblr.Popover.prototype.initialize.apply(this,arguments);this.update_timezone();this.update_position();this.language_form=this.$el.find("#set_language");this.language_form_type=this.language_form.attr("method");this.language_form_url=this.language_form.attr("action")},show:function(){Tumblr.Popover.prototype.show.call(this);this.$el.closest("#sidebar_footer_nav").addClass("show_popover");this.update_position()},hide:function(){Tumblr.Popover.prototype.hide.call(this);this.$el.closest("#sidebar_footer_nav").removeClass("show_popover")},select_language:function(d){var e=c(d.target);d.preventDefault();c("#language_selected").val(e.attr("data-lang"));c("#language_switcher .current").removeClass("current");if(this.spinner){this.spinner.stop()}else{this.spinner=new Spinner({top:"auto",left:"100%",width:2,radius:3,length:2,color:"#444",className:"language_switcher_spinner"})}this.spinner.spin(e[0]);this.set_language()},set_language:function(){var d=_(this.language_form.serializeArray()).map(function(e){return[e.name,e.value]}).zipObject().value();c.ajax({type:this.language_form_type,url:this.language_form_url,data:d,complete:function(){if(d.redirect_to){window.location=d.redirect_to}else{window.location.reload()}}})},update_position:function(){var d=Math.floor(this.popover.outerWidth()/2);this.popover.css({marginLeft:-d+"px"})},update_timezone:function(){var e=new Date();var g=new Date(e.getFullYear(),0,1,0,0,0,0);var f=new Date(g.toGMTString().replace(/(.*)(\s\S+)/,"$1"));var d=Math.round((g-f)/(1000*60*60));this.$el.removeClass("americas europe_africa asia_pacific");switch(d){case -12:case -11:case -10:case -9:case -8:case -7:case -6:case -4:case -3:case -2:case -1:this.$el.addClass("americas");break;case 0:case 1:case 2:case 3:case 4:case 5:this.$el.addClass("europe_africa");break;case 6:case 7:case 8:case 9:case 10:case 11:case 12:this.$el.addClass("asia_pacific");break;default:this.$el.addClass("americas");break}return d}});b.LanguageMenu=a})(jQuery,Tumblr);(function(c,a){var b=function(d){return function(g,f){if(!d){return}g=g||{};f=f||{};if(f.init){f.init()}var e=c.ajax({url:d,type:"POST",data:{form_key:c("#tumblr_form_key").attr("content"),data:g}});e.success(function(){if(f.success){f.success()}});e.error(function(){if(f.error){f.error()}else{Tumblr.Dialog.alert(l10n_str.ajax_error)}});e.complete(function(){if(f.complete){f.complete()}});return e}};a.follow=b("/svc/follow");a.unfollow=b("/svc/unfollow");a.like=b("/svc/like");a.unlike=b("/svc/unlike");a.ignore=b("/svc/ignore");a.report=b("/svc/report");a.reply=b("/svc/reply")})(jQuery,Tumblr);(function(d,b){function c(){var e=d("body"),g=e.attr("id"),f="dashboard";if(g=="dashboard_posts_likes"){f="likes"}if(g=="tagged_display"){f="tagged"}if(e.hasClass("tablet")){f="tablet"}return a.sources[f]}var a={init:function(){d("#posts").on("click",'.reblog_follow_button:not(".onboard")',function(f){f.stopImmediatePropagation();f.preventDefault();var e=d(this),g=d(document.body);e.addClass("active").addClass("animated").addClass("poof");window.setTimeout(function(){e.addClass("final_state")},1000);Tumblr.follow({tumblelog:e.attr("data-tumblelog-name"),source:c()},{success:function(){var h=d('[href="'+e.attr("data-tumblelog-name")+'"]');h.hide()},error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)}})})},sources:{dashboard:"FOLLOW_SOURCE_REBLOG",tagged:"FOLLOW_SOURCE_REBLOG_TAGGED",likes:"FOLLOW_SOURCE_REBLOG_LIKES",tablet:"FOLLOW_SOURCE_REBLOG_TABLET"}};b.ReblogFollowButtons=a})(jQuery,Tumblr);(function(b,a){var c={init:function(){b("#posts").on("click",".panorama",function(e){if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey){return}var d=b(e.target).closest(".panorama");if(d.hasClass("with_clickthru")&&e.target.className!="zoomer"){return}e.stopImmediatePropagation();e.preventDefault();d.panorama({lightbox:true})})}};a.Panos=c})(jQuery,Tumblr);(function(b,a){a.DashboardLinkPops=Backbone.View.extend({initialize:function(){},el:"#posts",events:{"click a":"run_click"},run_click:function(f){var c=f.currentTarget.href;var d=b(f.currentTarget);if(d.is(".no_pop, .photoset_photo, .photo_exif_flipper, .fan_mail_read_more, .follow")){return}if(self!==top&&d.is(".post_control.reblog, .post_control.edit")){c=c.replace(/\?.*/,"")}else{if(d.closest(".no_pop, .post_controls, #new_post, .controls, .user_menu_list, form, .flash_notification, .more_notes_link").length>0){return}if(!c||c=="#"){return}}f.preventDefault();f.stopPropagation();window.open(c)}})})(jQuery,Tumblr);(function(b,a){a.Elevator=Backbone.View.extend({initialize:function(){this.render();this.return_to_top_visible=false;this.$sidebar_footer_nav=this.$el.find(".pinned_sidebar_footer");Tumblr.Events.on("DOMEventor:flatscroll",this.toggle_elevator,this)},el:"body",events:{"click #return_to_top":"scroll_to_top"},scroll_to_top:function(c){c.preventDefault();b("html, body").animate({scrollTop:0},"slow")},toggle_elevator:function(d){var c=d.windowScrollY;if(c>=1500){if(!this.return_to_top_visible){this.return_to_top_visible=true;this.fade_in()}}else{if(this.return_to_top_visible){this.return_to_top_visible=false;this.fade_out()}}},fade_in:function(){this.$return_to_top.addClass("show");this.$sidebar_footer_nav.addClass("fade_footer");window.setTimeout(_.bind(function(){this.$sidebar_footer_nav.addClass("hide_footer")},this),500)},fade_out:function(){this.$return_to_top.removeClass("show");this.$sidebar_footer_nav.removeClass("fade_footer");window.setTimeout(_.bind(function(){this.$sidebar_footer_nav.removeClass("hide_footer")},this),0)},render:function(){b("#return_to_top").remove();this.$return_to_top=b("<a>",{"class":"return_to_top",href:"#",id:"return_to_top"}).css({transform:"translateZ(0)"}).append(b("<div>",{"class":"return_to_top_icon"})).appendTo(this.$el)}})})(jQuery,Tumblr);(function(c,b){var a={white:{lines:16,length:11,width:4,radius:17,color:"#ffffff",speed:0.9,trail:34,shadow:false,hwaccel:false,className:"tumblr_default_spinner spinner",zIndex:2000000000,top:"50",left:"auto"}};b.spinners=a})(jQuery,Tumblr);(function(d,b){var c=Tumblr.PopoverWithForm.extend({initialize:function(e){this.submit_button=this.$("button");this.textarea=this.$("form textarea");this.check_form_state();this.textarea.on("input",_.bind(this.check_form_state,this));this.textarea.on("keyup",_.bind(this.check_form_state,this));_.extend(this.options,{on_hide:this.on_hide});Tumblr.PopoverWithForm.prototype.initialize.apply(this,arguments)},check_form_state:function(){this.submit_button.attr("disabled",this.textarea[0].value.length===0)},on_hide:function(){this.$el.removeClass("active")},on_submit:function(){this.submit_button.attr("disabled",true);this.submit_button.html(this.submit_button.data("label-loading"))},on_success:function(){this.$el.addClass("already_reply");this.$el.find("button").attr("disabled",false);this.$el.find("textarea").val("");this.submit_button.html(this.submit_button.data("label"));var e=this.$el.parents(".post");if(e.hasClass("promotion_pinned")&&!e.hasClass("is_mine")){d.ajax({url:"/unpin",type:"post",data:{post_id:e.attr("id").replace("post_",""),form_key:d("#tumblr_form_key").attr("content")}})}}});var a={init:function(){var e={};d("#posts").on("click",".reply_button",function(f){if(f.target!=f.currentTarget){return}f.stopPropagation();f.preventDefault();var g=f.currentTarget.id;if(!e[g]){e[g]=new c({el:d(f.target)})}d(f.currentTarget).addClass("active");e[g].show()})}};b.ReplyPopover=c;b.ReplyButtons=a})(jQuery,Tumblr);(function(c,a){var d=Backbone.View.extend({initialize:function(){this.$post=this.$el.closest(".post")},clicked:function(){if(this.$el.closest(".logged_out").length||this.$el.data("reblogged")){return}this.reblog();this.$el.addClass("animated").addClass("collapse_reblog_button");window.setTimeout(_.bind(function(){this.$el.addClass("final_state")},this),1000)},reblog:function(){this.$el.data("reblogged",1);c.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:this.$el.attr("data-reblog-key"),reblog_post_id:this.$el.attr("data-reblog-id"),form_key:this.$el.attr("data-user-form-key")},success:_.bind(function(){this.$el.addClass("reblogged");if(this.$post.hasClass("promotion_pinned")&&!this.$post.hasClass("is_mine")){this.unpin()}},this),error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)},complete:function(){}})},unpin:function(){c.ajax("/unpin",{type:"post",data:{post_id:this.$post.id().replace("post_",""),form_key:c("#tumblr_form_key").attr("content")}})}});var b={init:function(){var e={};c("#posts").on("click",".reblog_button",function(f){if(!f.altKey||f.target!=f.currentTarget){return}f.stopPropagation();f.preventDefault();new d({el:c(f.target)}).clicked()})}};a.ReblogButtons=b})(jQuery,Tumblr);(function(d,a){var c=Tumblr.Popover.extend({events:function(){return _.defaults({"click .share_email":"__email_click","click .share_facebook":"__share_facebook_click","click .share_twitter":"__share_twitter_click","input .email_address":"__email_input","keyup .email_address":"__email_input","click .cancel":"__cancel_click","input .twitter .share_message":"__twitter_input","keyup .twitter .share_message":"__twitter_input"},Tumblr.Popover.prototype.events)},__email_click:function(f){f.preventDefault();this.toggle_email_form()},__email_input:function(f){if(this.validate_email(this.$email_address.val())){this.$submit_button.attr("disabled",false)}else{this.$submit_button.attr("disabled",true)}},__twitter_input:function(f){f.preventDefault();if(this.validate_twitter(this.$share_message.val())){this.$submit_button.attr("disabled",false)}else{this.$submit_button.attr("disabled",true)}},__cancel_click:function(f){f.preventDefault();this.cancel_or_close()},__share_facebook_click:function(f){f.preventDefault();f.stopPropagation();if(this.$share_to_facebook){this.toggle_facebook_form()}else{this.facebook_fallback()}},__share_twitter_click:function(f){f.preventDefault();f.stopPropagation();if(this.$twitter_username){this.toggle_twitter_form()}else{window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(this.$tiny_url),"twitter-share-dialog","width=626,height=258");this.popover.hide();this.on_hide()}},_placeholder_support:function(){var e=document.createElement("input");return("placeholder" in e)},initialize:function(e){this.options=e||{};_.extend(this.options,{on_hide:this.on_hide});Tumblr.Popover.prototype.initialize.apply(this,arguments);this.$share_form=this.$(".share_form");this.$share_label=this.$(".share_label");this.$reply_to=this.$(".reply_to");this.$share_form.submit(_.bind(this.submit_share_form,this));this.$share_options=this.$(".share_options");this.$submit_button=this.$("button");this.$email_address=this.$(".email_address");this.$share_message=this.$(".share_message");this.$character_count=this.$(".character_count");this.$service_cancel=this.$(".cancel.service");this.$status=this.$(".status");this.$error_status=this.$(".error_status");this.$status_message=this.$(".status_message");this.$sent_text=this.$status.data("sent");this.$error_text=this.$status.data("error");if(d(".share_twitter")){this.$twitter_username=d(".share_twitter").data("twitter-username")}if(d(".share_facebook")){this.$share_to_facebook=d(".share_facebook").data("has-facebook")}this.$post_url=this.$share_options.data("post-url");this.$tiny_url=this.$share_options.data("post-tiny-url");this.placeholder_supported=this._placeholder_support()},submit_share_form:function(){var e="/svc/email_post";switch(this.$share_form.data("type")){case"facebook":e="/svc/share_to_facebook";break;case"twitter":e="svc/share_to_twitter";break}var f=this.$share_form.serializeArray();f.push({name:"form_key",value:d("#tumblr_form_key").attr("content")});d.ajax({url:e,type:"post",data:f,success:_.bind(function(){this.on_success(this.$share_form)},this)||function(){},error:_.bind(function(g){this.on_error(g)},this)});this.on_submit(this.$submit_button);return false},on_hide:function(){this.reset_and_hide()},on_submit:function(){this.$submit_button.attr("disabled",true);this.$submit_button.html(this.$submit_button.data("label-sending"))},on_success:function(){this.$status.show();this.flyaway_popup()},on_error:function(f){this.$error_status.html(this.$error_text);this.$submit_button.html(this.$submit_button.data("label"));this.$submit_button.attr("disabled",false);this.$error_status.addClass("active")},flyaway_popup:function(){this.popover.addClass("flyaway");setTimeout(d.proxy(function(){this.popover.removeClass("flyaway").hide();this.on_hide()},this),1000)},fadeout_popup:function(e,f){setTimeout(_.bind(function(){this.popover.fadeOut(150,_.bind(function(){this.on_hide()},this))},this),1250)},toggle_email_form:function(){this.$submit_button.html("Send");this.$share_form.data("type","email");this.$share_options.toggleClass("active");this.$share_form.toggleClass("active");this.$reply_to.addClass("active");if(this.$share_form.hasClass("active")&&this.placeholder_supported){this.$email_address.focus()}},toggle_facebook_form:function(){d.ajax({url:"/svc/facebook_status",type:"post",data:{form_key:d("#tumblr_form_key").attr("content")},success:_.bind(this.facebook_success,this),error:_.bind(this.facebook_fallback,this)})},facebook_success:function(e){if(e){this.$service_cancel.show();this.$submit_button.html("Share");this.$share_form.data("type","facebook");this.$share_label.text(e);this.$submit_button.attr("disabled",false);this.$share_form.addClass("facebook");this.$share_options.toggleClass("active");this.$share_form.toggleClass("active");if(this.$share_form.hasClass("active")&&this.placeholder_supported){this.$share_message.focus()}}else{this.facebook_fallback()}},facebook_fallback:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(this.$post_url),"facebook-share-dialog","width=626,height=436");this.popover.hide();this.on_hide()},toggle_twitter_form:function(e){this.$service_cancel.show();this.$submit_button.html("Tweet");this.$share_form.data("type","twitter");this.$share_label.text("@"+this.$twitter_username);this.$share_message.val(" [URL]");this.$share_form.addClass("active");this.$share_options.removeClass("active");this.$share_message.get(0).setSelectionRange(0,0);this.validate_twitter(this.$share_message.val());this.$share_message.attr("placeholder","");this.$submit_button.attr("disabled",false);this.$share_form.addClass("twitter");if(this.$share_form.hasClass("active")&&this.placeholder_supported){this.$share_message.focus();this.$share_message.get(0).setSelectionRange(0,0)}},resets:function(){this.$service_cancel.hide();this.$submit_button.html(this.$submit_button.data("label"));this.$submit_button.attr("disabled",true);this.$email_address.val("");this.$share_message.val("");this.$share_message.attr("placeholder","Message (Optional)");this.$share_options.addClass("active");this.$share_form.removeClass("active");this.$share_form.removeClass("facebook");this.$share_form.removeClass("twitter");this.$status.hide();this.$status_message.html(this.$sent_text);this.$reply_to.removeClass("active");this.$error_status.removeClass("active")},reset_and_hide:function(){this.resets();this.$el.removeClass("active")},cancel_or_close:function(){if(this.$share_form.data("type")==="email"&&this.$email_address.val().length){this.$email_address.val("");this.$submit_button.attr("disabled",true)}else{this.resets()}},validate_email:function(f){var e=/\S+@\S+\.\S+/;return e.test(f)},validate_twitter:function(h){var g=h.match(/\[URL\]/ig);var e=(g)?(g.length*24):0;var f=140-h.length-e;this.$character_count.html(f);if(f<10){this.$character_count.css("color","#d95e40")}else{if(f<20){this.$character_count.css("color","#444444")}else{this.$character_count.css("color","#bbbbbb")}}if(f<0||f==140){return false}return true}});var b={init:function(){var e={};d("#posts").on("click",".share_social_button",function(g){var f=d(g.currentTarget);var h=d(g.currentTarget).attr("id");if(!e[h]){e[h]=new c({el:f,wait:true,directional:true,no_autofocus:true})}f.addClass("active");e[h].show()})}};a.ShareButtons=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({events:{"click .retro_video_preview":"show_video","click .hide_inline_video":"hide_video"},show_video:function(g){var f=c(g.currentTarget);var d=f.data("id");if(c("#video_preview_"+d).is(":visible")){c("#video_embed_"+d).html(c("#video_code_"+d).val());c("#video_preview_"+d).hide();c("#watch_video_"+d).show()}this.track_view(true);return false},hide_video:function(g){var d=c(g.currentTarget);var f=d.data("id");if(!c("#video_preview_"+f).is(":visible")){c("#video_embed_"+f).html("");c("#video_preview_"+f).show();c("#watch_video_"+f).hide()}return false},track_view:function(d){if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","click",d?"static":"normal"])}}});a.VideoThumbnails=b})(jQuery,Tumblr);(function(c,b){var a=function(e,d){if(!(this instanceof a)){return new a(e,d)}this.el=(typeof e==="string")?c(e).get(0):e;this.$el=c(e);this.options=d;if(this.$el.data("resizeAnchor")){return this.$el.data("resizeAnchor")}this.$el.data("resizeAnchor",this);this.metadata=this.$el.data("plugin-options");this.config=c.extend({},a.defaults,this.options,this.metadata);this.config.resize=this.$el.css("resize")||"both";if(this.config.create_container){this.$container=c("<div/>").addClass(this.config.container_class).insertBefore(this.$el);this.$container.append(this.$el);this.$clearfix=c("<div/>").addClass(this.config.clearfix_class).insertAfter(this.$container)}this.$anchor=c("<span/>").attr({onclick:"return false;",tabindex:-1}).addClass(this.config.anchor_class).insertAfter(this.$el);this.anchor_visibility();this.resize_start=c.proxy(this._resize_start,this);this.resize_move=c.proxy(this._resize_move,this);this.resize_end=c.proxy(this._resize_end,this);this.$anchor.on("mousedown",this.resize_start);this.$parent=c(window);a.register(this);return this};a.prototype={__event_position:function(f){var d,g;d=f.pageX;g=f.pageY;return{x:d,y:g}},_resize_start:function(d){this.start_width=this.$el.outerWidth();this.start_height=this.$el.outerHeight();this.start_position=this.__event_position(d);this.$parent.on("mousemove",this.resize_move);this.$parent.on("mouseup",this.resize_end);d.preventDefault()},_resize_move:function(d){this.current_position=this.__event_position(d);switch(this.config.resize){case"vertical":this.set_height(this.current_position.y-this.start_position.y+this.start_height);break;case"horizontal":this.set_width(this.current_position.x-this.start_position.x+this.start_width);break;case"both":this.set_size(this.current_position.x-this.start_position.x+this.start_width,this.current_position.y-this.start_position.y+this.start_height);break;case"none":break}},_resize_end:function(d){this.$parent.off("mousemove",this.resize_move);this.$parent.off("mouseup",this.resize_end)},anchor_visibility:function(){if(this.config.resize==="none"){this.$anchor.hide()}else{this.$anchor.show()}},set_width:function(d){this.$el.css("width",Math.max(0,d))},set_height:function(d){this.$el.css("height",Math.max(0,d))},set_size:function(e,d){this.$el.css({width:Math.max(0,e),height:Math.max(0,d)})},destroy:function(){this.$anchor.remove();if(this.config.create_container){this.$el.insertBefore($container);this.$container.remove();this.$clearfix.remove()}}};a.instances=[];a.defaults={container_class:"resize_textarea_container",clearfix_class:"resize_textarea_clearfix",anchor_class:"resize_textarea_anchor",create_container:true};a.register=function(d){this.instances.push(d)};a.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy()}};c.fn.resizeanchor=function(d){return this.each(function(){new a(this,d)})};b.ResizeAnchor=a})(jQuery,Tumblr);(function(c,a){var b=function(f,d){if(!(this instanceof b)){return new b(f,d)}this.el=(typeof f==="string")?c(f).get(0):f;this.$el=c(f);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=c.extend({},b.defaults,this.options,this.metadata);var e=parseInt(this.$el.css("lineHeight"),10);this.minHeight=this.oldHeight=(this.config.minHeight)?this.config.minHeight:this.$el.height();this.maxHeight=(this.config.maxHeight)?this.config.maxHeight:false;this.padder=e;this.$el.css("min-height",this.minHeight);this.$el.each(c.proxy(function(g){this.create_shadow(g)},this));this.events={__input:c.proxy(this.__input,this),__mouseup:c.proxy(this.__mouseup,this)};this.$el.on("input",this.events.__input);this.$el.on("mouseup",this.events.__mouseup);this.update(this.$el);b.register(this);return this};b.prototype={__input:function(f){var d=c(f.currentTarget);this.update(d)},__mouseup:function(f){var d=c(f.currentTarget);this.oldHeight=d.outerHeight();if(this.oldHeight>=this.maxHeight){this.maxHeight=this.oldHeight}},create_shadow:function(d){this.$shadow=(c("."+this.config.shadowClass).length)?c("."+this.config.shadowClass):c("<div/>",{"class":this.config.shadowClass});this.$shadow.css({position:"absolute",top:-10000,left:-10000,width:this.$el.width(),fontSize:this.$el.css("fontSize"),fontFamily:this.$el.css("fontFamily"),fontWeight:this.$el.css("fontWeight"),lineHeight:this.$el.css("lineHeight")}).appendTo(document.body)},replace_value:function(d){return d.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>")},update:function(d){var f=this.replace_value(d.val());this.$shadow.css("width",this.$el.width());this.$shadow.html(f);var e=Math.max(this.$shadow.height()+this.padder,this.oldHeight);if((this.maxHeight&&(e<this.maxHeight))||!this.maxHeight){this.$el.css("height",e)}else{this.$el.css("height",this.maxHeight)}},destroy:function(){this.$shadow.remove();this.$el.off("input",this.events.__input);this.$el.off("mouseup",this.events.__mouseup)}};b.instances=[];b.defaults={shadowClass:"autoexpand_shadow",minHeight:false,maxHeight:400};b.register=function(d){this.instances.push(d)};b.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy()}};c.fn.autoexpand=function(d){return this.each(function(){new b(this,d)})};a.AutoExpand=b})(jQuery,Tumblr);(function(b,a){var c=function(e,d){if(!(this instanceof c)){return new c(e,d)}this.el=(typeof e==="string")?b(e).get(0):e;this.$el=b(e);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=b.extend({},c.defaults,this.options,this.metadata);if(this.config.event){this.config.events=this.config.event}if(this.config.selector){this.config.child_selector=this.config.selector}this.$relay_targets=b(this.$el.find(this.config.child_selector)).add(b(this.config.global_selector));this.$el.addClass(this.config.relay_class);this.$relay_targets.addClass(this.config.target_class);this.relay=b.proxy(this.__relay,this);this.events={};b.each(this.config.events.split(","),b.proxy(function(f,g){this.add_event(g)},this));this.$el.data("eventRelayObject",this);c.register(this);return this};c.prototype={__relay:function(d){if(this.__is_relay_element(d)){d.stopPropagation();this.$relay_targets.not(d.target).trigger(d)}},__is_relay_element:function(d){return this.$el.is(d.currentTarget)},add_event:function(d){this.events[d]=true;this.$el.on(d,this.relay)},remove_event:function(d){this.events[d]=false;this.$el.off(d,this.relay)},destroy:function(d){b.each(this.events,b.proxy(function(f){this.remove_event(f)},this));if(!d){c.unregister(this)}}};c.defaults={events:"click",child_selector:false,global_selector:false,relay_class:"click_relay",target_class:"click_relay_target"};c.instances=[];c.register=function(d){this.instances.push(d)};c.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};c.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy(true)}this.instances=[]};b.fn.eventrelay=function(d){return this.each(function(){new c(this,d)})};a.EventRelay=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({defaults:{password:"#signup_password",email:"#signup_email",tumblelog:"#signup_username"},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options);this.$password_meter=c("#password_strength_meter");this.$password=c(this.options.password);this.$email=c(this.options.email);this.$tumblelog=c(this.options.tumblelog);if(!this.$password.length){return}this.class_name="password_strength_meter";this.password_meter_markup='<div class="password_strength_meter inactive" id="password_strength_meter"><strong class="l5"></strong><strong class="l4 l5"></strong><strong class="l3 l4 l5"></strong><strong class="l2 l3 l4 l5"></strong><strong class="l1 l2 l3 l4 l5"></strong></div>';this.render();this.test_password();this.$password.on("keydown keyup focus blur",_.throttle(_.bind(function(e){if(this.last_checked!==this.get_password()){this.test_password(e)}},this),250))},render:function(){if(!this.$password_meter.length){this.$password.after(this.password_meter_markup);this.$password_meter=c("#password_strength_meter")}},set_inactive:function(){this.$password_meter.addClass("inactive")},set_active:function(){this.$password_meter.removeClass("inactive")},set_level:function(d){this.set_active();switch(d){case 1:this.$password_meter[0].className=this.class_name+" level_1";break;case 2:this.$password_meter[0].className=this.class_name+" level_2";break;case 3:this.$password_meter[0].className=this.class_name+" level_3";break;case 4:this.$password_meter[0].className=this.class_name+" level_4";break;case 5:this.$password_meter[0].className=this.class_name+" level_5";break;default:this.$password_meter[0].className=this.class_name;break}},test_password:function(d){this.last_checked=this.$password.val();if(!d||!this.$password.val().length){this.set_inactive();return}this.get_password_strength()},update:function(){this.test_password()},get_email:function(){return this.$email.val()},get_password:function(){return this.$password.val()},get_username:function(){return this.$tumblelog.val()},get_form_data:function(){var d={};d.username=this.get_username();d.email=this.get_email();d.password=this.get_password();return d},get_password_strength:function(){if(this.pw_xhr){this.pw_xhr.abort()}this.pw_xhr=c.ajax({url:"/svc/account/validation",dataType:"json",type:"POST",data:this.get_form_data()});this.pw_xhr.done(_.bind(function(d){var e=d.score||0;this.set_level(e);this.block_registration_step=(d.reject_reason)?d.reject_reason:false;delete this.pw_xhr},this))}});Tumblr.PasswordStrengthMeter=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(d){this.options=d||{};if(typeof this.$el=="undefined"||this.$el.length===0||this.$el.find("leviathan").length!==0){this.remove();return false}this.uid=Math.floor(Math.random()*10000);this.$el.append(this.html());this.$loader=c(".leviathan.loader_"+this.uid);this.center();this.$u1=c("i.unum",this.$loader);this.$u2=c("i.duo",this.$loader);this.$u3=c("i.tres",this.$loader);this.ti=null;this.t1=null;this.t2=null;this.t3=null},start:function(){clearInterval(this.ti);var d=_.bind(function(){this.t1=this.rise(this.$u1,300,0);this.t2=this.rise(this.$u2,300,100);this.t3=this.rise(this.$u3,300,200)},this);d();this.ti=setInterval(_.bind(function(){clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3);d()},this,d),600);this.$loader.show()},stop:function(){this.$loader.hide();clearInterval(this.ti);clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3)},destroy:function(){this.stop();this.unbind();this.$loader.remove();this.remove()},center:function(){var e=this.$el.width();var d=this.$el.height();var g=this.$loader.width();var f=this.$loader.height();var j=(e/2)-(g/2);var h=(d/2)-(f/2);this.$loader.css({left:j,top:h})},rise:function(e,f,d){if(typeof e=="undefined"||e.length===0){return}return setTimeout(function(){e.stop(true,true).animate({height:"28px",opacity:1,marginTop:"0px"},f).animate({height:"20px",opacity:0.5,marginTop:"4px"},f)},d)},html:function(){return'<div class="loader_'+this.uid+' leviathan"><i class="unum"></i><i class="duo"></i><i class="tres"></i></div>'}});a.PillLoader=b})(jQuery,Tumblr);(function(b,a){a.ReportTumblelogView=Backbone.View.extend({el:"#report_tumblelog_bar",events:{"click .spam":"report_spam","click .harassment":"report_harassment","click .dismiss":"dismiss",mouseenter:"delay_dismiss",mouseleave:"timeout_dismiss"},initialize:function(c){a.Events.on("block_tumblelog",_.bind(this.block_tumblelog,this))},block_tumblelog:function(c){if(c.can_report){this.tumblelog=c.tumblelog;this.animate_in();this.timeout_dismiss()}},animate_in:function(){this.$el.find("#report_tumblelog_with_name").show();this.$el.find("#report_tumblelog_name").html(this.tumblelog);this.$el.fadeIn(300)},report_spam:function(c){var d=this.tumblelog;a.report({tumblelog:d,reason:"1"}).done(function(){a.Events.trigger("report_tumblelog",{tumblelog:d,reason:"spam"})}).always(_.bind(function(){this.dismiss()},this))},report_harassment:function(c){var d=this.tumblelog;a.report({tumblelog:d,reason:"2"}).done(function(){a.Events.trigger("report_tumblelog",{tumblelog:d,reason:"harassment"})}).always(_.bind(function(){this.dismiss()},this))},dismiss:function(c){this.$el.fadeOut(300,_.bind(function(){this.$el.find("#report_tumblelog_name").html("");this.$el.find("#report_tumblelog_with_name").hide()},this))},timeout_dismiss:function(c){c=c||3000;clearTimeout(this.dismissTimeout);this.dismissTimeout=setTimeout(_.bind(function(){this.dismiss()},this),3000)},delay_dismiss:function(c){clearTimeout(this.dismissTimeout)}})})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({initialize:function(){this.$no_posts_found=b(".no_posts_found");this.$left_column=b("#left_column");this.$right_column=b("#right_column");if(this.$no_posts_found.length&&this.$left_column.length&&this.$right_column.length){if(this.$right_column.css("min-height")!="0px"){return}var e=this.$left_column.height(),d=this.$right_column.height(),g=0,f="+";if(e<d){f="+";g=d-e}else{if(e>d){f="-";g=e-d;if(g>=50){g=0}}}this.center_padding(g,f)}},center_padding:function(d,f){if(d>0&&(f=="+"||f=="-")){var e=d/2;this.$no_posts_found.css("padding-top",f+"="+e).css("padding-bottom",f+"="+e)}}});a.FullHeightNoPostsFound=c})(jQuery,Tumblr);(function(g,f){AutoPaginator={start:function(){k=3;Tumblr.Events.on("DOMEventor:flatscroll",h)},stop:function(){loading_next_page=false;Tumblr.Events.off("DOMEventor:flatscroll",h)}};_.extend(AutoPaginator,Backbone.Events);var k=3;loading_next_page=false;function h(n){if(!next_page){if(g("#auto_pagination_loader").is(":visible")){g("#auto_pagination_loader").hide()}AutoPaginator.stop();return}if(loading_next_page){return}if((n.documentHeight-n.windowScrollY)<n.windowHeight*3){loading_next_page=true;a();AutoPaginator.trigger("before",next_page);g("#auto_pagination_loader_loading").show();g("#auto_pagination_loader_failure").hide();d()}}function d(){k--;var n=g.ajax({url:next_page,type:"get"});n.done(function(p){c(p);var o=n.getResponseHeader("X-next-page");if(o){next_page=o}else{next_page=p.match('id="next_page_link" href="')?p.split('id="next_page_link" href="')[1].split('"')[0]:false;if(!next_page){AutoPaginator.stop();g("#auto_pagination_loader_loading").hide()}}});n.fail(function(){if(k){d()}else{j()}})}function c(p){if(p.indexOf('<script type="text/javascript" language="javascript" src="http://assets.tumblr.com/languages/errors.js')!==-1){AutoPaginator.stop();return false}var o;if(p.indexOf("<!-- START POSTS -->")===-1){o=p}else{o=p.split("<!-- START POSTS -->")[1].split("<!-- END POSTS -->")[0]}var n=g(g.trim(o)).not(":empty");g("#posts").append(n);Tumblr.Events.trigger("DOMEventor:updateRect");b();loading_next_page=false;setTimeout(function(){if(typeof window.after_auto_paginate=="function"){after_auto_paginate()}e();AutoPaginator.trigger("after",next_page)},0)}function j(){AutoPaginator.stop();g("#auto_pagination_loader_loading").hide();g("#auto_pagination_loader_failure").show()}function b(){next_page=next_page.replace(/https?:\/\/.*?\//,"/");if(next_page.indexOf("/dashboard")===0){next_page=next_page.substring(0,next_page.lastIndexOf("/"))}if(window._gaq!==undefined){try{var n=tumblr_custom_tracking_url?tumblr_custom_tracking_url:next_page;if(n.match(/^\/dashboard/)){n="/dashboard/*"}if(n.match(/^\/tagged/)){n="/tagged/*"}if(n.match(/^\/search/)){n="/search/*"}_gaq.push(["_trackPageview",n])}catch(o){Tumblr.Utils.exceptions(o)}}try{if(window._qevents&&window.__qc){__qc.qpixelsent=[];_qevents.push({qacct:"p-19UtqE8ngoZbM"})}}catch(o){Tumblr.Utils.exceptions(o)}if(typeof(COMSCORE)!=="undefined"){try{COMSCORE.beacon({c1:"2",c2:"15742520"})}catch(o){Tumblr.Utils.exceptions(o)}}}var l=[];function a(){for(var n=l.length-1;n>=0;n--){if(typeof(l[n])==="function"){l[n]()}}}var m=[];function e(){for(var n=m.length-1;n>=0;n--){if(typeof(m[n])==="function"){m[n]()}}}f.AutoPaginator=AutoPaginator;window.BeforeAutoPaginationQueue=l;window.AfterAutoPaginationQueue=m})(jQuery,Tumblr);(function(g,f){var l={init:function(){_.each(j,function(m,n){l.add(false,m)});c()},add:h};var b=[],d=[],a=false,k=("https:"==document.location.protocol?"https://secure.assets.tumblr.com":"http://assets.tumblr.com"),j=[k+"/images/inline_photo_loading.gif",k+"/images/black_75.png",k+"/images/white_80.png",k+"/images/loading_reblog.gif"];function h(o,m,n){if(typeof n=="undefined"){n=false}d.push([o,m,n])}function e(){for(i=d.length-1;i>=0;i--){var p=d[i][0];var m=d[i][1];var o=d[i][2];if(p===false){img_obj=new Image();img_obj.src=m;b.push(img_obj)}else{var n=document.getElementById(p);if(!n){continue}if(o=="bg"){n.style.backgroundImage="url("+m+")"}else{if(o=="src"){n.src=m}}}d.splice(i,1)}}function c(){if(a){return true}a=window.setInterval(function(){if(typeof(d)!="undefined"&&d.length){e()}},500)}f.ImagePreloader=l;window.add_to_image_queue=h;window.process_image_queue=e;window.start_processing_image_queue=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({el:"#right_column",events:{"mousedown li":"on_mousedown"},on_mousedown:function(e){var d=this.$(e.currentTarget);if(d.length&&!d.hasClass("item")&&!d.hasClass("no_push")){this.$(".selected").removeClass("selected");d.addClass("selected")}}});a.PushButtons=b})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{"click .post_content img":"toggle"},toggle:function(k){var g=this.$(k.currentTarget).parents(".post_content");var f=g.find(".toggle_inline_image");f.toggleClass("inline_image");var h=g.find(".inline_external_image");_.each(h,_.bind(this.toggle_external,this));var j=g.find(".image_thumbnail");if(j.length){this.toggle_thumbnail(j)}var d=g.find(".photo_info");if(d.length){d.toggleClass("hidden")}},toggle_thumbnail:function(d){if(d.hasClass("enlarged")){d.removeClass("enlarged");d.attr("width",d.data("thumbnail-width"));d.attr("height",d.data("thumbnail-height"))}else{d.addClass("enlarged");d.attr("width",d.data("width"));d.attr("height",d.data("height"))}},toggle_external:function(f){var g=this.$(f);var d=g.attr("external_src");if(g.hasClass("enlarged")){g.attr("src",g.attr("original_src"));g.removeClass("enlarged")}else{g.attr("original_src",g.attr("src"));g.addClass("enlarged");if(g.attr("loader")){g.attr("src",g.attr("loader"))}var e=new Image();e.onload=function(){g.attr("src",d)};e.src=d}}});a.PhotoThumbnails=c})(jQuery,Tumblr);(function(d,a){var c=Backbone.View.extend({ignore:function(g){g.preventDefault();d("body").addClass("dialog_open");var j=this.tumblelog;var h=a.TumblelogActions.confirm_ignore({tumblelog:j,avatar_url:d(g.delegateTarget).find(".avatar").attr("src")});h.done(function(){a.ignore({tumblelog:j,source:"IGNORE_SOURCE_NOTIFICATION"});a.Events.trigger("block_tumblelog",{tumblelog:j,can_report:true})});return false}});var e=c.extend({events:{"click .block":"ignore","mousedown .notification_inner":"before_notification_click","mouseup .notification_inner":"after_notification_click","click .notification_inner":"notification_click","click .notification_follow_button":"notification_follow","click .photo_reply_image":"notification_photo_reply_image","mouseenter .notification .block":"notification_block_hover","mouseleave .notification .block":"notification_block_hover","mouseenter .control":"control_hover_in","mouseleave .control":"control_hover_out"},initialize:function(){this.tumblelog=this.$el.find("a.block").attr("data-tumblelog");a.Events.on("block_tumblelog",_.bind(this.tumblelog_block,this));if(this.$el.find("a.block").length){this.$el.addClass("can_ignore")}},tumblelog_block:function(g){if(this.tumblelog==g.tumblelog){this.$el.addClass("ignored").addClass("no_active").addClass("no_hover").removeClass("can_ignore");this.$el.find(".block").remove();this.$el.unbind()}},update:function(){this.$el.find(".notification .notification_text").each(function(h,j){var g=d(j);if(g.find("a").length>1){g.addClass("underline_links")}});this.$el.find(".notification a.block").each(function(h,j){var g=d(j);g.closest(".notification").addClass("can_ignore")})},before_notification_click:function(h){var g=d(h.target);if(g.is(".photo_reply_image")||g.is(".photo_reply_image_container")){this.$el.addClass("no_active")}},after_notification_click:function(h){var g=d(h.target);if(g.is(".photo_reply_image")||g.is(".photo_reply_image_container")){this.$el.removeClass("no_active")}},notification_click:function(j){var g=d(j.target);if(!g.is("a")&&!g.is(".photo_reply_image_container")){j.stopPropagation();j.preventDefault();var h=this.$el.find(".notification_target").attr("href");if(!h&&this.$el.find("a").length===1){h=this.$el.find("a").attr("href")}if(h){window.open(h)}}},notification_follow:function(h){h.stopPropagation();h.preventDefault();var g=d(h.target);var j=d(h.currentTarget);j.addClass("animated").addClass("poof");window.setTimeout(_.bind(function(){j.parent().remove();this.$el.removeClass("has_follow");j.addClass("final_state")},this),1000);a.follow({tumblelog:j.attr("data-tumblelog-name"),source:"FOLLOW_SOURCE_DASHBOARD_NOTIFICATION"},{success:function(){var k=d('[href="'+j.attr("data-tumblelog-name")+'"]');k.hide()},error:function(){a.Dialog.alert(l10n_str.ajax_error)}})},notification_photo_reply_image:function(h){var g=d(h.target);h.stopPropagation();h.preventDefault();a.Lightbox.init([{high_res:g.attr("src"),low_res:g.attr("src"),width:500}])},notification_block_hover:function(h){var g=this.$el.find(".notification_inner")},control_hover_in:function(g){this.$el.addClass("control_hover")},control_hover_out:function(g){this.$el.removeClass("control_hover")}});a.Notifications=Backbone.View.extend({el:"#posts",events:{"click .notification_dismiss":"notification_dismiss"},initialize:function(){AfterAutoPaginationQueue.push(_.bind(this.updateViews,this));this.updateViews();this.$el.find(".notification .notification_text").each(function(h,j){var g=d(j);if(g.find("a").length>1){g.addClass("underline_links")}})},updateViews:function(){this.$el.find(".notification:not([data-view-exists])").each(function(j,k){var h=d(k);if(!h.attr("data-view-exists")){var g=new e({el:k});h.attr("data-view-exists",true)}})},notification_dismiss:function(k){k.stopPropagation();k.preventDefault();var h=d(k.target);var n=h.parents(".notification");var m=n.data("cookie");if(m){m=m.split("|");var j=m[0]||"";var l=m[1]||"";var o=parseInt(m[2],10)||null;if(j){set_cookie(j,l,o)}}var g=n.data("ajax");if(g){d.get(g)}n.css("display","none")}});var b=c.extend({events:{"click a.block":"ignore"},initialize:function(){this.tumblelog=this.$el.attr("data-tumblelog");a.Events.on("block_tumblelog",_.bind(this.tumblelog_block,this))},tumblelog_block:function(g){if(this.tumblelog==g.tumblelog){this.$el.addClass("ignored").addClass("no_active").addClass("no_hover").removeClass("can_ignore");this.$el.find(".block").remove();this.$el.unbind()}}});a.NoteView=b;var f=b.extend({events:function(){return _.extend({},b.prototype.events,{click:"note_click",mouseenter:"note_hover",mouseleave:"note_out","mouseenter .avatar_frame":"note_img_hover","mouseleave .avatar_frame":"note_img_out","mouseleave .block":"note_img_out",mousedown:"note_down",mouseup:"note_up"})},note_down:function(h){var g=d(h.target);if(!g.is("a")&&!g.is("img")){this.$el.addClass("active")}},note_up:function(g){this.$el.removeClass("active")},note_hover:function(g){this.$el.addClass("hover")},note_out:function(g){this.$el.removeClass("hover").removeClass("active")},note_img_hover:function(g){this.$el.removeClass("hover")},note_img_out:function(g){this.$el.addClass("hover")},note_click:function(k){var h=d(k.target);var g=d(k.currentTarget);if(!h.is("a")&&!h.is("img")){k.stopPropagation();k.preventDefault();var j=g.find(".action").attr("data-post-url");window.open(j)}}});a.ReblogNoteView=f;a.Notes=Backbone.View.extend({initialize:function(){},el:"#posts",loading_notes:false,events:{"click .post_control.reblog_count":"toggle_notes","click .more_notes_link_container":"more_notes"},create_note_views:function(g){g.find(".note:not([data-view-exists])").each(function(j,l){if(d(l).hasClass("reblog")){var k=new f({el:l})}else{var h=new b({el:l})}d(l).attr("data-view-exists",true)})},toggle_notes:function(g){g.preventDefault();if(this.loading_notes){return}this.loading_notes=true;$link=d(g.currentTarget);$post=$link.closest(".post");$note_outer_container=$post.find(".notes_outer_container");$note_container=$post.find(".notes_container");$notes=$post.find(".notes");$note_outer_container.show();$note_container.show();if($notes.is(":visible")){this.loading_notes=true;$notes.slideUp(300,_.bind(function(){this.loading_notes=false},this));return}if($link.attr("data-notes-loaded")){this.animate_in($notes);return}this.load_notes($post.attr("data-post-id"),$post.attr("data-tumblelog-key"),{},_.bind(function(h){$link.attr("data-notes-loaded",true);$notes.append(d(h).html());this.animate_in($notes);$note_outer_container.find(".notes_control").hide();this.create_note_views($notes)},this))},animate_in:function(g){this.loading_notes=true;g.slideDown(300,_.bind(function(){this.loading_notes=false},this))},more_notes:function(g){g.preventDefault();$more_container=d(g.currentTarget);$link=$more_container.find(".more_notes_link");$post=$more_container.closest(".post");$notes=$post.find(".notes");$loading=$post.find(".notes_loading").show();$link.hide();this.load_notes($post.attr("data-post-id"),$post.attr("data-tumblelog-key"),{from_id:$link.attr("data-next")},_.bind(function(h){$more_container.remove();$notes.find(".last_note").removeClass("last_note");$notes.append(d(h).html());this.create_note_views($notes)},this))},load_notes:function(g,l,j,k){var h="/dashboard/notes/"+g+"/"+l;if(j.from_id){h+="?from_c="+j.from_id}d.ajax(h).done(k)}})})(jQuery,Tumblr);(function(b,a){Tumblr.PostControls=Backbone.View.extend({initialize:function(){},el:"#posts",events:{"click .post_control.block_link":"ignore","click .post_control.publish_post":"publish"},ignore:function(h){var g=b(h.currentTarget);var f=g.data("message");var d=g.data("tumblelog-name");var c=g.data("tumblelog-hash");Tumblr.Dialog.confirm(f,_.bind(function(){Tumblr.ignore({tumblelog:d,source:"IGNORE_SOURCE_POST"});Tumblr.remove_tumblelog_posts(c)},this));return false},publish:function(g){var f=b(g.currentTarget);var d=f.data("message");var c=f.data("post-id");Tumblr.Dialog.confirm(d,_.bind(function(){b("#publish_post_"+c).submit()}));return false}})})(jQuery,Tumblr);(function(c,a){var b={validate_tumblelog_name:function(d){return !(/^-|-$|[^\-a-z0-9]|tumblr/i).test(d)},has_starting_hyphen:function(d){return(/^-/).test(d)},has_ending_hyphen:function(d){return(/-$/).test(d)},clean_tumblelog_name:function(d){return d.toLowerCase().replace(/[^\-a-z0-9]/g,"-").replace(/^-+|-+$/g,"").replace(/tumblr/gi,"")}};a.BlogNameHelper=b})(jQuery,Tumblr);(function(c,a){var b={show:function(g){this.hide();var e="/send?lightbox=true";if(g&&g.href){e=g.href;e+=(e.indexOf("?")!==-1?"&":"?")+"lightbox=true"}var d=c('<div id="send_fan_mail_lightbox_loader"></div>');d.css({zIndex:4294967294,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent url('/images/fan_mail/grid_bg_lightbox.png?709') center"});d.html('<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent center no-repeat url(\'/images/loading_big_fff_on_2e3133.gif?709\')"><img style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0.3;" src="/images/full_page_vignette.png?709"/></div>');c("body").append(d);var f=c('<iframe id="send_fan_mail_lightbox" scrolling="no" border="0" frameBorder="0"/>');f.attr("src",e);f.css({zIndex:4294967294,display:"none",position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent",overflow:"hidden"});f.load(function(){c("#send_fan_mail_lightbox_loader").hide();c("#send_fan_mail_lightbox").show()});c("body").append(f)},hide:function(){c("#send_fan_mail_lightbox").hide().remove();c("#send_fan_mail_lightbox_loader").hide().remove()},sending:function(){c("#send_fan_mail_lightbox").hide().load(function(d){c("#send_fan_mail_lightbox_loader").hide();c("#send_fan_mail_lightbox").show()});c("#send_fan_mail_lightbox_loader").show()},make_url_from_tumblelog:function(d){return"/send/"+d}};a.FanMail=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"mouseover .post_footer_links .tags":"mouseover","mousedown .post_footer_links .tags.draggable":"mousedown",mousemove:"mousemove"},initialize:function(){c("body").on("mouseup",_.bind(this.mouseup,this))},mouseover:function(h){var j=this.$(h.currentTarget);var g=j.parents(".post_footer_links");var f=g.width();var d=g.find(".source_url").width();this.max_width=f;if(d){this.max_width=f-d+8}if(j.width()>this.max_width){j.addClass("draggable")}h.preventDefault();h.stopPropagation()},mousedown:function(d){this.$dragging=this.$(d.currentTarget).addClass("dragging");this.mouse_down_left=d.offsetX||d.clientX-this.$(d.currentTarget).offset().left;d.preventDefault();d.stopPropagation()},mousemove:function(d){if(this.$dragging){this.$dragging.offset({left:d.pageX-this.mouse_down_left});d.preventDefault();d.stopPropagation()}},mouseup:function(g){if(this.$dragging==null){return}this.$dragging.removeClass("dragging");var f=parseInt(this.$dragging.css("left"),10);var d=this.$dragging.width();if(f>0||f<this.max_width-d){this.$dragging.animate({left:"0"})}this.$dragging=null;g.preventDefault();g.stopPropagation()}});b.DraggableTags=a})(jQuery,Tumblr);(function(e,c){function d(j,k,m){var g=(m==null)?e("#like_form_"+j):e("#"+m),h;if(!g.length){return}h=g.attr("action");if(typeof k=="undefined"){f(j)}else{k()}var l=e.ajax({url:h,data:g.serialize(),type:"post"});l.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)})}function f(k){var l=e("#like_button_"+k);var h=e("#like_form_"+k);var g=l.hasClass("already_like");var j=h.attr("action");e("#post_"+k).addClass("force_redraw");e("#post_"+k)[0].offsetHeight;e("#post_"+k).removeClass("force_redraw");var m=l.attr("data-root-post-id")||false;if(g){l.removeClass("already_like");h.attr("action",j.replace("/unlike","/like"));a(k);if(m){e(".like_root_"+m).removeClass("already_like")}}else{l.addClass("already_like");h.attr("action",j.replace("/like","/unlike"));b(k);if(m){e(".like_root_"+m).addClass("already_like")}}}function b(g){if(!(e("#notes_outer_container_"+g)[0]&&e("#show_notes_link_"+g)[0]&&e("#note_link_more_"+g)[0]&&e("#note_link_less_"+g)[0]&&e("#note_link_current_"+g)[0])){return false}e("#show_notes_link_"+g).show();if(e("#note_link_less_"+g).is(":visible")){e("#note_link_less_"+g).hide();e("#note_link_current_"+g).show();e("#note_link_more_"+g).hide()}else{e("#note_link_less_"+g).hide();e("#note_link_current_"+g).hide();e("#note_link_more_"+g).show()}}function a(g){if(!(e("#show_notes_link_"+g)[0]&&e("#note_link_more_"+g)[0]&&e("#note_link_less_"+g)[0]&&e("#note_link_current_"+g)[0])){return false}e("#show_notes_link_"+g).show();if(e("#note_link_more_"+g).is(":visible")){e("#note_link_less_"+g).hide();e("#note_link_current_"+g).show();e("#note_link_more_"+g).hide()}else{e("#note_link_less_"+g).hide();e("#note_link_current_"+g).hide();e("#note_link_less_"+g).show()}}c.like_post=d;window.increment_note_count=b;window.decrement_note_count=a})(jQuery,Tumblr);(function(c,a){function b(e){c("#answer_form_"+e+" [name=redirect_to]").remove();var g="#answer_container_"+e,f=c(g)[0],m=f.children[0].className,l=c("#answer_text_"+e)[0],k=f.querySelector(".answer_avatar").outerHTML,j=c("#answer_form_"+e).serialize();if(!l.value){return}increment_note_count(e);c(f).addClass("updating");l.disabled=true;var h=c.ajax({url:"/answer",data:j,type:"post"});h.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)});h.done(function(n){setTimeout(function(){f.innerHTML='<div class="'+m+'">'+k+' <span class="answer_body">'+l.value.replace("<","&lt;")+"</span></div>";c(f).addClass("updated")},500)})}var d=Backbone.View.extend({el:"#posts",events:{"keyup .answer_form .answer_input":"keyup","submit .answer_form":"submit"},keyup:function(f){this.answer_input=c(f.currentTarget);this.answer_form=this.answer_input.closest(".answer_form");this.answer_length_label=this.answer_form.find(".answer_length");this.answer_input_value=this.answer_input.val();if(this.answer_input_value.length){this.answer_length_label.html(141-this.answer_input_value.length)}else{this.answer_length_label.html()}},submit:function(g){g.preventDefault();g.stopPropagation();var f=c(g.currentTarget).attr("data-post-id");if(f){b(f)}}});a.AnswerPost=d})(jQuery,Tumblr);(function(c,a){function b(e){var d=c(".post_tumblelog_"+e);d.fadeOut(500,function(){d.remove()})}a.remove_tumblelog_posts=b})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{"click #logout_button":"logout",},logout:function(j){var h=b(j.currentTarget);var g=b("a",h);var f=h.data("message");var d=g.attr("href");if(_.isObject(Tumblr.Dialog)){Tumblr.Dialog.confirm(f,_.bind(function(){window.location.href=d}));return false}}});a.Header=c})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"click .photo_exif_flipper":"flip"},flip:function(d){d.preventDefault();d.stopPropagation();$el=c(d.currentTarget).parents(".flipcard");$el.addClass("initialized");_.defer(function(){$el.toggleClass("reveal_back")})}});b.ExifFlipcards=a})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"click .share_private":"toggle"},toggle:function(g){g.preventDefault();var d=c(g.currentTarget).parents("li").attr("data-post-id");var f=c("#share_"+d);f.toggle()}});b.SharePrivatePost=a})(jQuery,Tumblr);(function(b,a){a.documentWidth=function(c){if(!c){c=b(document).width()}Tumblr.Cookie.set("documentWidth",c,24*60*60)}})(jQuery,Tumblr);(function(b,a){a.devicePixelRatio=function(){Tumblr.Cookie.set("devicePixelRatio",window.devicePixelRatio,24*60*60)}})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"#dashboard_controls_open_blog .activity .count",initialize:function(g){if(this.$el.length){var d=this.$el.data("sparkline");if(typeof(this.$el.sparkline)=="function"){try{if(typeof(d)!=="object"){throw"sparkline is not an object"}if(_.max(d)===0){throw"sparkline has no interesting data"}this.$el.sparkline(d,{type:"line",lineColor:"#748696",fillColor:false,lineWidth:4,chartRangeMin:0,spotColor:false,minSpotColor:false,maxSpotColor:false,disableInteraction:true,width:"72px",height:"30px"});this.$el.find("canvas").css({height:"15px",width:"36px"});return}catch(f){}}}}});a.ActivitySparkline=c})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"body",defaults:{username_input:"#signup_username"},events:{"click #suggested_usernames .popover_menu_item":"handle_click"},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options)},handle_click:function(d){b(this.options.username_input).val(d.target.innerHTML).focus();b("#used_suggestion").val(1);b("#suggested_usernames_container").addClass("hidden")}});a.UsernameSuggester=c})(jQuery,Tumblr);(function(c,b){var a={confirm:function(f){var e=c.Deferred();f=f||{};if(!f.tumblelog){return e.reject()}var d=f.avatar_url||"/images/anonymous_avatar_96.png";if(d&&!d.match(/96\.png/)){d=d.replace(/_(\d\d.?)\.png/,"_96.png")}var h=function(){e.resolve();c("body").removeClass("dialog_open")};var g=function(){e.reject();c("body").removeClass("dialog_open")};Tumblr.Dialog.confirm({text:f.confirm_text||"",text_ok:f.text_ok||Tumblr.Dialog.__("Ok"),text_cancel:Tumblr.Dialog.__("Nevermind"),callback_ok:h,callback_cancel:g,templates:{content:'<div class="avatar_image" style="background-image: url('+d+');"><div class="avatar_frame"></div></div><span class="text"><%= text %></span>'}});return e.promise()},confirm_ignore:function(g){if(!g.tumblelog){var f=c.Deferred();return f.reject()}var d="",e=g.tumblelog.match(/post\_id\:/);if(e){d=l10n_str.confirm_block_this_person}else{d=l10n_str.confirm_block.replace("%1$s","<strong>"+g.tumblelog+"</strong>")}g.confirm_text=d;g.text_ok=Tumblr.Dialog.__("Ignore");return this.confirm(g)},confirm_unfollow:function(e){if(!e.tumblelog){var d=c.Deferred();return d.reject()}e.confirm_text=Tumblr.Dialog.__("Confirm_Unfollow").replace("%1$s","<strong>"+e.tumblelog+"</strong>");e.text_ok=Tumblr.Dialog.__("Unfollow");return this.confirm(e)}};b.TumblelogActions=a})(jQuery,Tumblr);jQuery(document).ready(function(a){Tumblr.LinkButton.init();Tumblr.PhotoReply.init();Tumblr.ReblogFollowButtons.init();Tumblr.Panos.init();Tumblr.ReplyButtons.init();Tumblr.ReblogButtons.init();Tumblr.ShareButtons.init();Tumblr.ImagePreloader.init();Tumblr.PlaceHolders.init();Tumblr.DOMEventor.init();Tumblr.Lib.AJAXWithFormKey();new Tumblr.Header({el:"#header"});new Tumblr.VideoThumbnails({el:a("#posts")});new Tumblr.PhotoThumbnails({el:a("#posts")});new Tumblr.BlogMenu();new Tumblr.DashboardLinkPops();new Tumblr.LanguageMenu({el:"#language_switcher"});new Tumblr.LegalPopover({el:"#popover_legal"});new Tumblr.ReportTumblelogView();new Tumblr.FullHeightNoPostsFound();new Tumblr.PushButtons();new Tumblr.Notifications();new Tumblr.DraggableTags();new Tumblr.ExifFlipcards();new Tumblr.AnswerPost();new Tumblr.SharePrivatePost();new Tumblr.Notes();new Tumblr.PostControls();new Tumblr.ActivitySparkline();new Tumblr.devicePixelRatio();new Tumblr.documentWidth()});
(function(c,a){var b=function(d){if(!(this instanceof b)){return new b(d)}this.token=d.token||"";if(d.instance){this.instance=d.instance;this.$instance=c(d.instance)}this.hide_timeout=null;this.transition_class=null;this.$hide_timeout=null;b.register(this)};b.prototype={create:function(e,f){f=f||{};var d=c(e);this.$instance=c("<div/>",{"data-token":this.token,"class":"plexi"});this.instance=this.$instance.get(0);if(f.cssClass){this.$instance.addClass(f.cssClass)}d.append(this.$instance)},show:function(d){d=d||{};this.transition_class=d.transition_class||false;if(!this.$instance.hasClass("instant")){this.$instance.addClass("active")}setTimeout(c.proxy(function(){clearTimeout(this.$hide_timeout);if(this.transition_class){this.$instance.addClass(this.transition_class)}this.$instance.addClass("show");if(!this.$instance.hasClass("instant")){this.$instance.addClass("active")}},this),1)},hide:function(){this.$instance.removeClass("show");this.$hide_timeout=setTimeout(c.proxy(function(){this.$instance.removeClass("show instant active fast");if(this.transition_class){this.$instance.removeClass(this.transition_class)}},this),50)},destroy:function(){b.instances.splice(_.indexOf(this),1);return this}};b.instances=[];b.register=function(d){this.instances.push(d)};b.findByToken=function(f){var d;for(var e=0;e<this.instances.length;e++){if(this.instances[e].token==f){d=this.instances[e]}}if(!d){var h=c('.plexi[data-token="'+f+'"]');if(h.length){var g=new Tumblr.Plexi({instance:h,token:f});this.instances.push(g);return g}}return d};a.Plexi=b})(jQuery,Tumblr);
(function(c,b){var a=Backbone.View.extend({initialize:function(d){this.options=d||{};d.items||(d.items=".item");this.callback=d.callback||function(){};this.before=d.before||function(){};this.placeholder=null;this.on_dragenter=_.throttle(this.on_dragenter,500);this.reloadItems()},events:function(){var d=this.options.items;var e=_(["dragstart","dragenter","dragover","drop","dragend"]).reduce(function(f,g){f[g+" "+d]="on_"+g;return f},{});return _.extend(e,{})},on_dragstart:function(f){f.originalEvent.dataTransfer.effectAllowed="move";try{f.originalEvent.dataTransfer.setData("text/html","foo")}catch(d){}this.dragged=f.currentTarget;this.placeholder=c(this.dragged).clone().addClass("sortable-placeholder");if(!this.options.no_opacity){this.placeholder.css("opacity","0").find("*").css("opacity","0")}this.placeholder=this.placeholder.get(0);this.$(this.dragged).addClass("sortable-dragging");this.before.call(this);this.trigger("dragstart",this);if(this.options.scrollable){this.$el.on("dragover."+this.cid,_.throttle(function(k){var i=0.2;var h=window.innerHeight;var g=k.originalEvent.clientY/h;var j=this.getBoundingClientRect();if(g<i&&j.top<0){window.scrollBy(0,-((i-g)*200))}else{if(g>(1-i)){window.scrollBy(0,((i+g-1)*200))}}k.preventDefault()},50));this.$(this.dragged).one("dragend",_.bind(function(){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))},this))}},on_dragenter:function(h){if(!this.dragged){return}h.preventDefault();var g=h.currentTarget;if(g==this.placeholder){return}this.$(this.dragged).hide();var d=this.$(g).index(this.options.items);var f=this.$(this.placeholder).index(this.options.items);if(f<d){this.$(g).after(this.placeholder)}else{this.$(g).before(this.placeholder)}this.last_droppable=g},on_dragover:function(d){if(!this.dragged){return}d.preventDefault()},on_drop:function(d){if(!this.dragged){return}d.stopPropagation();this.$(this.dragged).insertAfter(this.placeholder);return false},on_dragend:function(d){this.$(this.dragged).removeClass("sortable-dragging").show();this.$(this.placeholder).detach();d.stopPropagation();this.callback(this);this.trigger("dragend",this);this.dragged=null;this.last_droppable=null},sequence:function(){var d=this.$(this.options.items).toArray();return _.uniq(_.pluck(d,"id"))},reloadItems:function(){this.items=this.$(this.options.items);this.items.attr("draggable",true);this.items.find("a").attr("draggable",false);this.items.find("img").attr("draggable",false);return this},teardown:function(){this.undelegateEvents();if(this.options.scrollable){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))}this.items.add("a, img",this.items).removeAttr("draggable");this.options.items=this.items=null;this.options.callback=this.callback=null;this.options.before=this.before=null;this.on_dragenter=null;return this}});b.SortableView=a})(jQuery,Tumblr);
(function(c,b){var a=Backbone.View.extend({el:"#toaster",debug_mode:false,defaults:{max_toast:5,toast_padding:623,away_speed:350,close_buttons:false,queue_heartbeat:1000,pause_on_hover:true,only_when_footer_hidden:true,token:null},default_toast:{id:null,type:"text",on_create:false,on_destory:false,animation:true,message:" ",img1:{url:null,badge:" ",is_link:false,href:"#"},img2:{url:null,badge:" ",is_link:false,href:"#"},icon:{type:"regular",href:"#"},notification:{object:null,title:"",body:"",icon:false},is_link:false,href:"#",position_class:"toast_only",close:false,expires:7023,in_queue:false},toast_count:0,toasts:{},desk_notify_support:false,page_visible:true,transition_support:true,is_ipad:false,toast_ids:[],queue_ids:[],paused:false,t_paused:null,unpause_expires:2000,t_queue_heartbeat:null,toast_padding_mult:0,push_lock:false,time_until_lock:50,t_push_lock:null,footer_overlaps:false,templates:{text:'<li id="toast_<%- id %>" class="toast toast_text <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="txt"><%= message %></span></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>',image_text:'<li id="toast_<%- id %>" class="toast toast_image_text <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="frame box_left <%- img1.badge %>"><% if (img1.is_link === true) { %><a href="<%- img1.href %>" target="_blank"><% } %><img src="<%- img1.url %>" width="28" height="28" /><% if (img1.is_link === true) { %></a><% } %></span><span class="txt"><%= message %></span></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>',image_text_image:'<li id="toast_<%- id %>" class="toast toast_image_text_image <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="frame box_left <%- img1.badge %>"><% if (img1.is_link === true) { %><a href="<%- img1.href %>" target="_blank"><% } %><img src="<%- img1.url %>" width="28" height="28" /><% if (img1.is_link === true) { %></a><% } %></span><span class="txt"><%= message %></span><span class="frame box_right <%- img2.badge %>"><% if (img2.is_link === true) { %><a href="<%- img2.href %>" target="_blank"><% } %><img src="<%- img2.url %>" width="28" height="28" /><% if (img2.is_link === true) { %></a><% } %></span></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>',image_text_icon:'<li id="toast_<%- id %>" class="toast toast_image_text_icon <%- position_class %>"><span class="toast_border"><span class="toast_outer"><span class="toast_inner"><% if (is_link === true) { %><a class="anchor" href="<%- href %>" target="blank"></a><% } %><span class="frame box_left <%- img1.badge %>"><% if (img1.is_link === true) { %><a href="<%- img1.href %>" target="_blank"><% } %><img src="<%- img1.url %>" width="28" height="28" /><% if (img1.is_link === true) { %></a><% } %></span><span class="txt"><%= message %></span><a class="frame box_right icon <%= icon.type %>" href="<%- icon.href %>"><span class="inside icon <%= icon.type %>"></span></a></span></span><% if (close === true) { %><span class="close"></span><% } %></span></li>'},events:{mouseover:"hover_in",mouseout:"hover_out"},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options);this.debug_order=0;if(this.options.only_when_footer_hidden){this._sidebar_hide_helpers()}if(window.webkitNotifications||window.Notification){this.desk_notify_support=true}c('<style type="text/css"> #toaster .toast .toast_border { background-color: '+c("body").css("background-color")+" !important; } </style>").appendTo("head");var e=document.createElement("div").style;this.transition_support="transition" in e||"WebkitTransition" in e||"MozTransition" in e||"msTransition" in e||"OTransition" in e;this.is_ipad=(navigator.userAgent.match(/iPad/i)===null)?false:true;this._queue_heartbeat();this._add_visibility_helper();return this},debug:function(d){this.debug_mode=d;console.log("Debug mode is now "+(d?"on":"off")+".")},tumblrbot:function(e){var d={type:"image_text",message:"<strong>"+e+"</strong>",is_link:false,href:"#",img1:{url:"/images/toast_tumblrbot.png",is_link:true,href:"http://tumblrbot.tumblr.com/"}};this.add_toast(d)},can_display_toasts:function(){var d=c(window);if(d.innerHeight()<400||d.innerWidth()<960){return false}return this.page_visible},footer_will_overlap:function(){if(this.options.only_when_footer_hidden){return this.footer_overlaps}return false},is_screen_full:function(){return(this.toast_ids.length>=this.options.max_toast)},is_screen_empty:function(){return(this.toast_ids.length===0)},is_queue_empty:function(){return(this.queue_ids.length===0)},_queue_heartbeat:function(){clearTimeout(this.t_queue_heartbeat);var d=function(){if(this.is_queue_empty()||!this.is_screen_empty()){this._queue_heartbeat()}else{this.push_lock=true;var g=this.queue_ids.length;this.toast_padding_mult=0;for(var e=0;e<=g;e++){if((e<this.options.max_toast)&&(e<g)){var f=this.queue_ids[0];this.queue_ids.splice(0,1);this.toast_ids.push(f);this._delayed_add_toast_to_dom(f,(this.toast_padding_mult*this.options.toast_padding));this.toast_padding_mult++}else{break}}this._queue_heartbeat()}};this.t_queue_heartbeat=setTimeout(_.bind(d,this),this.options.queue_heartbeat)},_delayed_add_toast_to_dom:function(f,d){var e=setTimeout(_.bind(function(){this._add_toast_to_dom(f)},this),d)},_add_next_queue_item:function(){if(!this.is_queue_empty()){var d=this.queue_ids[0];this.queue_ids.splice(0,1);this.toast_ids.push(d);this._add_toast_to_dom(d);this._queue_heartbeat()}},add_toast:function(d){var e={};jQuery.extend(e,this.default_toast,d);this._toast(e)},_toast:function(e){var f=this.toast_count++;var d=(this.push_lock||!this.is_queue_empty()||this.is_screen_full());if(d){this.queue_ids.push(f)}else{if(this.toast_ids.length===0){this.toast_padding_mult=0}this.toast_ids.push(f)}e=jQuery.extend(e,{id:f});var g=this._get_toast_template(e.type);$toast=c(g(e));this.toasts[f]={id:f,$el:$toast,options:e,in_queue:d,t:null};if(!d){setTimeout(_.bind(function(){this._add_toast_to_dom(f)},this),(this.toast_padding_mult*this.options.toast_padding));this.toast_padding_mult++;clearTimeout(this.t_push_lock);this.t_push_lock=setTimeout(_.bind(function(){this.push_lock=true;this.toast_padding_mult=0},this),this.time_until_lock)}return f},_add_toast_to_dom:function(d){if(this.footer_will_overlap()||!this.can_display_toasts()||typeof this.toasts[d]==="undefined"){this._nuke_toast(d);return}this.toasts[d].t=this._set_toast_timeout(d);this.$el.append(this.toasts[d].$el);if(this.transition_support){setTimeout(_.bind(function(){this._update_position_helpers()},this),200)}else{this._update_position_helpers()}c("#toast_"+d).addClass("animation");setTimeout(function(){c("#toast_"+d).addClass("slide_open")},50);this._measure_helpers(d);this._click_helpers(d)},_sidebar_hide_helpers:function(){var e=c("#right_column");if(e.length!==1){return}var f=e.outerWidth();var d=e.outerHeight();setInterval(_.bind(function(){var p=c(window).innerHeight();var n=window.pageYOffset;var m=n+p;var o=e.offset();var k=o.top;var h=o.top+d;if((n+(p/2.5))<h){this.footer_overlaps=true;for(var l=this.toast_ids.length-1;l>=0;l--){this.pop_toast(this.toast_ids[l])}for(var g=this.queue_ids.length-1;g>=0;g--){this._nuke_toast(this.queue_ids[g])}this._queue_heartbeat()}else{this.footer_overlaps=false}},this),800)},_measure_helpers:function(d){$txt=c("#toast_"+d+" .txt");if($txt.length>0){var e=$txt.height();if(e>0&&e<=20){$txt.addClass("nowrap")}}},_click_helpers:function(d){$anchor=c("#toast_"+d+" .anchor");if($anchor.length>0){$anchor.on("mousedown",function(){c("#toast_"+d).addClass("toast_active")});$anchor.on("click, mouseup, mouseleave",function(){c("#toast_"+d).removeClass("toast_active")})}},reset_all_timeouts:function(){c.each(this_toast_ids,_.bind(function(e,d){this._set_toast_timeout(d)},this))},set_all_timeouts:function(d){c.each(this.toast_ids,_.bind(function(f,e){this.toasts[e].t=this._set_custom_toast_timeout(e,d)},this))},hover_in:function(){if(this.is_ipad){return}clearTimeout(this.t_paused);if(!this.paused){this._clear_all_timeouts()}this.paused=true;this.$el.addClass("hover")},hover_out:function(){if(this.is_ipad){return}this.t_paused=setTimeout(_.bind(function(){this.paused=false;this.$el.removeClass("hover");c.each(this.toast_ids,_.bind(function(f,e){var d=this.unpause_expires+(f*this.options.toast_padding);this.toasts[e].t=this._set_custom_toast_timeout(e,d)},this))},this),150)},pop_toast:function(e){if(this.debug_mode||typeof this.toasts[e]==="undefined"){return}clearTimeout(this.toasts[e].t);var d=jQuery.inArray(e,this.toast_ids);this.toast_ids.splice(d,1);delete this.toasts[e];this._freeze_toast(e);this._animate_away(e);this._update_position_helpers();if(this.can_display_toasts()&&!this.footer_will_overlap()&&(this.toast_ids.length==(this.options.max_toast-1))){this._add_next_queue_item()}else{this._queue_heartbeat()}clearTimeout(this.t_push_lock);if(this.is_screen_empty()){this.push_lock=false}},_nuke_all_toast:function(){c.each(this.toasts,_.bind(function(e,d){this._nuke_toast(d.id)},this));this._queue_heartbeat()},_nuke_toast:function(e){var d=jQuery.inArray(e,this.toast_ids);if(d!==-1){this.toast_ids.splice(d,1)}var f=jQuery.inArray(e,this.queue_ids);if(f!==-1){this.queue_ids.splice(f,1)}if(d!==-1||f!==-1){clearTimeout(this.toasts[e].t);delete this.toasts[e];var g=c("#toast_"+e);if(g.length>0){g.remove()}}this._update_position_helpers();return},_clear_all_timeouts:function(){c.each(this.toast_ids,_.bind(function(e,d){clearTimeout(this.toasts[d].t)},this))},_animate_away:function(e){var d=c("#toast_"+e);if(d.length===0){return}c("#toast_"+e).addClass("fade_out");setTimeout(function(){c("#toast_"+e).remove()},(this.options.away_speed+15))},_freeze_toast:function(d){var l=c("#toast_"+d);if(l.length===0){return}var e=l.position();var j=c("#toaster").height();var h=l.outerHeight();var i=l.width();var k=l.height();var g=e.top;var f=e.left;l.css({position:"absolute",bottom:(j-h)+"px",left:f+"px",width:i,height:k})},_get_toast_template:function(d){return _.template(this.templates[d])},_toast_expire:function(d){this.pop_toast(d)},_add_visibility_helper:function(){var g,h,f={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(g in f){if(f.hasOwnProperty(g)&&g in document){h=f[g];break}}if(h){document.addEventListener(h,e)}else{if(c.browser.msie&&(parseInt(c.browser.version,10)<=9)){document.onfocusin=document.onfocusout=e}else{window.onfocus=window.onblur=e}}var d=this;function e(j){var i=document.body;j=j||window.event;if(j.type=="focus"||j.type=="focusin"){d.page_visible=true}else{if(j.type=="blur"||j.type=="focusout"){d.page_visible=false}else{d.page_visible=this[g]?false:true}}}},_set_toast_timeout:function(d){if(typeof this.toasts[d]!="object"){return null}return this._set_custom_toast_timeout(d,this.toasts[d].options.expires)},_set_custom_toast_timeout:function(f,d){if(typeof this.toasts[f]!="object"){return null}clearTimeout(this.toasts[f].t);var e=function(){this._toast_expire(f)};return setTimeout(_.bind(e,this),d)},_update_position_helpers:function(){var f=0;var d=0;for(var e=this.toast_ids.length-1;e>=0;e--){if(c("#toast_"+this.toast_ids[e]).is(":visible")){d++}}c.each(this.toast_ids,function(h,g){$this_toast=c("#toast_"+g);if($this_toast.length>0){$this_toast.removeClass("toast_only toast_top toast_bottom toast_middle");if(d==1){$this_toast.addClass("toast_only")}else{if(f===0){$this_toast.addClass("toast_top")}else{if(f===(d-1)){$this_toast.addClass("toast_bottom")}else{$this_toast.addClass("toast_middle")}}}f++}})}});b.Toaster=a})(jQuery,Tumblr);(function(c,a){var b=Backbone.Model.extend({translations:{},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},_helper_icon_target_type:function(d){return d.target_post_type},_helper_media_url:function(d){return d.media_url},_helper_from_tumblelog_link:function(d){var e=d.from_tumblelog_name;if(d.from_tumblelog_name.length>14){e=d.from_tumblelog_name.substr(0,14)+"..."}return'<a href="'+d.from_tumblelog_url+'" target="_blank">'+e+"</a>"},_helper_other_user_badge:function(d){var e=d.type;if(e==="answer"){e="reply"}if(e==="photo_reply"){e="reply"}return e},_helper_blockquote:function(d){return"<blockquote>"+d+"</blockquote>"},_helper_is_empty:function(d){return(d==="")},_helper_has_reply:function(d){if((typeof d.quote_summary=="string")&&!this._helper_is_empty(d.quote_summary)){return true}else{return false}},_helper_summary_txt:function(d){if((typeof d.summary=="string")&&!this._helper_is_empty(d.summary)){return": <em>"+d.summary+"</em>"}else{return""}},_helper_post_noun:function(d){return d.noun_type=="question"?"post":d.noun_type},_base_other_user_action:function(d){var g={img1:{url:d.from_tumblelog_avatar,badge:this._helper_other_user_badge(d),is_link:true,href:d.from_tumblelog_url}};var f={};if(d.type=="follower"||d.type=="user_mention"){f={type:"image_text"}}else{if(d.type=="photo_reply"){f={type:"image_text_image",img2:{url:d.photo_reply_url,is_link:true,href:d.target_post_url}}}else{if(d.target_post_type=="photo"){f={type:"image_text_image",img2:{url:this._helper_media_url(d),is_link:true,href:d.target_post_url}}}else{f={type:"image_text_icon",icon:{type:this._helper_icon_target_type(d),href:d.target_post_url}}}}}var e={};jQuery.extend(e,g,f);return e},notification_center_convert:function(f,d){var e={type:"image_text",message:"<strong>"+f+"</strong>",is_link:true,href:d.url,img1:{url:d.tumblelog.avatar,is_link:true,href:d.tumblelog.url}};return e},like:function(d){var e=this._base_other_user_action(d);var g="%1$s liked your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},reblog:function(d){var e=this._base_other_user_action(d);var g="%1$s reblogged your "+this._helper_post_noun(d);g+=this._helper_has_reply(d)?" and added:":"";g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));if(this._helper_has_reply(d)){g+=this._helper_blockquote(d.quote_summary)}var f={message:g,is_link:true,href:d.new_post_url};jQuery.extend(f,e);return f},answer:function(d){var e=this._base_other_user_action(d);var g="%1$s answered your question";g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d)+this._helper_blockquote(d.answer_text);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},reply:function(d){var e=this._base_other_user_action(d);var g="%1$s replied to your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d)+this._helper_blockquote(d.reply_text);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},photo_reply:function(d){var e=this._base_other_user_action(d);var g="%1$s replied to your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},follower:function(d){var e=this._base_other_user_action(d);var g="%1$s started following %2$s";if(this.has("primary_tumblelog")){if(this.get("primary_tumblelog")==d.target_tumblelog_name){g="%1$s started following you"}}g=this.__(g);g=g.replace("%1$s",this._helper_from_tumblelog_link(d));g=g.replace("%2$s",d.target_tumblelog_name);var f={message:g,is_link:true,href:d.from_tumblelog_url};jQuery.extend(f,e);return f},user_mention:function(d){var f=this._base_other_user_action(d);var i=this._helper_post_noun(d);var e=i=="audio"?"an":"a";var h="%1$s mentioned %2$s in "+e+" "+i;h=this.__(h);h=h.replace("%1$s",this._helper_from_tumblelog_link(d));h=h.replace("%2$s",d.target_tumblelog_name);var g={message:h,is_link:true,href:d.new_post_url};jQuery.extend(g,f);return g}});a.ToastKit=new b()})(jQuery,Tumblr);(function(c,a){var b=Backbone.Model.extend({enabled:true,debug_mode:false,poll_route:"/svc/poll",is_sleeping:false,total_sleep_heartbeats:0,total_empty_heatbeats:0,hash_history:{},use_hash_history:true,visibility_check:2000,i_visibility_check:null,is_window_visible:true,defaults:{toast_mode:0,primary_tumblelog:false,start_timestamp:false,check_posts:false,check_inbox:false,current_speed:1,initial_delay:0,poll_speeds:{0:10000,1:20000,2:30000,3:50000,4:60000,5:80000},sleep_speed:300000,sleep_max:18,slowdown_beats:10,poll_padding:30000},use_timestamps:true,last_timestamp:false,t_heartbeat:null,is_first_heartbeat:true,poll_lock:false,initialize:function(d){this.options=this.attributes;Tumblr.ToastKit.set("primary_tumblelog",d.primary_tumblelog);if(typeof Tumblr.Cookie==="object"){var e=Tumblr.Cookie.get("last_toast");if(e){e=parseInt(e,10);if(e!==0&&e>this.options.start_timestamp){this.options.start_timestamp=e}}}if(this.options.start_timestamp){this.update_timestamp(this.options.start_timestamp)}if(this.options.toast_mode===0){this.options.current_speed=3}this._set_heartbeat();this.i_visibility_check=setInterval(_.bind(this._check_visibility,this),this.visibility_check)},kill_switch:function(){this.enabled=false;this.poll_lock=true;clearTimeout(this.t_heartbeat)},debug_endless:function(){this.use_timestamps=false;this.use_hash_history=false;this.options.current_speed=0;this.heartbeat();return true},heartbeat:function(){clearTimeout(this.t_heartbeat);if(!this.enabled){return false}if(this.total_empty_heatbeats>=this.options.slowdown_beats){this.total_empty_heatbeats=0;this.poll_slower()}if(this.is_sleeping){this.total_sleep_heartbeats++;if(this.total_sleep_heartbeats<=this.options.sleep_max){this.poll()}else{}}else{this.poll()}this._set_heartbeat();return},get_next_heartbeat:function(){return this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.current_speed]},_check_visibility:function(){var d=Tumblr.Toaster.can_display_toasts();if(this.is_window_visible&&!d){this.sleep()}if(!this.is_window_visible&&d){this.wakeup()}this.is_window_visible=d},_set_heartbeat:function(){var d=this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.current_speed];if(this.is_first_heartbeat){this.is_first_heartbeat=false;d=this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.initial_delay]}this.t_heartbeat=setTimeout(_.bind(function(){this.heartbeat()},this),d)},poll_faster:function(){var d=this.options.current_speed;if((d-1)>=0){this.options.current_speed--}},poll_slower:function(){var d=this.options.current_speed;var e=_.size(this.options.poll_speeds);if((d+1)<e){this.options.current_speed++}},sleep:function(){this.is_sleeping=true;this.total_sleep_heartbeats=0},wakeup:function(){this.is_sleeping=false;this.total_sleep_heartbeats=0;this._set_heartbeat()},poll:function(){if(this.poll_lock){return}this.poll_lock=true;var g={notifications_next:(this.get_next_heartbeat()+this.options.poll_padding),magick:Math.floor(Math.random()*100001)};if(this.options.token!==null){g.token=this.options.token}if(this.options.toast_mode!==0){var d={notifications:true};jQuery.extend(g,d)}if(this.use_timestamps&&this.last_timestamp&&!this.debug_mode){jQuery.extend(g,{from:this.last_timestamp})}if(this.options.check_posts){var h={unread:true};jQuery.extend(g,h)}if(this.options.check_inbox){var e={inbox:true};jQuery.extend(g,e)}var f=c.ajax({url:this.poll_route,type:"GET",data:g});f.done(_.bind(function(i){this.poll_lock=false;if(this.options.toast_mode!==0){this.parse_notifications(i)}if(this.options.check_posts){this.parse_unread(i)}if(this.options.check_inbox){this.parse_inbox(i)}if(typeof i.next_from!=="undefined"){this.update_timestamp(i.next_from)}},this));f.fail(_.bind(function(){this.kill_switch()},this))},update_timestamp:function(d){d=parseInt(d,10);if(this.last_timestamp===false||d>this.last_timestamp){this.last_timestamp=d;if(typeof Tumblr.Cookie==="object"){Tumblr.Cookie.set("last_toast",d,365*24*60*60)}}},parse_unread:function(f){if(typeof f.unread!=="number"){return}var e=f.unread;if(e){var d=e;if(e>=100){this.options.check_posts=false;d="100+"}if(e>0){document.title="("+d+") "+(document.title.indexOf(")")!=-1?document.title.split(")")[1]:document.title);c(".new_post_notice_container").each(_.bind(function(h,g){var j=c(g);j.find(".tab_notice_value").text(d);j.show()},this))}}},parse_inbox:function(f){if(typeof f.inbox!=="number"){return}var e=f.inbox;if(e){var d=e;if(e>0){c(".inbox_notice_container").each(_.bind(function(h,g){var j=c(g);j.find(".tab_notice_value").text(d);j.show()},this))}else{c(".inbox_notice_container").hide()}}},parse_notifications:function(e){if(typeof e.notifications!=="object"){return}var d=e.notifications;if(d.length>0){c(d).each(_.bind(function(h,f){var j=false;if(this.use_hash_history){var k=f.hash;if(k in this.hash_history){this.hash_history[k]++;j=true}else{this.hash_history[k]=1}}if(!j&&this.options.toast_mode!==0){var g=false;switch(f.type){case"like":g=Tumblr.ToastKit.like(f);break;case"reblog":g=Tumblr.ToastKit.reblog(f);break;case"answer":g=Tumblr.ToastKit.answer(f);break;case"reply":g=Tumblr.ToastKit.reply(f);break;case"photo_reply":g=Tumblr.ToastKit.photo_reply(f);break;case"follower":g=Tumblr.ToastKit.follower(f);break;case"user_mention":g=Tumblr.ToastKit.user_mention(f);break}if(g){Tumblr.Toaster.add_toast(g)}}},this));this.poll_faster();this.total_empty_heatbeats=0}else{this.total_empty_heatbeats++}}});a.Thoth=b})(jQuery,Tumblr);
/*!
 * Tumblr.Dialog
 * A highly customizable queuing dialog system with easy replacements for alert() and prompt()
 * Features:
 *   - Add custom templates
 *   - Tab between buttons + enter/escape support
 *   - Default buttons tied to keys
 *   - Multiple dialogs queue for user
 *   - Multiple button styles
 *   - Callbacks everywhere
 */
(function(c,b){var a=Backbone.View.extend({el:".ui_dialog",translations:{},defaults:{},default_templates:{dialog:'<div class="ui_dialog <%= type %>"><%= content_html %><div class="buttons"><%= buttons_html %></div></div>',content:'<span class="text"><%= text %></span>',button:'<button class="ui_button btn_<%= btn_id %> chrome <%= btn_class %>" data-btn-id="<%= btn_id %>"><span><%= text %></span></button>'},events:{"click .ui_button":"button_click"},default_dialog:{text:"",type:"default",has_form:"auto",visible_glass:true,close_by_space:true,key_tab:true,key_close:true,animate:true,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(d){this.options=_.extend(this.defaults,this.options);this.templates=this.default_templates;this.is_visible=false;this.dialog_queue_order=[];this.dialog_queue={};this.queue_counter=0;this.current_dialog=false;this.current_dialog_id=0;this.uid=0;this._init_click_lock();this._setup_keys()},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},dialog:function(d){if(!_.isObject(d)){return false}return this._dialog(d)},confirm:function(e,i,j,g,d){if(_.isString(e)){e={text:e}}var h={callback_ok:i,callback_cancel:j,text_ok:g,text_cancel:d};e=_.extend({},h,e);var f={text:e.text,type:"confirm",visible_glass:true,templates:e.templates||null,escape_button:0,buttons:{0:{text:e.text_cancel||this.__("Cancel"),close:true,callback:((_.isFunction(e.callback_cancel))?e.callback_cancel:function(){})},1:{text:e.text_ok||this.__("OK"),selected:true,btn_class:"blue",close:true,callback:((_.isFunction(e.callback_ok))?e.callback_ok:function(){})}}};return this._dialog(f)},alert:function(d,h,f){if(_.isString(d)){d={text:d}}var g={callback_ok:h,text_ok:f};d=_.extend({},g,d);var e={text:d.text,type:"alert",visible_glass:true,templates:d.templates||null,escape_button:0,buttons:{0:{text:d.text_ok||this.__("OK"),selected:true,btn_class:"blue",close:true,callback:((_.isFunction(d.callback_ok))?d.callback_ok:function(){})}}};return this._dialog(e)},button_click:function(i){var h=c(i.currentTarget);var g=h.data("btn-id");if(_.isUndefined(this.current_dialog.buttons[g])){return false}var f=this.current_dialog.buttons[g];var d=null;if(_.isFunction(f.callback)){d=f.callback(this)}if(d!==false&&((!_.isUndefined(f.close)&&f.close)||_.isUndefined(f.close))){this.close()}},is_active:function(d){if((this.current_dialog===false)||(this.current_dialog.uid!=d)){return false}return true},close:function(f){if(this.current_dialog===false){return false}if(_.isUndefined(f)){f=false}if(f!==false&&this.current_dialog.uid!=f){return false}this.$dialog_lock.hide();c(".ui_dialog_pos").remove();this.is_visible=false;if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.resume()}if(_.isFunction(this.current_dialog.on_close)){this.current_dialog.on_close()}this.current_dialog=false;if(this.dialog_queue_order.length>0){var d=this.dialog_queue_order.shift();var e=this.dialog_queue[d];delete this.dialog_queue[d];this._dialog(e)}},_tab:function(h){var g=this.$el.find(".buttons .tab_frame");var k=g.filter(".focus");var j=g.index(k);var f=g.length;var d=false;if((j+1)<f){d=j+1}else{d=0}k.removeClass("focus init_focus");var i=g.eq(d);if(i.length>0){i.addClass("focus");i.find("button").focus()}},_form_is_tab_to_button:function(j,h){var k=this.$el.find(":focus");if(k.length===0){return true}var i=this.$el.find(".buttons .tab_frame");var g=this.$el.find(":input:visible");var f=g.index(k);if(h&&(f===(g.length-1))){this.$el.find(":input:visible:first").focus();j.preventDefault();i.removeClass("focus init_focus");return false}if(f>=0){var d=this.$el.find(":input:visible:eq("+(f+1)+")");if((d.length>0)&&d.hasClass("ui_button")){return true}}i.removeClass("focus init_focus");return false},_select:function(g){var f=this.$el.find(".buttons .tab_frame.focus");var d=f;if(d.length===1){d.find(".ui_button").click()}},_form_is_focus_on_button:function(d){var f=this.$el.find(":focus");if(f.length===0){return false}return f.hasClass("ui_button")},_escape:function(d){if(_.isUndefined(this.current_dialog.escape_button)){return}var f=this.$el.find(".btn_"+this.current_dialog.escape_button);if(f.length){f.click()}},_dialog:function(g){if(_.isUndefined(g.uid)){g.uid=this._get_uid()}if(this.current_dialog!==false){this.dialog_queue_order.push(this.queue_counter);this.dialog_queue[this.queue_counter]=g;this.queue_counter++;return g.uid}_.defaults(g,this.default_dialog);var h=this._build_buttons(g.buttons);_.extend(g,{buttons_html:h});var e=this.templates;if(_.isObject(g.templates)){e=_.extend({},this.templates,g.templates)}var d=_.template(e.dialog);var f=_.template(e.content);g.content_html=f(g);var i=d(g);this.$dialog_lock.show();if(!_.isUndefined(g.visible_glass)){if(g.visible_glass){this.$dialog_lock.addClass("opaque")}}else{this.$dialog_lock.removeClass("opaque")}this.current_dialog_id=g.uid;this.current_dialog=g;c("body").append('<div id="dialog_'+this.current_dialog_id+'" class="ui_dialog_pos">'+i+"</div>");this.$el=c("#dialog_"+this.current_dialog_id);this.is_visible=true;if(g.animate&&_.isObject(g.animate_in)&&this.$el.find(g.animate_in.dialog_el).length){this.$el.find(g.animate_in.dialog_el).addClass(g.animate_in.dialog_class)}this._focus();if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.suspend()}if(_.isUndefined(g.has_form)){g.has_form="auto"}if(g.has_form==="auto"){g.has_form=(this.$el.find("form, input").length>0)}if(_.isFunction(g.on_open)){g.on_open()}this.el=this.$el[0];this.delegateEvents();return g.uid},_button:function(h,f,i,g){var e=_.template(this.templates.button);if(_.isObject(this.current_dialog.templates)){e=this.current_dialog.templates.button}if(g){f+=" default-pulse"}var d=e({btn_class:f,text:h,btn_id:((!_.isUndefined(i))?i:"")});d='<div class="tab_frame">'+d+"</div>";return d},_focus:function(){if(!this.current_dialog){return false}for(var e in this.current_dialog.buttons){var d=this.current_dialog.buttons[e];if(!_.isUndefined(d.selected)&&d.selected){$button=this.$el.find(".btn_"+e);if($button.length>0){$button.parent().addClass("focus init_focus")}}}},_setup_keys:function(){c(document).on("keydown",_.bind(function(g){var f=(g.ctrlKey||g.shiftKey||g.metaKey);if(!this.is_visible||f){return}var d=g.keyCode||g.which;if((d===9)&&this.current_dialog.key_tab){if(this.current_dialog.has_form){if(!this._form_is_tab_to_button(g,true)){return}}g.preventDefault();this._tab(g)}if(d===13||((d===32)&&this.current_dialog.close_by_space)){if(this.current_dialog.has_form&&(d===32)){if(!this._form_is_focus_on_button(g)){return}}g.preventDefault();this._select(g)}if((d===27)&&this.current_dialog.key_close){g.preventDefault();this._escape(g)}},this))},_build_buttons:function(k){if(!_.isObject(k)){return""}var h=0;for(var g in k){if(k.hasOwnProperty(g)){h++}}var f="";for(var e=0;e<h;e++){if(_.isUndefined(k[e])){continue}var l=(!_.isUndefined(k[e].text))?k[e].text:"";var d=(!_.isUndefined(k[e].btn_class))?k[e].btn_class:"";var j=(!_.isUndefined(k[e].selected))?k[e].selected:false;f+=this._button(l,d,e,j)}return f},_init_click_lock:function(){this.$dialog_lock=false;c(_.bind(function(){c("body").prepend('<div class="ui_dialog_lock"></div>');this.$dialog_lock=c("body > .ui_dialog_lock")},this))},_get_uid:function(){return this.uid++}});b.Dialog=new a()})(jQuery,Tumblr);
(function(a){Tumblr.PhotoReply=Backbone.View.extend({options:{post_id:undefined,mb_limit:10,status:"inactive",progress:0,image:undefined},initialize:function(b){this.options=b||{};this.post_id=this.options.post_id||this.$el.data("postId");this.status=this.options.status||"inactive";this.progress=this.options.progress||0;this.disabled=true;this.$post=this.$el.closest(".post");this.$container=this.$post.find(".photo_reply_container");this.$icon=this.$(".photo_reply_icon");this.$progress=this.$(".photo_reply_icon_progress");this.$image=this.$(".photo_reply_image");this.$icon.addClass("show_progress_bar");this.__proxy_functions();if(this.status!=="has_image"){this.enable_dropzone()}this.$el.data("tumblr_photoreply",this);this.constructor.register(this)},__proxy_functions:function(){this._show_image=a.proxy(this.show_image,this);this._hide_image=a.proxy(this.hide_image,this);this._upload_file_add=a.proxy(this.upload_file_add,this);this._upload_submit=a.proxy(this.upload_submit,this);this._upload_progress=a.proxy(this.upload_progress,this);this._upload_end=a.proxy(this.upload_end,this);this._upload_cancel=a.proxy(this.upload_cancel,this);this._upload_stop=a.proxy(this.upload_stop,this);this._dragenter=a.proxy(this.dragenter,this);this._dragleave=a.proxy(this.dragleave,this);this._drop=a.proxy(this.drop,this)},attach_image:function(c){var b={width:"",height:"",src:""};if(typeof c==="string"){b.src=c}else{if(c.url){b.src=c.url}if(c.height){b.height=c.height}if(c.width){b.width=c.width}}this.$container.addClass("fileupload");if(!(this.$image&&this.$image.length)){this.$image=a('<img src="" alt="" class="photo_reply_image"/>');this.$image.appendTo(this.$container).on("load",this._show_image)}this.$image.attr(b)},show_image:function(){if(!(this.$image&&this.$image.length)){return false}this.$container.css("max-height",this.$image.get(0).naturalHeight).addClass("has_photo_reply")},hide_image:function(){this.$container.removeClass("has_photo_reply").css("max-height","")},enable_dropzone:function(){this.disabled=false;this.$post.on({dragenter:this._dragenter,dragleave:this._dragleave,drop:this._drop});this.$post.find("*").on("dragenter dragover",this.cancel_event);this.$el.find('input[type="file"]').on("click",this._upload_cancel).attr("disabled",false);this.create_uploader({form:this.$el,dropzone:this.$post})},disable_dropzone:function(){this.disabled=true;this.$post.off({dragenter:this.dragenter,dragleave:this.dragleave,drop:this.drop});this.$post.removeClass("photo_reply_hover");this.$post.find("*").off("dragenter dragover",this.cancel_event);this.$el.find('input[type="file"]').off("click",this._upload_cancel).attr("disabled",true)},create_uploader:function(b){this.destroy_uploader();this.$uploader=a(b.form).fileupload({dataType:"json",maxNumberOfFiles:1,dropZone:b.dropzone,pasteZone:null,add:this._upload_file_add,submit:this._upload_submit,send:this._upload_start,progress:this._upload_progress,always:this._upload_end,stop:this._upload_stop})},destroy_uploader:function(){if(this.$uploader&&this.$uploader.data("fileupload")){a(this.$uploader).fileupload("destroy")}},dragenter:function(b){this.$post.addClass("photo_reply_hover")},dragleave:function(b){if(this.event_in_bounds(b)){return false}this.$post.removeClass("photo_reply_hover")},drop:function(b){this.$post.removeClass("photo_reply_hover")},show_coddled_progress:function(b){return this.show_progress(b,20)},show_progress:function(b,c){if(c){b=Math.max(c,Math.min(b,100-c))}this.$progress.css("width",b+"%");return b},upload_submit:function(f,d){if(this.disabled){return false}if(this.status!=="inactive"){return false}var b=!!d.files.length;a.each(d.files,a.proxy(function(e,g){if(g.size&&g.size>this.options.mb_limit*1048576){b=false}},this));if(!b){var c=l10n_str.ajax_error;if(l10n_str.over_max_file_size_mb){c=l10n_str.over_max_file_size_mb.replace("%1$s",this.options.mb_limit)}alert(c);return false}},upload_file_add:function(c,b){this.jqXHR=b.submit()},upload_start:function(c,b){this.status="uploading";this.progress=0;this.show_progress(this.progress)},upload_progress:function(c,b){this.progress=parseInt(b.loaded/b.total*100,10);this.show_coddled_progress(this.progress)},upload_end:function(d,c){var b;if(c.textStatus==="success"){b=c.result}else{b=a.parseJSON(c.jqXHR.responseText)}if(b&&b.meta&&b.meta.status&&b.meta.status===200){if(b&&b.response&&b.response[0].url){this.image=b.response[0];this.progress=100;this.status="has_image";this.disable_dropzone();this.attach_image(this.image)}}else{if(c&&c.errorThrown==="abort"){this.progress=0;this.status="inactive"}else{this.progress=0;this.status="error";alert(b&&b.response?b.response:l10n_str.ajax_error)}}this.show_progress(this.progress)},upload_cancel:function(){try{this.jqXHR.abort()}catch(b){}this.progress=0;this.show_progress(this.progress);this.enable_dropzone()},upload_stop:function(){this.destroy_uploader()},cancel_event:function(b){b.preventDefault();b.stopPropagation();return false},event_in_bounds:function(f){var d=f.currentTarget.getBoundingClientRect();var c=f.originalEvent;var b,g;if(typeof c.clientX==="undefined"){b=c.pageX;g=c.pageY}else{b=c.clientX;g=c.clientY}return !(b>d.left+d.width-1||b<d.left||g>d.top+d.height-1||g<d.top)}},{instances:[],register:function(b){this.instances.push(b)},unregister:function(b){this.instances.splice(_.indexOf(this.instances,b),1)},clean_up:function(d){if(!document.body){return}var c,b;for(c=0;c<this.instances.length;c++){b=this.instances[c];if(!(b.$el.data("tumblr_photoreply")&&b.$el.closest(document.body).length)){b.remove();c--}}},init:function(){if(!this._scan){this._scan=a.proxy(this.scan,this)}if(_.indexOf(AfterAutoPaginationQueue,this._scan)<0){AfterAutoPaginationQueue.push(this._scan)}this.scan()},scan:function(b){b=a.extend({},b);a(b.el||".photo_reply_form").each(a.proxy(function(c,d){if(!a(d).data("tumblr_photoreply")){new Tumblr.PhotoReply({el:d})}},this));return this}})})(jQuery);
(function(a){Tumblr.LinkButton=Backbone.View.extend({events:{click:"follow_link"},initialize:function(b){this.$el.addClass("clickable");this.determine_size();this.$el.data("tumblr_linkbutton",this);this.constructor.register(this)},determine_size:function(){this.$el.removeClass("small");if(this.$(".link_title").text().length>100||this.$(".link_text").height()>110){this.$el.addClass("small")}},follow_link:function(b){if(a(b.target).is(".link_title")){return true}b.preventDefault();b.stopPropagation();this.$(".link_title").click();return false}},{instances:[],register:function(b){this.instances.push(b)},unregister:function(b){this.instances.splice(_.indexOf(this.instances,b),1)},init:function(){if(!this._scan){this._scan=a.proxy(this.scan,this)}if(_.indexOf(AfterAutoPaginationQueue,this._scan)<0){AfterAutoPaginationQueue.push(this._scan)}this.scan()},scan:function(b){b=a.extend({},b);a(b.el||".link_button").each(a.proxy(function(c,d){if(!a(d).data("tumblr_linkbutton")){new Tumblr.LinkButton({el:d})}},this));return this}})})(jQuery);
(function(c,b){var a=function(d,e){if(!(this instanceof a)){return new a(d)}this.options=d;this.config=c.extend({},a.defaults,this.options);this._=c.extend({},a.init,this.init);this.evt=c.extend({},a.events);c.each(this.evt,c.proxy(function(f){if(typeof this.config[f]==="function"){this.evt[f]=this.config[f]}},this));this.clock=false;this.still=true;this.motion=false;this.paused=false;a.register(this);return this};a.prototype={start_clock:function(){if(this.clock){return false}this.clock=true;clearInterval(this.ticker);this.ticker=setInterval(c.proxy(this.tick,this),this.config.dt)},stop_clock:function(){this.clock=false;clearInterval(this.ticker)},tick:function(d){if(!d){d=this.config.dt}return this.paused?false:this.__tick(d)},__tick:function(f,e){if(this.evt.pre_tick&&!this.evt.pre_tick.apply(this,[this])){return this}if(!f){f=this.config.dt}if(!e){this.set_properties({px0:this._.px,vx0:this._.vx,ax0:this._.ax,py0:this._.py,vy0:this._.vy,ay0:this._.ay,pz0:this._.pz,vz0:this._.vz,az0:this._.az,dt:f})}if(!f){return this}this.still=true;this.motion=false;var d=f*f;if(this.config.x&&(this._.vx||this._.ax)){this._.px=this._.px+this._.vx*f+0.5*this._.ax*d;this._.vx=this.__almost_zero(this._.vx+this._.ax*f);if(this._.drag<1){this._.vx*=this._.drag}if(this._.vx){this.still=false}if(this._.vx||this._.ax){this.motion=true}}if(this.config.y&&(this._.vy||this._.ay)){this._.py=this._.py+this._.vy*f+0.5*this._.ay*d;this._.vy=this.__almost_zero(this._.vy+this._.ay*f);if(this._.drag<1){this._.vy*=this._.drag}if(this._.vy){this.still=false}if(this._.vy||this._.ay){this.motion=true}}if(this.config.z&&(this._.vz||this._.az)){this._.pz=this._.pz+this._.vz*f+0.5*this._.az*d;this._.vz=this.__almost_zero(this._.vz+this._.az*f);if(this._.drag<1){this._.vz*=this._.drag}if(this._.vz){this.still=false}if(this._.vz||this._.az){this.motion=true}}if(this.evt.post_tick){this.evt.post_tick.apply(this,[this])}if(this.still&&this.evt.when_still){this.evt.when_still.apply(this,[this])}if(!this.motion&&this.evt.no_motion){this.evt.no_motion.apply(this,[this])}return this},__split_tick:function(g,f,h){if(typeof h!=="function"){return this.__tick(g,true)}var d=f*g;var e=g-d;if(e){this.__tick(e)}h.apply(this,[this]);if(d){this.__tick(d)}return this},__almost_zero:function(d){return Math.abs(d)<this.config.threshold?0:d},set_properties:function(d,e){if(c.isPlainObject(d)){c.extend(this._,d)}else{this._[d]=e}return this},calculate_velocity:function(g,h,n){if(g.length<2){return false}if(this.evt.slide_start){this.evt.slide_start.apply(this,[this])}var l=0,j=g.length-1;var e=(new Date()).getTime()-h;for(var f=0;f<g.length;f++){if(g[f][0]<e){l=f+1}}if(l>=j){return false}var m=g[l],k=g[j],d=k[0]-m[0];this.set_properties({vx0:this._.vx,vy0:this._.vy,vx:(m[1]-k[1])/d,vy:(m[2]-k[2])/d});if(n){this.autostart_xy()}return this},autostart_xy:function(){var d=(this.config.x&&this._.vx)||(this.config.y&&this._.vy);if(d){this.start_clock()}return d},autostop_xy:function(){var d=!(this._.vx&&this.config.x)&&!(this._.vy&&this.config.y);if(d){this.stop_clock()}return d}};a.instances=[];a.register=function(d){this.instances.push(d)};a.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};a.dt=15;a.tick=function(e){if(typeof e!=="number"){e=this.dt}for(var d=0;d<this.instances.length;d++){this.instances[d].tick(e)}};a.init={px:0,vx:0,ax:0,py:0,vy:0,ay:0,pz:0,vz:0,az:0,px0:0,vx0:0,ax0:0,py0:0,vy0:0,ay0:0,pz0:0,vz0:0,az0:0,drag0:0.9,drag:0.9,dt:null};a.events={pre_tick:false,post_tick:false,slide_start:false,when_still:false,no_motion:false};a.defaults={x:true,y:false,z:false,threshold:0.005,dt:a.dt};b.Physics=a})(jQuery,this.Tumblr||(this.Tumblr={}));(function(c,b){var a=function(e,d){if(!(this instanceof a)){return new a(e,d)}this.el=(typeof e==="string")?c(e).get(0):e;this.$el=c(e);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=c.extend({},a.defaults,this.options,this.metadata);this.$parent=c(this.config.parent);this.start=c.proxy(this.__start,this);this.end=c.proxy(this.__end,this);this.move=c.proxy(this.__move,this);this.click=c.proxy(this.__click,this);this.scroll=c.proxy(this.__scroll,this);this.__init();a.register(this);return this};a.prototype={__init:function(){this.__reset_positions();if(this.autostart){this.enable()}this.touch=("ontouchstart" in window||"onmsgesturechange" in window)&&navigator.msMaxTouchPoints>1;if(this.touch){c.extend(this.config,{start:"touchstart",end:"touchend",move:"touchmove"})}this.physics=this.config.physics?new Tumblr.Physics(this.config.physics):false},enable:function(){this.enable_dragging();if(this.config.can_scroll){this.enable_scrolling()}},enable_dragging:function(){this.dragging=false;this.$el.on(this.config.start,this.start);this.$el.on(this.config.click,this.click)},enable_scrolling:function(){this.scrolling=false;this.$el.on(this.config.scroll,this.scroll);clearTimeout(this.enable_scrolling_delay)},disable:function(){this.disable_dragging();this.disable_scrolling()},disable_dragging:function(){this.dragging=false;this.$el.off(this.config.start,this.start);this.$el.off(this.config.click,this.click);this.$parent.off(this.config.blur,this.end);this.$parent.off(this.config.end,this.end);this.$parent.off(this.config.move,this.move)},disable_scrolling:function(){this.scrolling=false;this.$el.off(this.config.scroll,this.scroll);clearTimeout(this.enable_scrolling_delay)},__start:function(d){this.dragging=true;this.$parent.on(this.config.blur,this.end);this.$parent.on(this.config.end,this.end);this.$parent.on(this.config.move,this.move);this.__reset_positions();this.__event_position(d);this.start_position=this.end_position=this.positions[0];if(this.config.start_position){this.config.start_position(this.start_position[1],this.start_position[2])}if(this.physics){this.physics.set_properties({vx0:this.physics._.vx,vy0:this.physics._.vy,vx:0,vy:0}).stop_clock()}d.stopPropagation();return false},__end:function(d){this.dragging=false;this.$parent.off(this.config.blur,this.end);this.$parent.off(this.config.end,this.end);this.$parent.off(this.config.move,this.move);if(this.config.end_position){this.config.end_position(this.end_position[1],this.end_position[2])}if(this.physics){this.physics.calculate_velocity(this.positions,this.config.pos_time,true)}},__click:function(d){if(this.__any_movement()){d.stopPropagation();return false}return true},__move:function(f){var d=this.__event_position(f);this.end_position=this.positions[this.positions.length-1];if(this.config.update_position){this.config.update_position(d.x-this.start_position[1],d.y-this.start_position[2],false)}},__scroll:function(d){if(this.physics&&this.physics.clock){d.preventDefault();this.physics.set_properties({vx0:this.physics._.vx,vy0:this.physics._.vy,vz0:0,vx:0,vy:0,vz:0}).stop_clock();this.physics.motion=false;if(this.physics.evt.no_motion){this.physics.evt.no_motion.apply(this.physics,[this.physics])}return false}if(this.config.update_position){this.config.update_position(this.$el.scrollLeft(),this.$el.scrollTop(),true)}},__event_position:function(f,h){var d,g;if(this.touch){if(!f.originalEvent.targetTouches.length){return false}d=f.originalEvent.targetTouches[0].pageX;g=f.originalEvent.targetTouches[0].pageY}else{d=f.pageX;g=f.pageY}if(h){return{x:d,y:g}}else{return this.__record_position(d,g)}},__any_movement:function(){if(this.positions<2){return false}var e=this.positions[0],d=this.positions[this.positions.length-1];return d[0]!==e[0]||d[1]!==e[1]},__reset_positions:function(){delete this.start_position;delete this.end_position;this.positions=[];this.scroll_x=this.$el.scrollLeft();this.scroll_y=this.$el.scrollTop()},__record_position:function(d,f){if(c.isPlainObject(d)){f=d.y;d=d.x}var e=(new Date()).getTime();this.positions.push([e,d,f]);if(this.positions.length-1===this.config.pos_limit){this.positions.shift()}else{if(this.positions.length>this.config.pos_limit){this.positions.splice(-this.config.pos_limit,this.positions.length)}}this.positions.push([e,d,f]);return{x:d,y:f}},sync_scroll:function(e){if(!this.config.can_scroll){return}this.disable_scrolling();var d=c(e);this.$el.scrollLeft(d.scrollLeft());this.$el.scrollTop(d.scrollTop());this.scroll_x=this.$el.scrollLeft();this.scroll_y=this.$el.scrollTop();if(this.physics){this.physics.set_properties({px:this.scroll_x,py:this.scroll_Y})}clearTimeout(this.enable_scrolling_delay);this.enable_scrolling_delay=setTimeout(c.proxy(this.enable_scrolling,this),200)}};a.instances=[];a.register=function(d){this.instances.push(d)};a.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};a.defaults={pos_limit:5,pos_time:200,start:"mousedown",end:"mouseup",move:"mousemove",click:"click",scroll:"scroll",blur:"blur",parent:window,can_scroll:true,physics:false,start_position:false,end_position:false,update_position:false,autostart:true};b.DragRelay=a})(jQuery,Tumblr);(function(c,a){var d=function(e){this.options=e;this.__init(this.config);return this};d.prototype={__init:function(){Tumblr.Glass.show(function(){this.__destroy()}.bind(this));this.click=c.proxy(this.__click,this);this.resize=c.proxy(this.__resize,this);this.keydown=c.proxy(this.__keydown,this);this.keyup=c.proxy(this.__keyup,this);this.keycancel=c.proxy(this.__keycancel,this);this.__create();if(this.options.pano){this.__clone_pano(this.options.pano)}this.__open()},__bind_events:function(){this.$lightbox.on("click",this.click);c(window).on("resize",this.resize);c(window).on("keydown",this.keydown)},__unbind_events:function(){this.$lightbox.off("click",this.click);c(window).off("resize",this.resize);c(window).off("keydown",this.keydown);c(window).off("keyup",this.keyup);c(window).off("blur",this.keycancel)},__create:function(){this.$lightbox=c("<div/>").attr("class","pano_lightbox").appendTo(c("body"));this.$lightbox.css({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:4294967294,overflow:"hidden",backgroundColor:"rgba(15,15,15,0.95)"});c("<img/>").attr("id","vignette").attr("src","http://assets.tumblr.com/images/full_page_vignette.png").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).appendTo(this.$lightbox);c("<div/>").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).appendTo(this.$lightbox)},__destroy:function(){this.__unbind_events();this.$lightbox.css("display","none").remove();this.pano.$parent.css("overflow","");delete this.$lightbox;if(window.top!=window.self){if(typeof window.top.pano_iframe_preloader!="undefined"&&window.top.pano_iframe_preloader){window.top.pano_iframe_preloader.remove()}}b.unregister(this)},__clone_pano:function(e){this.$pano=c(e).clone(false).appendTo(this.$lightbox);this.pano=new b(this.$pano,{side_margins:100});this.pano.lightbox=this},__open:function(){this.__bind_events();this.pano.__center_vertically(c(window).height());this.pano.$parent.css("overflow","hidden")},__close:function(){Tumblr.Glass.hide()},__click:function(f){if(c(f.target).closest(".pano_dragger").length||c(f.target).closest(".pano_thumb").length){return}this.__close()},__resize:function(f){this.pano.__enforce_max_height();this.pano.__center_vertically(c(window).height());this.pano.__draw_shades();c("#vignette").css("display","none")},__keydown:function(g){if(!g){return false}var f=g.charCode?g.charCode:g.keyCode;if((g.ctrlKey||g.metaKey)&&f===87){this.__close();return false}if(!g.shiftKey&&!g.ctrlKey&&g.altKey&&!g.metaKey){return true}switch(f){case 37:if(this.arrowed){return false}this.arrowed=true;this.pano.physics.set_properties({drag0:this.pano.physics._.drag,drag:1,vx0:this.pano.physics._.vx,vx:-0.9}).autostart_xy();c(window).on("blur",this.keycancel);c(window).on("keyup",this.keyup);return false;case 39:if(this.arrowed){return false}this.arrowed=true;this.pano.physics.set_properties({drag0:this.pano.physics._.drag,drag:1,vx0:this.pano.physics._.vx,vx:0.9}).autostart_xy();c(window).on("blur",this.keycancel);c(window).on("keyup",this.keyup);return false;case 27:case 32:case 74:case 75:this.__close();return false}},__keyup:function(g){if(!g){return false}var f=g.charCode?g.charCode:g.keyCode;if(!g.shiftKey&&!g.ctrlKey&&g.altKey&&!g.metaKey){return true}switch(f){case 37:this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0}).autostop_xy();c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup);return false;case 39:this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0}).autostop_xy();c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup);return false}},__keycancel:function(f){if(this.arrowed){this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0,vx0:this.pano.physics._.vx,vx:0}).autostop_xy()}c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup)}};var b=function(f,e){if(!(this instanceof b)){return new b(f,e)}this.el=(typeof f==="string")?c(f).get(0):f;this.$el=c(f);if(this.$el.data("panoObject")){return this.$el.data("panoObject")}this.options=e;this.metadata=this.$el.data("plugin-options");this.config=c.extend({physics:{post_tick:c.proxy(function(g){this.viewport_size();if(g._.px<=0){g.set_properties({px:0,vx:0.1*Math.abs(g._.vx)});if(this.lightbox){this.lightbox.keycancel()}}else{if(g._.px>=(this.display_width+(this.display_side_margins*2))-this.viewport_width){g.set_properties({px:(this.display_width+(this.display_side_margins*2))-this.viewport_width,vx:-0.1*Math.abs(g._.vx)});if(this.lightbox){this.lightbox.keycancel()}}}this.set_position(g._.px,g._.py,true)},this),slide_start:c.proxy(function(g){this.relay.disable_scrolling();this.scrubber_relay.disable_scrolling()},this),no_motion:c.proxy(function(g){g.stop_clock();this.relay.enable_scrolling();this.scrubber_relay.enable_scrolling();this.relay.sync_scroll(this.$viewport)},this)},autostart:true},this.options,this.metadata);this.__init(this.config);return this};b.prototype={__init:function(e){this.img_loaded=c.proxy(this.__img_loaded,this);this.img_ready=c.proxy(this.__img_ready,this);this.__create();c.extend(this.config,{start_position:c.proxy(this.set_start_position,this),end_position:c.proxy(this.set_end_position,this),update_position:c.proxy(this.set_position,this)});this.relay=new Tumblr.DragRelay(this.$dragger,this.config);this.physics=this.relay.physics;this.scrubber_relay=new Tumblr.DragRelay(this.$scrubber,c.extend({},this.config,{can_scroll:false,physics:false,start_position:c.proxy(this.set_inverted_start_position,this),update_position:c.proxy(this.set_inverted_position,this)}));this.__load_pano_image();b.register(this)},__create:function(){if(this.$el.is("a")){this.$orig_a=this.$el;this.$orig_img=this.$el.children("img")}else{this.$orig_img=this.$el}this.src=this.$orig_img.data("panoSrc");this.href=this.$orig_img.data("panoHref");this.width=this.$orig_img.data("panoWidth");this.height=this.$orig_img.data("panoHeight");this.position_height=Math.min(80,this.$orig_img.data("thumbHeight"));this.position_width=this.$orig_img.data("thumbWidth")*(this.position_height/this.$orig_img.data("thumbHeight"));this.position_width=Math.min(500,this.position_width);this.$parent=c("body");this.$container=c("<div/>").attr("class","pano_container loading");this.$view_container=c("<div/>").attr("class","pano_view_container").appendTo(this.$container);this.$viewport=c("<div/>").attr("class","pano_viewport").appendTo(this.$view_container);this.$img_container=c("<div/>").attr("class","pano_img_container").css({width:this.width,height:this.height,padding:"0 "+this.options.side_margins+"px"}).appendTo(this.$viewport);this.$img=c("<img/>").attr({src:"http://assets.tumblr.com/images/x.gif","class":"pano_img"}).css({width:this.width,height:this.height}).appendTo(this.$img_container);this.$loader_img=c("<img/>").attr({"class":"pano_loader_img",src:this.$orig_img.attr("src")}).css({width:this.width,height:this.height}).appendTo(this.$img_container);this.$position=c("<div/>").attr("class","pano_position").css({width:this.position_width,height:this.position_height}).appendTo(this.$container);this.$thumb=c("<img/>").attr("class","pano_thumb").attr("src",this.$orig_img.attr("src")).appendTo(this.$position);this.$shade_left=c("<div/>").attr("class","pano_shade left").appendTo(this.$position);this.$shade_right=c("<div/>").attr("class","pano_shade right").appendTo(this.$position);this.$scrubber=c("<div/>").attr("class","pano_scrubber grab").appendTo(this.$position);this.$dragger=c("<div/>").attr("class","pano_dragger grab").css({height:this.height}).appendTo(this.$container);this.$scroller=c("<div/>").attr("class","pano_scroller").css({width:this.width,height:this.height,borderLeft:this.options.side_margins+"px solid transparent",borderRight:this.options.side_margins+"px solid transparent"}).appendTo(this.$dragger);this.$el.css("display","none").data("panoObject",this).after(this.$container);this.__set_img_dimensions(this.width,this.height,this.options.side_margins);this.__enforce_max_height();return this},__destroy:function(){this.$img.off("load",this.img_ready);this.$container.remove();delete this.$container;delete this.$view_container;delete this.$viewport;delete this.$img;delete this.$loader_img;delete this.$position;delete this.$thumb;delete this.$pos_frame;delete this.$dragger;this.$el.css("display","").data("panoObject","")},__load_pano_image:function(e){if(!e){e=this.src}this.img_poll=setInterval(this.img_ready,1000);this.$img.on("load",this.img_loaded).attr("src",e);this.__img_init()},__img_init:function(){this.relay.enable();this.scrubber_relay.enable();this.__scrubber_sizing();this.set_position(0,0)},__img_ready:function(e){if(!e){e=this.$img[0]}if(e&&e.src&&e.complete){this.__img_loaded()}},__img_loaded:function(f){this.__scrubber_sizing();this.$container.removeClass("loading");clearInterval(this.img_poll)},__scrubber_sizing:function(){this.viewport_size();var e=100*this.viewport_width/(this.$img.width()+(this.options.side_margins*2));this.$scrubber.width(Math.min(e,100)+"%");if(Math.min(e,100)==100){this.$position.css("opacity","0")}else{this.$position.css("opacity","1")}},__draw_shades:function(){if(this.relay.touch){return}this.$shade_left.css("width",Math.max(0,this.scrubber_x));this.$shade_right.css("width",Math.max(0,this.position_width-this.scrubber_x-this.$scrubber.width()))},__set_img_dimensions:function(g,e,f){this.$img_container.css({width:g,height:e});this.$img.css({width:g,height:e});this.$loader_img.css({width:g,height:e});this.$dragger.css({height:e});this.$scroller.css({width:g,height:e});this.display_width=g;this.display_height=e;if(typeof f==="number"){this.$img_container.css({padding:"0 "+f+"px"});this.$scroller.css({borderLeft:f+"px solid transparent",borderRight:f+"px solid transparent"});this.display_side_margins=f}},__enforce_max_height:function(f){f=f||200;var g=c(window).height()-this.$position.outerHeight(true);g-=30;var e=Math.max(f,Math.min(this.height,g));var h=this.width*(e/this.height);this.__set_img_dimensions(h,e);this.$img_container.css("min-width",c(window).width()-2*this.display_side_margins);this.__scrubber_sizing()},__center_vertically:function(e){this.$container.css("top",(e/2)-(this.$container.height()/2))},set_start_position:function(e,f){this.$parent.addClass("grabbing");this.start_x=this.$viewport.scrollLeft();this.start_y=this.$viewport.scrollTop()},set_inverted_start_position:function(e,f){this.$parent.addClass("grabbing");this.start_x=this.$scrubber.position().left;this.start_y=this.$scrubber.position().top},set_end_position:function(e,f){this.$parent.removeClass("grabbing");this.relay.sync_scroll(this.$viewport)},viewport_size:function(){this.viewport_width=this.$viewport.width();this.viewport_height=this.$viewport.height()},set_position:function(f,g,e){this.viewport_size();if(e){this.position_x=f;this.position_y=g}else{this.position_x=this.start_x-f;this.position_y=this.start_y-g}this.$viewport.scrollLeft(this.position_x);this.position_x=this.$viewport.scrollLeft();this.scrubber_x=this.$scrubber.width()*this.position_x/this.viewport_width;this.$scrubber.css("left",parseInt(this.scrubber_x,10)+"px");this.__draw_shades()},set_inverted_position:function(f,g,e){this.viewport_size();if(e){this.scrubber_x=f}else{this.scrubber_x=this.start_x+f}this.scrubber_x=Math.max(0,Math.min(this.scrubber_x,(this.$position.width()-this.$scrubber.width())));this.position_x=this.$viewport.width()*this.scrubber_x/this.$scrubber.width();this.$scrubber.css("left",parseInt(this.scrubber_x,10)+"px");this.__draw_shades();this.$viewport.scrollLeft(this.position_x)}};b.instances=[];b.register=function(e){this.instances.push(e)};b.unregister=function(e){this.instances.splice(this.instances.indexOf(e),1)};c.fn.panorama=function(e){e=e||{};var f=e.lightbox||false;return this.each(function(){if(f){new d(c.extend({},e,{pano:this}))}else{new b(this,e)}})};a.Panorama=b})(jQuery,this.Tumblr||(this.Tumblr={}));
(function(c,b){var a=Tumblr.TagPopover.extend({events:{"focus #search_query":"focus_search_query","blur #search_query":"blur_search_query","mouseup #search_query":"mouseup_search_query","keyup #search_query":"keyup_search_query","keydown #search_query":"keydown_search_query","click #popover_search .popover_menu_item":"click_popover","submit #search_form":"submit","mouseenter #popover_search":"mouseenter","mouseenter .popover_menu_item a":"mouseenter_search_type","mouseleave #popover_search":"mouseleave_search_type"},initialize:function(d){this.options=d||{};this.options.popover_selector="#popover_search";this.onboarding_search=this.options.onboarding||false;this.onboarding_search_endpoint=this.options.onboarding_search_endpoint||false;this.search_results_redesign=Tumblr.Features("search_results_redesign")(true,false);Tumblr.TagPopover.prototype.initialize.apply(this,arguments);this.search_term=this.$search_query.val();if(this.options.promo){this.should_show_promo()}this.capturing=(Tumblr.Capture)?new Tumblr.Capture.SearchPopover():null;this.pressed_keys=[];this.is_new_search=Tumblr.Features("search_results_redesign")(true,false);this.listenTo(Tumblr.Events,"search:change:query",this.change_query,this);this.listenTo(Tumblr.Events,"search:submit",this.force_submit,this)},should_show_promo:function(){if(Tumblr.Cookie.get("search_promo")!=1){this.show_promo()}},show_promo:function(){if(!this.promo_popover){this.promo_popover=new Tumblr.Popover({el:c("#popover_search_promo").parent(),popover:c("#popover_search_promo"),disable_auto_show:true,on_show:function(){c("#glass_overlay").addClass("blue");c("#search_field").addClass("showing_search_promo over_glass")},on_hide:this.hide_promo.bind(this)})}this.promo_popover.show();this.promo_popover.popover.find(".search_promo_button").on("click",function(d){this.hide_promo()}.bind(this));this.$search_query.on("focus.search_promo",function(d){this.hide_promo()}.bind(this))},hide_promo:function(){this.promo_popover.hide();this.promo_popover.popover.remove();this.$search_query.off("focus.search_promo");c("#glass_overlay").removeClass("blue");c("#search_field").removeClass("showing_search_promo over_glass");Tumblr.Cookie.set("search_promo",1);this.popover.show();this.$search_query.focus()},click_popover:function(h){var g=this.$(h.currentTarget);var f=g.find("a");var d=f.attr("href");if(h.metaKey||h.altKey){window.open(d);h.stopPropagation();h.preventDefault()}this.popover.hide();if(this.search_results_redesign){this.change_query(f.data("tag-result"));if(f.hasClass("search_typeahead")){h.preventDefault();h.stopPropagation();this.force_submit()}}},setup_autocomplete:function(){if(this.onboarding_search){this.auto_complete=new Tumblr.OnboardingAutoCompleteSearch({el:this.$search_query,endpoint:this.onboarding_search_endpoint,popover:this.popover})}else{this.auto_complete=new Tumblr.AutoCompleteSearch({el:this.$search_query,store:"/svc/search_popover",popover:this.popover,include:Tumblr.EXISTING_TAGS,base_blog_search_url:this.options.base_blog_search_url||null,blog_search_label:this.options.blog_search_label||'More results for "%1$s"'})}},focus_search_query:function(){this.$search_field.addClass("active");this.currentIndex=-1;this.set_search_type(this.search_type);if(this.$search_query.val()==this.$search_query.attr("placeholder")){this.$search_query.val("")}if(this.$search_query.val().length){this.auto_complete.lookup()}else{if(!this.has_children(this.$tracked_tags)&&!this.has_children(this.$autocomplete_results)){return}this.popover.show();this.$("#unread_tag_notice").hide();this.$search_query.removeClass("with_unread")}},blur_search_query:function(){if(this.$search_query.val()==this.auto_complete.init_value){this.set_search_type(this.search_type)}if(this.$search_query.val()===""){this.set_search_type("tag")}},keyup_search_query:function(d){this.pressed_keys[d.keyCode]=0;if(this.$search_query.val()!==this.auto_complete.init_value){this.set_search_type("tag")}else{this.set_search_type(this.search_type)}if(!this.pressed_keys[16]){this.set_search_type(this.search_type)}},keydown_search_query:function(d){this.pressed_keys[d.keyCode]=1;if(this.pressed_keys[18]){this.set_search_type("blog")}if(this.pressed_keys[18]&&d.keyCode==13){d.stopPropagation();d.preventDefault();this.do_blog_search()}},mouseup_search_query:function(){this.$search_query.select()},set_active:function(g){var d=c(this.popover_selector+" .popover_menu_item a").filter(":visible");var f=d.filter(":focus");if(f.length){this.currentIndex=(g==="previous")?d.index(f)-1:d.index(f)+1}if(this.currentIndex>=0&&this.currentIndex<d.length){d.eq(this.currentIndex).focus()}else{if(this.currentIndex==-2&&g==="previous"){d.eq(d.length-1).focus();this.currentIndex=d.length-1}else{this.currentIndex=-1;this.$search_query.focus()}}var e=(this.currentIndex>=0)?d.eq(this.currentIndex):false;if(e.length){if(e.closest(".search_results_section").hasClass("blog")){this.set_search_type("blog")}if(e.closest(".search_results_section").hasClass("tag")){this.set_search_type("tag")}}},set_search_type:function(d){if(this.is_new_search){return}this.search_type=d;if(d=="blog"){this.$search_form.removeClass("is_tag_search").addClass("is_blog_search")}if(d=="tag"){this.$search_form.addClass("is_tag_search").removeClass("is_blog_search")}},do_blog_search:function(){var d=c.trim(this.$search_query.val());document.location="/search/blogs?q="+d},mouseenter_search_type:function(e){var d=c(e.currentTarget);if(d.length&&d.closest(".search_results_section").hasClass("blog")){this.set_search_type("blog")}else{this.set_search_type("tag")}},mouseleave_search_type:function(){this.set_search_type("tag")},change_query:function(d){this.$search_query.val(d);return this},force_submit:function(){this.$("#search_form").trigger("submit")},submit:function(){if(_.isFunction(this.auto_complete.abort)){this.auto_complete.abort()}this.popover.hide();this.$search_query.blur()}});b.SearchPopover=a})(jQuery,Tumblr);
(function(c,a){var b=Backbone.View.extend({events:{keyup:"keyup"},initialize:function(d){this.options=d||{};this.endpoint=this.options.endpoint||"/svc/search_popover/";this.threshold=this.options.threshold||1;this.cache_size=this.options.cache_size||15;this.init_value=this.$el.val();this.base_blog_search_url=this.options.base_blog_search_url||"/search/blogs?q=";this.blog_search_label=this.options.blog_search_label||'More blogs with "%1$s"';this.form_key=c("#tumblr_form_key").attr("content");this.cache={};this.queries=[];this.popover=this.options.popover;this.search_loading_template=c("#search_loading_template").html();this.search_results_template=c("#search_results_template").html();this.search_results_item_blogs_template=c("#search_results_item_blogs").html();this.search_results_item_tags_template=c("#search_results_item_tags").html();this.$search_query=c("#search_query");this.$search_results_container=c("#search_results_container");this.$tracked_tags=c(".tracked_tags.search_results_section");this.tracked_tags_markup=c("<div>").append(this.$tracked_tags.clone()).html()},keyup:_.throttle(function(d){this.lookup()},100),prepare_search_data:function(){this.queries.push(this.search_query);return{q:this.search_query_raw,form_key:this.form_key}},get_results:function(d){d=d||function(){};if(this.cache[this.search_query]){this.results=this.cache[this.search_query];d.call(this);return}this.search_in_progress=true;this.results={tags:[],blogs:[]};this.store_xhr=c.ajax({url:this.endpoint,data:this.prepare_search_data(),dataType:"json",type:"GET"});this.store_xhr.done(_.bind(function(e){this.results=e;this.add_to_cache(this.search_query,e)},this));this.store_xhr.fail(_.bind(function(f,e){if(e==="abort"){this.force_hide=true}},this));this.store_xhr.always(_.bind(function(e){this.search_in_progress=false;d.call(this)},this))},lookup:function(){var e=c.trim(this.$el.val());if(e[0]=="#"){e=e.substr(1)}var f=e.length;var d;if(f>=this.threshold&&e.length){this.search_query=_.escape(e);this.search_query_raw=e;this.force_hide=false;this.get_results(_.bind(function(){this.update()},this))}else{this.reset_popover()}this.init=false;this.init_value=""},show_tracked_tags:function(){if(this.$tracked_tags.children().length>0){this.$tracked_tags.show()}else{this.popover.hide()}},hide_tracked_tags:function(){this.$tracked_tags.hide()},reset_popover:function(){if(this.tracked_tags_markup.length){this.$search_results_container.html(this.tracked_tags_markup)}else{this.popover.hide()}},add_to_cache:function(d,e){this.cache[d]=e;if(_.size(this.cache)>this.cache_size){delete this.cache[this.queries[0]];this.queries.shift()}},should_add_query_to_tags:function(d){var e=_.find(d,function(g){return(g.tag==this.search_query)}.bind(this));if(!e){var f={tag:this.search_query,url:"/tagged/"+this.search_query,is_query:true};d.unshift(f)}return d},inject_search_substring:function(d,f){if(!this.search_query){return}var e=new RegExp(this._escapeRegExp(this.search_query),"gi"),g=this.decorate_search_substring;if(!e){return}_.each(d,function(j,h){if(f=="tag"){d[h].hilite_tag=j.tag.replace(e,g)}if(f=="blog"){d[h].hilite_name=j.name.replace(e,g);d[h].hilite_title=j.title.replace(e,g);d[h].hilite_url=j.url.replace(e,g)}});return d},decorate_search_substring:function(d){return"<u>"+d+"</u>"},_escapeRegExp:function(d){return d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")},update:function(){if(!_.isObject(this.results)){return}var f=_.isArray(this.results.tags)?this.results.tags:[],j=_.isArray(this.results.blogs)?this.results.blogs:[],h="",e=false,d=false,g=_.template(this.search_results_template),i;f=this.should_add_query_to_tags(f);f=this.inject_search_substring(f,"tag");j=this.inject_search_substring(j,"blog");if(_.size(f)){if(f.length>5){f=f.slice(0,5)}i={results:{type:"tag",items:f,query:this.search_query,item_template:this.search_results_item_tags_template,blog_search_url:this.base_blog_search_url,blog_search_label:this.blog_search_label}};h+=g(i)}g=_.template(this.search_results_template);i={results:{type:"blog",items:j,query:this.search_query,item_template:this.search_results_item_blogs_template,blog_search_url:this.base_blog_search_url,blog_search_label:this.blog_search_label}};h+=g(i);if(h.length&&!this.force_hide){this.$search_results_container.html(h);this.popover.show()}else{this.reset_popover()}},abort:function(){if(this.store_xhr){this.store_xhr.abort()}}});a.AutoCompleteSearch=b})(jQuery,Tumblr);
(function(c,b){var a={};a.Base=Backbone.View.extend({el:"body",svc_url:"/svc/log/capture",initialize:function(){this.form_key=c("#tumblr_form_key").attr("content");this.$start_time=new Date().getTime();this.tracking_data={};c(window).on("beforeunload.capture",_.bind(this.send_data,this))},_get_delta:function(){var d=new Date().getTime();return d-this.$start_time},enable_listeners:function(){this.listenTo(Tumblr.Events,"Capture:set",this._set,this);this.listenTo(Tumblr.Events,"Capture:push",this._push,this)},_set:function(e,d,f){if(!(e in this.tracking_data)){this.tracking_data[e]={}}this.tracking_data[e][d]=f},_push:function(e,d,f){f=f||{};if(_.isObject(f)){f.time=this._get_delta()}if(!(e in this.tracking_data)){this.tracking_data[e]={}}if(!(d in this.tracking_data[e])||!_.isArray(this.tracking_data[e][d])){this.tracking_data[e][d]=[]}this.tracking_data[e][d].push(f)},send_data:function(){if(typeof Tumblr.enable_capture_js==="undefined"||Tumblr.enable_capture_js===false){return}if(this.sending_data){return}if(_.size(this.tracking_data)<1){return}this.track_context();var d=c.ajax({url:this.svc_url,type:"POST",data:{log:this.tracking_data},with_form_key:true,async:false});this.sending_data=true},unique_cookie:function(){var d=Tumblr.Cookie.get("capture")||this.form_key;if(d==this.form_key){Tumblr.Cookie.set("capture",this.form_key)}return d},track_context:function(){this.tracking_data.context=this.tracking_data.context||{};this.tracking_data.context.id=this.unique_cookie();this.tracking_data.context.language=(window.navigator.userLanguage||window.navigator.language).toLowerCase();this.tracking_data.context.path=document.location.pathname}});a.Generic=a.Base.extend({initialize:function(){a.Base.prototype.initialize.call(this);this.enable_listeners()},_set_generic_data:function(){this.tracking_data._init=this.$start_time;this.tracking_data._elapsed=this._get_delta()},send_data:function(){if(_.size(this.tracking_data)<1){return}this._set_generic_data();a.Base.prototype.send_data.call(this)}});a.UserActions=a.Base.extend({el:"body",initialize:function(){a.Base.prototype.initialize.call(this);this.tracking_data.context={}},get_post_id:function(f,g){g=g||".post";var e=0,d=f.closest(g);if(d.length){e=d.data("post-id")}return e},track_signup_buttons:function(e){var f=c(e.target),d=f.attr("id").replace("signup_button_","");this.tracking_data.signup_button[d]=1;Tumblr.Eventbug.track({type:"click",target:"signup_buttons",args:[d,this.source_page]})},track_search:function(f){var d=c(f.target);var e=d.serialize();this.tracking_data.search=e;Tumblr.Eventbug.track({type:"submit",target:"search",args:[e,this.source_page]})},track_explore_tag:function(e){var d=c(e.target);this.tracking_data.explore=d.text();Tumblr.Eventbug.track({type:"click",target:"explore_tag",args:[d.text(),this.source_page]})},track_spotlight_blog:function(f){var d=c(f.target),e=d.find(".tumblelog_name").text();this.tracking_data.spotlight=e;Tumblr.Eventbug.track({type:"click",target:"spotlight_blog",args:[e,this.source_page]})},track_small_links:function(f){var e=c(f.target),d=e.attr("href");if(d=="/explore"){this.tracking_data.explore_link=1}if(d=="/spotlight"){this.tracking_data.spotlight_link=1}Tumblr.Eventbug.track({type:"click",target:"small_sidebar_links",args:[d.replace("/",""),this.source_page]})},track_post_tags:function(g){var e=c(g.target),f=this.get_post_id(e),d={post_id:e.text()};this.tracking_data.post_tags.push(d);Tumblr.Eventbug.track({type:"click",target:"post_tags",args:[d,f,this.source_page]})},track_post_info:function(f){var g=c(f.target),d=this.get_post_id(g),e=g.text();this.tracking_data.post_info={post_id:e};Tumblr.Eventbug.track({type:"click",target:"post_info",args:[e,d,this.source_page]})},track_post_controls:function(g){var f=c(g.target),d=this.get_post_id(f),e;if(f.hasClass("reblog_button")){e="reblog"}if(f.hasClass("like_button")){e="like"}if(f.hasClass("reblog_count")||f.closest(".reblog_count").length){e="notes"}this.tracking_data.post_controls[d]=this.tracking_data.post_controls[d]||[];this.tracking_data.post_controls[d][e]=1;Tumblr.Eventbug.track({type:"click",target:"post_controls",args:[e,d,this.source_page]})},track_post_content:function(h){var f=c(h.target),d=f.closest(".post"),g=this.get_post_id(f),i=d.attr("data-type")||"unknown",e=f[0].outerHTML.replace(/[\n\r]/g," ").replace(/\>\s+\/</g,"");this.tracking_data.post_content[g]=this.tracking_data.post_content[g]||{};this.tracking_data.post_content[g].post_type=i;this.tracking_data.post_content[g].clicks=this.tracking_data.post_content[g].clicks||[];this.tracking_data.post_content[g].clicks.push(e);Tumblr.Eventbug.track({type:"click",target:"post_content",args:[g,i,e,this.source_page]})},track_j_k_keys:function(e){var d=e.keyCode;if((d==74||d==75)&&!c("body").hasClass("show_form")){this.tracking_data.keycommands=1;Tumblr.Eventbug.track({type:"scroll",target:"j_k_next_prev",args:[d,this.source_page]})}},track_auto_pager:function(d){this.page_number=this.page_number||1;this.tracking_data.auto_pager=this.page_number;Tumblr.Eventbug.track({type:"scroll",target:"auto_pager",args:[this.page_number,this.source_page]});this.page_number++},track_recommendations:function(h){var f=c(h.target);var e=f.closest(".ht_post").data("id"),g=(f.hasClass("hello_tag"))?"tag":"thumbnail",d=f.attr("href");this.tracking_data.recommendations.push({post_id:e,type:g,url:d});Tumblr.Eventbug.track({type:"click",target:"recommendation",args:[e,g,d,this.source_page]})},track_related_tag:function(e){var d=c(e.target),f=false;if(!d.hasClass(".tag")){d=d.closest(".tag")}f=c.trim(d.text());if(f&&f.length){this.tracking_data.related_tags.push(f);Tumblr.Eventbug.track({type:"click",target:"related_tag",args:[f,this.source_page]})}},track_related_blog:function(f){var d=c(f.target),e=false;if(!d.hasClass(".blog")){d=d.closest(".blog")}e=d.data("tumblelog");if(e&&e.length){this.tracking_data.related_blogs.push(e);Tumblr.Eventbug.track({type:"click",target:"related_blog",args:[e,this.source_page]})}},track_tag_source:function(){if(c("body").hasClass("sassafras")){this.tracking_data.tag_source="sassafras"}else{this.tracking_data.tag_source="default"}}});a.OnboardingDash=a.UserActions.extend({events:{"submit #search_form":"track_search","click .signup_buttons .chrome":"track_signup_buttons","click .tracked_tag .tag":"track_explore_tag","click #tag_editors .blog":"track_spotlight_blog","click .post .tag":"track_post_tags","click .post_info a":"track_post_info","click .post_controls a":"track_post_controls","click .post_content > *":"track_post_content","click #right_column .small_links a":"track_small_links",keydown:"track_j_k_keys"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/logged_out_dashboard";this.tracking_data.signup_button={};this.tracking_data.search="";this.tracking_data.explore="";this.tracking_data.explore_link=0;this.tracking_data.spotlight="";this.tracking_data.spotlight_link=0;this.tracking_data.post_tags=[];this.tracking_data.post_info={};this.tracking_data.post_controls={};this.tracking_data.post_content={};this.tracking_data.keycommands=0;this.tracking_data.auto_pager=0;this.track_auto_pager();if(window.AfterAutoPaginationQueue){window.AfterAutoPaginationQueue.push(this.track_auto_pager.bind(this))}this.source_page="onboarding_dash"}});a.OnboardingTags=a.OnboardingDash.extend({events:_.extend({"click #related_tags .tag":"track_related_tag"},a.OnboardingDash.prototype.events),initialize:function(){a.OnboardingDash.prototype.initialize.call(this);this.svc_url="/svc/log/capture/logged_out_tags";this.tracking_data.related_tags=[];this.track_tag_source();this.source_page="onboarding_tags"}});a.HelloDash=a.UserActions.extend({el:"body",events:{"submit #search_form":"track_search","click .signup_buttons .chrome":"track_signup_buttons","click .ht_post .hello_tag":"track_post_tags","click .ht_post .go":"track_go_lightbox",keydown:"track_j_k_keys"},track_post_tags:function(g){var e=c(g.target),f=this.get_post_id(e,".ht_post"),d={};d[f]=e.text();this.tracking_data.post_tags.push(d);Tumblr.Eventbug.track({type:"click",target:"post_tags",args:[d,f,this.source_page]})},track_go_lightbox:function(f){var e=c(f.target);var d=this.get_post_id(e,".ht_post");this.tracking_data.go_lightbox.push(d);Tumblr.Eventbug.track({type:"click",target:"lightbox_open",args:[d,this.has_zoom_effect(),this.source_page]})},has_zoom_effect:function(){return(c('.ht_post[data-effect="grow"]').length||c(".ht_post").data("grow"))},track_post_zoom_effect:function(){if(this.has_zoom_effect){this.tracking_data.has_zoom=1}},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_dash";this.tracking_data.signup_button={};this.tracking_data.search="";this.tracking_data.post_tags=[];this.tracking_data.go_lightbox=[];this.tracking_data.has_zoom=0;this.track_post_zoom_effect();this.source_page="hello_dash"}});a.HelloLightbox=a.UserActions.extend({events:{"click .post .tag":"track_post_tags","click .post_info a":"track_post_info","click .post_controls a":"track_post_controls","click .post_content > *":"track_post_content","click .recommendations a":"track_recommendations",keydown:"track_j_k_keys"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_lightbox";this.tracking_data.post_tags=[];this.tracking_data.post_info={};this.tracking_data.post_controls={};this.tracking_data.post_content={};this.tracking_data.keycommands=0;this.tracking_data.auto_pager=0;this.tracking_data.recommendations=[];this.track_auto_pager();if(window.AfterAutoPaginationQueue){window.AfterAutoPaginationQueue.push(this.track_auto_pager.bind(this))}this.source_page="hello_lightbox"}});a.Radar=a.UserActions.extend({el:"#tumblr_radar",events:{"click .radar_content a":"track_radar_content","click .radar_controls a":"track_radar_controls","click .radar_footer a":"track_radar_footer"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_radar";this.tracking_data.radar_id={};this.tracking_data.radar_content=[];this.tracking_data.radar_controls={};this.tracking_data.radar_footer=0},send_data:function(){if(!this.tracking_data.radar_id.post_id){return}a.UserActions.prototype.send_data.call(this)},track_radar_id:function(){if(this.tracking_data.radar_id.post_id){return}this.tracking_data.radar_id={tumblelog:this.$el.data("tumblelog"),post_id:this.$el.data("post-id")}},track_follow:function(d){if(d.hasClass("followed")){this.tracking_data.radar_controls.unfollow=1}if(!d.hasClass("followed")){this.tracking_data.radar_controls.follow=1}},track_like:function(d){if(d.hasClass("liked")){this.tracking_data.radar_controls.unlike=1}if(!d.hasClass("liked")){this.tracking_data.radar_controls.like=1}},track_reblog:function(f,e){var d=(e.altKey)?2:1;this.tracking_data.radar_controls.reblog=d},track_radar_content:function(f){var e=c(f.target);e=(e.is("a"))?e:e.closest("a");var d=e.attr("href");this.tracking_data.radar_content.push({clicked:d});this.track_radar_id()},track_radar_controls:function(g){var f=c(g.target);f=(f.is("a"))?f:f.closest("a");var h=(f.hasClass("follow"))?"follow":((f.hasClass("reblog"))?"reblog":"like");if(h=="reblog"){var d=this;var e=function(i){d.track_reblog(c(i.target),i);d.track_radar_id();c("body").off("click.capturejs")};c("body").on("click.capturejs","#create_post > button",e)}else{this["track_"+h](f,g);this.track_radar_id()}},track_radar_footer:function(d){this.tracking_data.radar_footer=1;this.track_radar_id()}});a.WebInStream=a.UserActions.extend({el:".sponsored_post",events:{"click .post_controls .post_control":"track_sponsored_controls","click .post_permalink":"track_sponsored_controls","click .post_avatar a":"track_sponsored_controls","click .post_info .post_info_fence":"track_sponsored_controls","click .post_info .reblog_follow_button":"track_sponsored_controls","click .sponsored_badge a":"track_sponsored_controls","click .post_tags a.post_tag":"track_sponsored_controls","click .post_content a":"track_sponsored_content"},initialize:function(){if(this.initialized){return}a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_web_instream";this.tracking_data.sponsored_id={};this.tracking_data.sponsored_controls={};this.tracking_data.sponsored_content=[];this.tracking_data.sponsored_tags=[];this.control_names={post_avatar_image:"avatar",post_tag:"tag",post_permalink:"permalink",reblog_follow_button:"follow",reblog:"reblog",like:"like",reblog_count:"notes",external:"share_permalink",ring:"sponsored_badge"};this.initialized=true},send_data:function(){if(!this.tracking_data.sponsored_id.post_id){return}a.UserActions.prototype.send_data.call(this)},track_sponsored_id:function(){if(this.tracking_data.sponsored_id.post_id){return}this.tracking_data.sponsored_id={tumblelog:this.$el.data("tumblelog-name"),post_id:this.$el.data("post-id"),placement_id:this.$el.data("placement-id")}},track_follow:function(d){if(d.hasClass("followed")){this.tracking_data.sponsored_controls.unfollow=1}if(!d.hasClass("followed")){this.tracking_data.sponsored_controls.follow=1}},track_like:function(d){if(d.hasClass("liked")){this.tracking_data.sponsored_controls.like=1}if(!d.hasClass("liked")){this.tracking_data.sponsored_controls.unlike=1}},track_reblog:function(e,d){this.tracking_data.sponsored_controls.reblog=(d.altKey)?2:1},track_sponsored_content:function(e){var d=c(e.target);d=(d.is("a"))?d:d.closest("a");this.tracking_data.sponsored_content.push({clicked:d.attr("href")});this.track_sponsored_id()},track_sponsored_controls:function(j){var h=(c(j.target).className)?c(j.target):c(j.currentTarget);var k=null;switch(true){case h.parent().hasClass("source_url"):k="source_url";break;case h.parent().hasClass("post_info"):if(h.hasClass("reblog_follow_button")){k="follow"}else{k="header"}break;case h.parent().is("li.share_email"):k="share_email";break;default:var f=h.attr("class").split(" ");for(var e=0;e<f.length;e++){if(f[e] in this.control_names){k=this.control_names[f[e]]}}break}if(!k){return}if(k=="reblog"){var d=this;var g=function(i){d.track_reblog(c(i.target),i);d.track_sponsored_id();d.send_data();c("body").off("click.capturejs")};c("body").on("click.capturejs","#create_post > button",g)}else{if(this["track_"+k]&&this["track_"+k].call){this["track_"+k](h,j);this.track_sponsored_id()}else{this.tracking_data.sponsored_controls[k]=1;this.track_sponsored_id()}}}});a.PremiumRadar=a.Radar.extend({el:"#tumblr_radar.premium",events:function(){return _.extend({},a.Radar.prototype.events,{"click .sponsored_badge":"track_radar_badge","mouseenter .radar_content a":"track_radar_hover","mouseleave .radar_content a":"track_radar_hover"})},initialize:function(){a.Radar.prototype.initialize.call(this);this.svc_url="/svc/log/capture_premium_radar";_.bindAll(this,"track_radar_loaded");c(window).load(this.track_radar_loaded);this.track_radar_visibility();_.bindAll(this,"track_radar_visibility");c(window).scroll(this.track_radar_visibility)},track_radar_id:function(){if(this.tracking_data.radar_id.post_id){return}this.tracking_data.radar_id={tumblelog:this.$el.data("tumblelog"),post_id:this.$el.data("post-id"),placement_id:this.$el.data("placement-id")}},get_radar_args:function(d){var f=[this.$el.data("tumblelog"),this.$el.data("post-id")];for(var e=0;e<arguments.length;e++){f.push(arguments[e])}return f},track_follow:function(d){a.Radar.prototype.track_follow.call(this,d);var e=(d.hasClass("followed"))?1:0;Tumblr.Eventbug.track({type:"click",target:"premium_radar_follow",args:this.get_radar_args(e)})},track_like:function(e){a.Radar.prototype.track_like.call(this,e);var d=(e.hasClass("liked"))?1:0;Tumblr.Eventbug.track({type:"click",target:"premium_radar_like",args:this.get_radar_args(d)})},track_reblog:function(f,e){a.Radar.prototype.track_reblog.call(this,f,e);var d=(e.altKey)?2:1;Tumblr.Eventbug.track({type:"click",target:"premium_radar_reblog",args:this.get_radar_args(d)})},track_radar_content:function(f){a.Radar.prototype.track_radar_content.call(this,f);var e=c(f.target);e=(e.is("a"))?e:e.closest("a");var d=e.attr("href");Tumblr.Eventbug.track({type:"click",target:"premium_radar_content",args:this.get_radar_args(d)})},track_radar_hover:function(e){var d=(e.type=="mouseenter")?1:0;Tumblr.Eventbug.track({type:"hover",target:"premium_radar_content",args:this.get_radar_args(d)})},track_radar_loaded:function(e){var d=this;this.$el.find(".radar_content a img").each(function(g,f){if(f.complete&&!f.hidden){Tumblr.Eventbug.track({type:"view",target:"premium_radar",args:d.get_radar_args()})}})},track_radar_visibility:function(e){if(this.$el.length>0){var d=this.elInView(this.$el[0])?1:0;var f=this.is_radar_visible!=d;this.is_radar_visible=d;if(f){Tumblr.Eventbug.track({type:"scroll",target:"premium_radar",args:this.get_radar_args(d)})}}},elInView:function(f){var h=f.offsetTop;var g=f.offsetLeft;var e=f.offsetWidth;var d=f.offsetHeight;while(f.offsetParent){f=f.offsetParent;h+=f.offsetTop;g+=f.offsetLeft}return(h<(window.pageYOffset+window.innerHeight)&&g<(window.pageXOffset+window.innerWidth)&&(h+d)>window.pageYOffset&&(g+e)>window.pageXOffset)},track_radar_footer:function(d){a.Radar.prototype.track_radar_footer.call(this,d);Tumblr.Eventbug.track({type:"click",target:"premium_radar_footer",args:this.get_radar_args()})},track_radar_badge:function(d){this.tracking_data.radar_badge=1;this.track_radar_id();Tumblr.Eventbug.track({type:"click",target:"premium_radar_badge",args:this.get_radar_args()})}});a.SearchPopover=a.UserActions.extend({el:"#header",events:{"mousedown .tracked_tags .result_link":"track_tracked_tag_click","mousedown .tag .result_title":"track_tag_click","mousedown .blog .result_link":"track_blog_click","mousedown .blog .more_results_link":"track_blog_click","keydown #popover_search":"keyup"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_search";this.$search_field=this.$el.find("#search_query");this.$search_popover=this.$el.find("#popover_search");this.tracking_data.query=0;this.tracking_data.tag=0;this.tracking_data.blog=0;this.tracking_data.search_tag=0;this.tracking_data.search_blog=0;this.tracking_data.tracked_tag=0},send_data:function(){if(this.tracking_data.tracked_tag===0&&this.tracking_data.query===0){return}a.UserActions.prototype.send_data.call(this)},get_query_name:function(){return c.trim(this.$search_field.val())},get_tag_name:function(d){return c.trim(d.text()).replace("#","")},get_tumblelog_name:function(d){return(d)?d.attr("data-tumblelog-name"):""},track_query:function(d){this.tracking_data.query=((this.get_query_name().length)?1:0)},track_tag:function(d){if(d.closest(".result.is_query").length){this.tracking_data.search_tag++;Tumblr.Eventbug.track({type:"click",target:"search_popover_search_tag",args:[this.get_query_name()]})}else{this.tracking_data.tag++;Tumblr.Eventbug.track({type:"click",target:"search_popover_popular_tag",args:[this.get_query_name(),this.get_tag_name(d)]})}this.track_query()},track_blog:function(d){if(d.hasClass("more_results_link")){this.tracking_data.search_blog++;Tumblr.Eventbug.track({type:"click",target:"search_popover_search_blog",args:[this.get_query_name()]})}else{this.tracking_data.blog++;Tumblr.Eventbug.track({type:"click",target:"search_popover_popular_blog",args:[this.get_query_name(),this.get_tumblelog_name(d)]})}this.track_query()},track_tag_click:function(e){var d=c(e.currentTarget);this.track_tag(d)},track_tracked_tag_click:function(e){var d=c(e.currentTarget);this.track_tracked_tag(d)},track_tracked_tag:function(d){this.tracking_data.tracked_tag++;this.track_query();Tumblr.Eventbug.track({type:"click",target:"search_popover_tracked_tag",args:[this.get_query_name(),this.get_tag_name(d)]})},track_blog_click:function(e){var d=c(e.currentTarget);this.track_blog(d)},track_submit:function(d){this.track_query();Tumblr.Eventbug.track({type:"click",target:"search_popover_submit",args:[this.get_query_name()]})},keyup:function(e){if(e.keyCode==13){var d=c(document.activeElement);if(d.closest(".tag").length){this.track_tag(d)}if(d.closest(".tracked_tags").length){this.track_tracked_tag(d)}if(d.closest(".blog").length){this.track_blog(d)}}}});a.CrushClick=a.UserActions.extend({el:"#crushes",events:{"mousedown .crush":"track_crush_click"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_crush";this.tracking_data.crush_clicks=[]},track_crush_click:function(e){var d=c(e.currentTarget);this.tracking_data.crush_clicks.push({click_time:Math.round(Date.now()/1000),tumblelog_name:d.data("tumblelog-name"),position:d.attr("id").split("_")[1],love:d.data("love")})}});b.Capture=a;c(function(d){Tumblr.CaptureGeneric=new Tumblr.Capture.Generic()})})(jQuery,Tumblr);
(function(c,a){var b=Backbone.View.extend({initialize:function(d){this.div=document.createElement("div");this.isScrollEnabled=false;this.rings=c();this.transform=(this.check_support("transform")||this.check_support("webkitTransform")||this.check_support("MozTransform")||this.check_support("msTransform")||this.check_support("OTransform"));if(!this.transform){return}Tumblr.AutoPaginator.on("after",c.proxy(this.on_autopaginator_after,this));this.check_for_rings()},check_support:function(d){if(d in this.div.style){return d}return false},check_for_rings:function(){this.rings=this.rings.add(".sponsored_badge_icon .ring");if(!this.isScrollEnabled&&this.rings.length>0){this.isScrollEnabled=true;Tumblr.Events.on("DOMEventor:flatscroll",this.on_window_scroll,this)}},on_autopaginator_after:function(){this.check_for_rings()},on_window_scroll:function(g){var d=g.windowScrollTop;for(var f=0,e=this.rings.length;f<e;f++){this.rings[f].style[this.transform]="rotate("+d+"deg)"}}});c(function(){a.SponsoredPosts=new b()})})(jQuery,Tumblr);
(function(f){function e(a,i){if({}.hasOwnProperty.call(e.cache,a)){return e.cache[a]}var h=e.resolve(a);if(!h){throw new Error("Failed to resolve module "+a)}var j={id:a,require:e,filename:a,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(j);var g=a.slice(0,a.lastIndexOf("/")+1);return e.cache[a]=j.exports,h.call(j.exports,j,j.exports,g,a),j.loaded=!0,e.cache[a]=j.exports}e.modules={},e.cache={},e.resolve=function(a){return{}.hasOwnProperty.call(e.modules,a)?e.modules[a]:void 0},e.define=function(a,g){e.modules[a]=g};var d=function(b){return b="/",{title:"browser",version:"v0.10.5",browser:!0,env:{},argv:[],nextTick:f.setImmediate||function(c){setTimeout(c,0)},cwd:function(){return b},chdir:function(a){b=a}}}();e.define("/gif.coffee",function(t,a,l,m){function s(g,c){return{}.hasOwnProperty.call(g,c)}function o(i,g){for(var h=0,j=g.length;h<j;++h){if(h in g&&g[h]===i){return !0}}return !1}function n(g,c){function h(){this.constructor=g}for(var i in c){s(c,i)&&(g[i]=c[i])}return h.prototype=c.prototype,g.prototype=new h,g.__super__=c.prototype,g}var q,r,p;r=e("events",t).EventEmitter,q=e("/browser.coffee",t),p=function(h,c,i){function g(j){var b,k;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(j);for(b in c){k=c[b],null!=this.options[b]?this.options[b]:this.options[b]=k}}return n(g,h),c={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null},i={delay:500,copy:!1},g.prototype.setOption=function(k,j){return this.options[k]=j,null!=this._canvas&&(k==="width"||k==="height")?this._canvas[k]=j:void 0},g.prototype.setOptions=function(b){return function(u){var j,k;for(j in b){if(!s(b,j)){continue}k=b[j],u.push(this.setOption(j,k))}return u}.call(this,[])},g.prototype.addFrame=function(j,v){var k,u;null==v&&(v={}),k={};for(u in i){k[u]=v[u]||i[u]}if("undefined"!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&j instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&j instanceof WebGLRenderingContext){v.copy?k.data=this.getContextData(j):k.context=j}else{if(null!=j.childNodes){null!=this.options.width||this.setOption("width",j.width),null!=this.options.height||this.setOption("height",j.height),v.copy?k.data=this.getImageData(j):k.image=j}else{throw new Error("Invalid image")}}return this.frames.push(k),null!=k.width&&this.setOption("width",k.width),null!=k.height?this.setOption("height",k.height):void 0},g.prototype.render=function(){var u,k;if(this.running){throw new Error("Already running")}this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(w){var y;for(var x=0,z=function(){var A,A;A=[];for(var B=0;0<=this.frames.length?B<this.frames.length:B>this.frames.length;0<=this.frames.length?++B:--B){A.push(B)}return A}.apply(this,arguments).length;x<z;++x){y=function(){var A,A;A=[];for(var B=0;0<=this.frames.length?B<this.frames.length:B>this.frames.length;0<=this.frames.length?++B:--B){A.push(B)}return A}.apply(this,arguments)[x],w.push(null)}return w}.call(this,[]),k=this.spawnWorkers();for(var j=0,v=function(){var x,x;x=[];for(var w=0;0<=k?w<k:w>k;0<=k?++w:--w){x.push(w)}return x}.apply(this,arguments).length;j<v;++j){u=function(){var x,x;x=[];for(var w=0;0<=k?w<k:w>k;0<=k?++w:--w){x.push(w)}return x}.apply(this,arguments)[j],this.renderNextFrame()}return this.emit("start"),this.emit("progress",0)},g.prototype.abort=function(){var b;while(!0){if(b=this.activeWorkers.shift(),!(null!=b)){break}console.log("killing active worker"),b.terminate()}return this.running=!1,this.emit("abort")},g.prototype.spawnWorkers=function(){var u,k,j;k=Math.min(this.options.workers,this.frames.length);for(var w=0,v=function(){var y,y;y=[];for(var x=this.freeWorkers.length;this.freeWorkers.length<=k?x<k:x>k;this.freeWorkers.length<=k?++x:--x){y.push(x)}return y}.apply(this,arguments).length;w<v;++w){u=function(){var y,y;y=[];for(var x=this.freeWorkers.length;this.freeWorkers.length<=k?x<k:x>k;this.freeWorkers.length<=k?++x:--x){y.push(x)}return y}.apply(this,arguments)[w],(j=this,function(x){var b,y;return console.log("spawning worker "+x),y=new Worker(j.options.workerScript),b=j,y.onmessage=function(z){return b.activeWorkers.splice(b.activeWorkers.indexOf(y),1),b.freeWorkers.push(y),b.frameFinished(z.data)},j.freeWorkers.push(y)})()}return k},g.prototype.frameFinished=function(b){return console.log("frame "+b.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[b.index]=b,o(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},g.prototype.finishRendering=function(){var C,G,w,u,F,D,z;F=0;for(var B=0,x=this.imageParts.length;B<x;++B){G=this.imageParts[B],F+=(G.data.length-1)*G.pageSize+G.cursor}F+=G.pageSize-G.cursor,console.log("rendering finished - filesize "+Math.round(F/1000)+"kb"),C=new Uint8Array(F),D=0;for(var A=0,v=this.imageParts.length;A<v;++A){G=this.imageParts[A];for(var E=0,y=G.data.length;E<y;++E){z=G.data[E],w=E,C.set(z,D),w===G.data.length-1?D+=G.cursor:D+=G.pageSize}}return u=new Blob([C],{type:"image/gif"}),this.emit("finished",u,C)},g.prototype.renderNextFrame=function(){var u,k,j;if(this.freeWorkers.length===0){throw new Error("No free workers")}return this.nextFrame>=this.frames.length?void 0:(u=this.frames[this.nextFrame++],j=this.freeWorkers.shift(),k=this.getTask(u),console.log("starting frame "+(k.index+1)+" of "+this.frames.length),this.activeWorkers.push(j),j.postMessage(k))},g.prototype.getContextData=function(b){return b.getImageData(0,0,this.options.width,this.options.height).data},g.prototype.getImageData=function(j){var k;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),k=this._canvas.getContext("2d"),k.setFill=this.options.background,k.fillRect(0,0,this.options.width,this.options.height),k.drawImage(j,0,0),this.getContextData(k)},g.prototype.getTask=function(k){var u,j;if(u=this.frames.indexOf(k),j={index:u,last:u===this.frames.length-1,delay:k.delay,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:q.name==="chrome"},null!=k.data){j.data=k.data}else{if(null!=k.context){j.data=this.getContextData(k.context)}else{if(null!=k.image){j.data=this.getImageData(k.image)}else{throw new Error("Invalid frame")}}}return j},g}(r),t.exports=p}),e.define("/browser.coffee",function(m,l,k,j){var r,o,n,p,q;p=navigator.userAgent.toLowerCase(),n=navigator.platform.toLowerCase(),q=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],o=q[1]==="ie"&&document.documentMode,r={name:q[1]==="version"?q[3]:q[1],version:o||parseFloat(q[1]==="opera"&&q[4]?q[4]:q[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||n.match(/mac|win|linux/)||["other"])[0]}},r[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,m.exports=r}),e.define("events",function(k,l,j,i){d.EventEmitter||(d.EventEmitter=function(){});var b=l.EventEmitter=d.EventEmitter,n=typeof Array.isArray==="function"?Array.isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"},m=10;b.prototype.setMaxListeners=function(c){this._events||(this._events={}),this._events.maxListeners=c},b.prototype.emit=function(p){if(p==="error"&&(!(this._events&&this._events.error)||n(this._events.error)&&!this._events.error.length)){throw arguments[1] instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.")}if(!this._events){return !1}var h=this._events[p];if(!h){return !1}if(!(typeof h=="function")){if(n(h)){var c=Array.prototype.slice.call(arguments,1),q=h.slice();for(var r=0,o=q.length;r<o;r++){q[r].apply(this,c)}return !0}else{return !1}}switch(arguments.length){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);h.apply(this,c)}return !0},b.prototype.addListener=function(g,c){if("function"!==typeof c){throw new Error("addListener only takes instances of Function")}if(this._events||(this._events={}),this.emit("newListener",g,c),!this._events[g]){this._events[g]=c}else{if(n(this._events[g])){if(!this._events[g].warned){var h;this._events.maxListeners!==undefined?h=this._events.maxListeners:h=m,h&&h>0&&this._events[g].length>h&&(this._events[g].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[g].length),console.trace())}this._events[g].push(c)}else{this._events[g]=[this._events[g],c]}}return this},b.prototype.on=b.prototype.addListener,b.prototype.once=function(g,p){var h=this;return h.on(g,function o(){h.removeListener(g,o),p.apply(this,arguments)}),this},b.prototype.removeListener=function(g,o){if("function"!==typeof o){throw new Error("removeListener only takes instances of Function")}if(!(this._events&&this._events[g])){return this}var c=this._events[g];if(n(c)){var h=c.indexOf(o);if(h<0){return this}c.splice(h,1),c.length==0&&delete this._events[g]}else{this._events[g]===o&&delete this._events[g]}return this},b.prototype.removeAllListeners=function(c){return c&&this._events&&this._events[c]&&(this._events[c]=null),this},b.prototype.listeners=function(c){return this._events||(this._events={}),this._events[c]||(this._events[c]=[]),n(this._events[c])||(this._events[c]=[this._events[c]]),this._events[c]}}),f.GIF=e("/gif.coffee")}.call(this,this));
(function(c,a){var b=function(){var g=(function(){var j={click:["explore_tag","lightbox_open","post_content","post_controls","post_info","post_tags","premium_radar_badge","premium_radar_content","premium_radar_follow","premium_radar_footer","premium_radar_like","premium_radar_reblog","recommendation","related_blog","related_tag","search_popover_popular_blog","search_popover_popular_tag","search_popover_search_blog","search_popover_search_tag","search_popover_submit","search_popover_tracked_tag","signup_buttons","small_sidebar_links","spotlight_blog"],hover:["premium_radar_content"],keyboard:[],navigate:[],scroll:["auto_pager","j_k_next_prev","premium_radar"],submit:["search"],view:["premium_radar"],error:["window_onerror","exception"]};function i(k){var o={};for(var l in k){o[l]={};for(var m=0;m<k[l].length;m++){var n=k[l][m];if(typeof ENVIRONMENT!=="undefined"&&ENVIRONMENT=="development"){if(typeof o[l][n]!=="undefined"){console.error("Event "+l+"."+n+" is duplicated!")}}o[l][n]=true}}return o}return i(j)})();var h="www.tumblr.com/evixu";var d=[];var e=0;function f(){for(var k=0;k<d.length;k++){var l=c.param(d[k]);var j=new Image(1,1);j.src=document.location.protocol+"//"+h+"?"+l}d.length=0}setInterval(f,5000);c(window).on("beforeunload",f);return{track:function(i){setTimeout(function(){if(typeof Tumblr.enable_eventbug==="undefined"||Tumblr.enable_eventbug===false){return}if(typeof g[i.type]==="undefined"||typeof g[i.type][i.target]==="undefined"){throw"Event "+i.type+"."+i.target+" is not a valid event type!"}var k={ev:i.type,tg:i.target,v:i.version||"default",seq:e+=1,ts:Math.floor(new Date().getTime()/1000),url:encodeURIComponent(document.location.href)};if(i.args instanceof Array){for(var j=0;j<i.args.length;j++){k["a"+j]=i.args[j]}}d.push(k);f()},0)}}};a.Eventbug=a.Eventbug||b()})(jQuery,Tumblr);
/*!
 * hoverIntent r7 // 2013.03.11 // jQuery 1.9.1+
 * http://cherne.net/brian/resources/jquery.hoverIntent.html
 *
 * You may use hoverIntent under the terms of the MIT license. Basically that
 * means you are free to use hoverIntent as long as this header is left intact.
 * Copyright 2007, 2013 Brian Cherne
 */
(function(a){a.fn.hoverIntent=function(m,d,h){var j={interval:100,sensitivity:7,timeout:0};if(typeof m==="object"){j=a.extend(j,m)}else{if(a.isFunction(d)){j=a.extend(j,{over:m,out:d,selector:h})}else{j=a.extend(j,{over:m,out:m,selector:d})}}var l,k,g,f;var e=function(n){l=n.pageX;k=n.pageY};var c=function(o,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);if((Math.abs(g-l)+Math.abs(f-k))<j.sensitivity){a(n).off("mousemove.hoverIntent",e);n.hoverIntent_s=1;return j.over.apply(n,[o])}else{g=l;f=k;n.hoverIntent_t=setTimeout(function(){c(o,n)},j.interval)}};var i=function(o,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);n.hoverIntent_s=0;return j.out.apply(n,[o])};var b=function(p){var o=jQuery.extend({},p);var n=this;if(n.hoverIntent_t){n.hoverIntent_t=clearTimeout(n.hoverIntent_t)}if(p.type=="mouseenter"){g=o.pageX;f=o.pageY;a(n).on("mousemove.hoverIntent",e);if(n.hoverIntent_s!=1){n.hoverIntent_t=setTimeout(function(){c(o,n)},j.interval)}}else{a(n).off("mousemove.hoverIntent",e);if(n.hoverIntent_s==1){n.hoverIntent_t=setTimeout(function(){i(o,n)},j.timeout)}}};return this.on({"mouseenter.hoverIntent":b,"mouseleave.hoverIntent":b},j.selector)}})(jQuery);
(function(m,f,l,d){var e="name";var g=new l.Collection();var i=/^[a-z0-9-_]{2,}$/i;var j=d.Features("is_admin");function h(v,s,w){var u=f.Deferred();var p={data:{tumblelog:v.get("name")}};if(s.source){p.data.source=s.source}var r=function(){if(!w.wait){v.set({following:s.following})}};var q=function(x,y){if(!w.wait){v.set({following:!s.following})}u.reject(y)};var t=function(){if(w.wait){v.set({following:s.following})}u.resolve()};var o=(s.following?"/svc/follow":"/svc/unfollow");f.ajax({beforeSend:r,cache:!w.force,data:p,error:q,type:"POST",success:t,url:o,with_form_key:true});return u.promise()}function c(t,q){var o=f.Deferred();var r={is_tumblelog_popover:q.is_tumblelog_popover};var p=function(u,v){o.reject(v)};var s=function(u){t.set({highlighted_posts:u});o.resolve()};f.ajax({cache:!q.force,data:r,error:p,type:"GET",success:s,url:"/svc/highlighted_posts/"+t.get("name"),with_form_key:true});return o.promise()}var b=l.Model.extend({save_following:function(p,o){o||(o={});p||(p={});p.following=!!p.following;var q=this;if(!o.force&&q.get("following")===p.following){return f.when(q.get("following"))}else{return h(q,p,o).then(m.bindKey(q,"save_following",p))}},fetch_highlighted_posts:function(o){o||(o={});o.is_tumblelog_popover=!!o.is_tumblelog_popover||false;var p=this;if(!o.force&&p.has("highlighted_posts")){return f.when(p.get("highlighted_posts"))}else{return c(p,o).then(m.bindKey(p,"fetch_highlighted_posts",undefined))}},save_spam:j(function a(){return function(p,o){}},function n(){return function(){return f.Deferred().reject()}}),save_nsfw:j(function k(){return function(){}},function n(){return function(){return f.Deferred().reject()}}),defaults:{},idAttribute:e,constructor:function(o,q){var r=o&&o[e];if(!(typeof r==="number"||typeof r==="string")||!(r=r+"")||!(i.test(r))){throw'Invalid Tumblelog "'+e+'".'}var p=g.get(r);if(p){if(m.keys(o).length>1){p.set(o,q)}return p}else{g.add((p=this));p.constructor.__super__.constructor.apply(p,arguments)}},initialize:function(){},parse:function(o){return o},validate:function(){return false},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},m.extend({instances:function(){return g.slice()},collection:g},l.Events));(d.Models||(d.Models={})).Tumblelog=b})(_,jQuery,Backbone,this.Tumblr||(this.Tumblr={}));
(function(b,d,e,a){if(!a.Models||!a.Models.Tumblelog){throw"Tumblr.Models.Tumblelog is missing."}var c=e.Collection.extend({url:"/svc/top/blogs",model:a.Models.Tumblelog,initialize:function(){},parse:function(f){return(f&&b.isArray(f.blogs))?f.blogs:[]}});(a.Collections||(a.Collections={})).TopContentBlogs=c})(_,jQuery,Backbone,this.Tumblr||(this.Tumblr={}));
(function(g,d){var c=500;var a="badkey";var i;var o;var k;var j=[];function f(){g.ajax({type:"POST",url:"/svc/secure_form_key",withoutFormKeyTransport:true,with_form_key:true,beforeSend:function(){i=true},complete:function(p){i=false;k=p.getResponseHeader("X-tumblr-secure-form-key");h()}})}function m(){g.each(j,function(p,q){q.complete(c,a,{},"")});j.length=0}function h(){if(i===true||!j.length){return}if(i===void 0){return f()}e()}function e(){var p=j[0];var q=p.originalOptions;q.beforeSend&&(q.beforeSend=null);q.complete&&(q.complete=null);q.error&&(q.error=null);q.success&&(q.success=null);q.headers||(q.headers={});q.headers["X-tumblr-puppies"]=k;q.withoutFormKeyTransport=true;i=true;p.ajax=g.ajax(q).always(function(r){r.getResponseHeader||(r=arguments[2]);if(r.readyState===0||r.readyState===1){}else{k=r.getResponseHeader("X-tumblr-kittens")}var s={};r.responseJSON&&(s.json=r.responseJSON);r.responseText&&(s.text=r.responseText);r.responseXML&&(s.xml=r.responseXML);p.complete(r.status,r.statusText,s,r.getAllResponseHeaders());j.splice(g.inArray(j,p),1);i=false;h()})}function b(){var p=/^\/svc\/post\/update/;g.ajaxTransport("+*",function(q,u,t){if(q.type!=="POST"||!p.test(q.url)){return}if(q.withoutFormKeyTransport){return}var r;var s={options:q,originalOptions:u,jqXHR:t,ajax:null,complete:null};j.push(s);return{send:function(w,v){s.complete=v;if(u.beforeSend){r=setTimeout(h,0)}else{h()}},abort:function(){r&&clearTimeout(r);s.ajax&&s.ajax.abort()}}})}function n(){o||(o=g("#tumblr_form_key").attr("content"));g.ajaxPrefilter(function(p,q){if(q.with_form_key){p.data=g.param(g.extend({},q.data,{form_key:o}))}})}var l=(function(){var p;return d.Features("secure_form_key")(function r(){return function(){p||(p=true,n(),b())}},function q(){return function(){p||(p=true,n())}})})();(d.Lib||(d.Lib={})).AJAXWithFormKey=l})(jQuery,this.Tumblr||(this.Tumblr={}));
(function(c,b){var a=Backbone.View.extend({el:".binary_switcher",className:"binary_switch",defaults:{additionalClassNames:""},initialize:function(d){this.options=d||{};this.options=_.extend(this.defaults,this.options||{})},render:function(){_.each(this.$el.not("[data-binary-switch-init]"),_.bind(function(e){var d=c(e);d.attr("data-binary-switch-init",true);d.wrap(c("<label>").addClass(this.className).addClass(this.options.additionalClassNames));d.after(c("<span>",{"class":this.className+"_button"}));d.after(c("<span>",{"class":this.className+"_track"}))},this));return this}});b.BinarySwitch=a})(jQuery,Tumblr);
(function(e,b,a){var d={};var c=function(i){var h=e(i),j={left:0,right:0,top:0,bottom:0};if(h.length){j=h.offset();j.right=j.left+h.width();j.bottom=j.top+h.height()}return j};var g=Backbone.View.extend({events:{"click .follow":"on_follow_click","click .unfollow":"on_follow_click","click .tumblelog_menu_btn":"on_menu_click","click .ask":"on_ask_click","click .fan_mail":"on_fan_mail_click","click .ignore":"on_ignore_click","click .toggle_spam":"on_spam_click","click .toggle_nsfw":"on_nsfw_click"},initialize:function(h){this.options=h||{};this.template=b.template(this.options.template||e("#tumblelog_popover_info").html());this.on_close=this.options.on_close||e.noop;this.on_menu_toggle=this.options.on_menu_toggle||e.noop;this.min_load_time=this.options.min_load_time||500;this.current_data=this.options.current_data||null;this.hide_posts_on_unfollow=(this.options.hide_posts_on_unfollow!==false)?true:false;this.is_mobile=!!("ontouchstart" in document.documentElement);this.is_disabled=false;this.is_menu_open=false;this.xhr=null;this.$recent_posts=this.$el.find(".recent_posts");this.$menu=this.$el.find(".tumblelog_menu");this.model=new a.Models.Tumblelog({name:this.options.tumblelog});this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"change:highlighted_posts",this.on_posts_change);if(this.current_data&&!b.isEmpty(this.current_data)){var j=this.model.toJSON();for(var i in j){this.current_data[i]=j[i]}this.model.set(this.current_data,{silent:true});this.render();if(this.current_data.highlighted_posts&&b.isArray(this.current_data.highlighted_posts)){this.render_posts(true)}else{this.model.fetch_highlighted_posts({is_tumblelog_popover:true})}}else{this.fetch_popover_data()}},render:function(){this.$el.find(".tumblelog_info").html(this.template(this.model.toJSON()));this.update_cache();return this},render_posts:function(q){var k=this.model.toJSON();if(!b.isArray(k.highlighted_posts)){return}var r=k.highlighted_posts,p=r.join(""),o=e(p).find("img"),n=0;if(r.length<2){setTimeout(e.proxy(function(){this.$el.addClass("is_empty");this.$recent_posts.html("")},this),this.min_load_time);return}this.$recent_posts.addClass("has_"+r.length+"_posts");if(q){this.$recent_posts.addClass("is_cached").html(p);return}if(o.length<1){setTimeout(e.proxy(function(){this.$recent_posts.addClass("is_loaded").html(p)},this),this.min_load_time);return}for(var m=0,h=o.length;m<h;m++){var j=new Image();e(j).load(e.proxy(function(){n++;if(n===o.length){setTimeout(e.proxy(function(){this.$recent_posts.addClass("is_loaded").html(p)},this),this.min_load_time);e(j).unbind()}},this));j.src=o[m].src}},close:function(h){h=h||true;if(h){this.on_close()}if(this.xhr){this.xhr.abort();this.xhr=null}e(document).off(".tumblelog_popover_menu");this.$el.off();this.remove()},fetch_popover_data:function(){var k=this.model;var h=e.Deferred();var i=function(l,m){h.reject(m)};var j=function(l){k.set(l);h.resolve()};e.ajax({cache:true,error:i,type:"GET",success:j,url:"/svc/tumblelog_popover/"+k.get("name"),with_form_key:true})},update_cache:function(){var h=this.model.toJSON(),i=this.model.get("name");d[i]={timestamp:new Date().getTime(),data:JSON.stringify(h)}},open_dialog:function(h,i){i=i||e.noop;this.is_disabled=true;h.fail(e.proxy(function(){this.is_disabled=this.is_menu_open},this));h.done(e.proxy(function(){this.is_disabled=this.is_menu_open;i()},this))},hide_posts:function(){a.Posts.whereBy({tumblelog:this.model.get("name"),sponsored:false}).invoke("dismiss");this.close()},show_menu:function(){this.is_menu_open=true;this.is_disabled=true;this.$el.addClass("admin_menu_open")},hide_menu:function(){this.is_menu_open=false;this.is_disabled=false;this.$el.removeClass("admin_menu_open")},on_posts_change:function(h){this.update_cache();this.render_posts()},on_follow_click:function(h){h.preventDefault();h.stopPropagation();if(e(h.currentTarget).hasClass("unfollow")){var i=a.TumblelogActions.confirm_unfollow({tumblelog:this.model.get("name"),avatar_url:this.model.get("avatar_url")||""});this.open_dialog(i,e.proxy(function(){this.model.save_following({following:false,source:"FOLLOW_SOURCE_TUMBLELOG_POPOVER"});if(this.hide_posts_on_unfollow){this.hide_posts()}},this))}else{this.model.save_following({following:true,source:"FOLLOW_SOURCE_TUMBLELOG_POPOVER"})}},on_menu_click:function(h){h.preventDefault();if(!this.is_menu_open){this.show_menu();e(document).on("mouseup.tumblelog_popover_menu",e.proxy(this.on_menu_mouseup,this))}},on_menu_mouseup:function(j){var h=c(this.$el.find(".tumblelog_menu_popover"));var k=!(h.left<=j.pageX&&j.pageX<=h.right),i=!(h.top<=j.pageY&&j.pageY<=h.bottom);if(k||i){e(document).off(".tumblelog_popover_menu");this.hide_menu()}},on_ask_click:function(h){this.close()},on_fan_mail_click:function(i){if(b.isObject(a.FanMail)){var h={href:a.FanMail.make_url_from_tumblelog(this.model.get("name"))};i.preventDefault();a.FanMail.show(h);this.close()}},on_ignore_click:function(h){h.preventDefault();var i=a.TumblelogActions.confirm_ignore({tumblelog:this.model.get("name"),avatar_url:this.model.get("avatar_url")||""});this.open_dialog(i,e.proxy(function(){a.ignore({tumblelog:this.model.get("name")},{success:e.proxy(function(){this.model.set("ignoring",true);this.hide_posts()},this)})},this))},on_spam_click:function(h){h.preventDefault();e.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.model.get("name")},with_form_key:true,success:e.proxy(function(i){this.model.set("spam",(i.spammer)?true:false)},this)})},on_nsfw_click:function(h){h.preventDefault();e.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.model.get("name")},with_form_key:true,success:e.proxy(function(i){this.model.set("nsfw",i.nsfw)},this)})}});var f=Backbone.View.extend({el:"body",initialize:function(k){this.options=k||{};this.popover_template=e.trim(this.options.template||e("#tumblelog_popover_template").html());this.cache_timeout=this.options.cache_timeout||3600000;this.hide_posts_on_unfollow=(this.options.hide_posts_on_unfollow!==false)?true:false;this.$popover=null;this.popover=null;this.popover_info=null;this.current_target=null;this.current_data=null;this.current_tumblelog="";this.hide_timeout=null;this.queued_event=null;this.hover_bounds={};this.is_open=false;this.is_mobile=!!("ontouchstart" in document.documentElement);var m=e("body");var h=e(this.options.selector||this.el);if(this.is_mobile){var n=h.find("a[data-tumblelog-popover]");n.addClass("no_pop");n.on("touchend",e.proxy(this.on_touch_open,this))}else{var i=String(window.location.host).replace(/^(https?:\/\/)?(www\.)?/,""),j="a[data-tumblelog-popover], a[href^='http://www.'], a[href^='https://www.'], .popover a, .link_text a, .photo_info a, .notification_target, .no_popover";h.hoverIntent({selector:"a[data-tumblelog-popover], a[href*='."+i+"']:not("+j+")",over:e.proxy(this.on_mouseover,this),out:e.noop})}if(window.sessionStorage){try{this.sync_storage()}catch(l){}}},sync_storage:function(){var k=sessionStorage.getItem("tumblelog_popover");if(k){var j=e.parseJSON(k),h=new Date().getTime();for(var i in j){if(h-j[i].timestamp>this.cache_timeout||!b.has(j[i],"data")){delete j[i]}}d=j}e(window).on("beforeunload",e.proxy(function(){var p=b.size(d),l=50;if(p>l){var o=0;for(var m in d){o++;if(o<=p-l){delete d[m]}}}try{sessionStorage.setItem("tumblelog_popover",JSON.stringify(d))}catch(n){}},this))},show:function(){var h=e(this.current_target),i=(d)?d[this.current_tumblelog]:null;if(i&&i.data){var j=b.isObject(i.data)?i.data:e.parseJSON(i.data);if(b.size(j)>1){this.current_data=b.isObject(i.data)?i.data:e.parseJSON(i.data)}}this.$popover=e(b.template(this.popover_template,this.current_data||{}));this.$popover.appendTo(this.$el).hide();this.popover=new a.Popover({button:h,popover:this.$popover,skip_glass:true}).show();this.popover_info=new g({el:this.$popover,tumblelog:this.current_tumblelog,current_data:this.current_data,on_close:e.proxy(this.animate_out,this),hide_posts_on_unfollow:this.hide_posts_on_unfollow});this.position();this.animate_in();this.is_open=true;this.bind_events()},hide:function(){if(this.$popover){this.$popover.off();this.$popover.remove();this.$popover=null}if(this.popover){this.popover.hide();this.popover=null}if(this.popover_info){this.popover_info.close(false);this.popover_info=null}this.current_data={};this.current_tumblelog="";this.is_open=false;if(this.queued_event){this.on_mouseover(this.queued_event);this.queued_event=null}},animate_in:function(){if(this.hide_timeout){clearTimeout(this.hide_timeout);this.hide_timeout=null}if(this.$popover){this.$popover.removeClass("is_closed").addClass("is_open")}},animate_out:function(){if(this.hide_timeout){clearTimeout(this.hide_timeout);this.hide_timeout=null}if(this.$popover){this.$popover.removeClass("is_open").addClass("is_closed")}this.unbind_events();this.hide_timeout=setTimeout(e.proxy(this.hide,this),300)},position:function(){if(!this.$popover||!this.current_target){return}this.$popover.show();var m=e(window),j=e(this.current_target),l=this.$popover.outerHeight();var i={top:m.scrollTop(),left:m.scrollLeft()};i.right=i.left+m.width();i.bottom=i.top+m.height();this.$popover.removeClass("down nipple_on_top left");this.$popover.addClass("up nipple_on_bottom");this.$popover.css({left:j.offset().left+(j.width()*0.5),top:j.offset().top-l});var k=c(this.$popover),h=c(j);if(k.top<i.top+20){this.$popover.removeClass("up nipple_on_bottom");this.$popover.addClass("down nipple_on_top");this.$popover.css("top",h.bottom);k=c(this.$popover)}if(k.right>i.right-20){this.$popover.addClass("left");k=c(this.$popover)}this.hover_bounds.left=Math.min(k.left,h.left);this.hover_bounds.top=Math.min(k.top,h.top);this.hover_bounds.right=Math.max(k.right,h.right);this.hover_bounds.bottom=Math.max(k.bottom,h.bottom)},bind_events:function(){if(this.is_mobile){e(document).on("touchstart.tumblelog_popover",e.proxy(this.on_touch_close,this))}else{e(document).on("mousemove.tumblelog_popover",b.throttle(e.proxy(this.on_mousemove,this),50))}},unbind_events:function(){e(document).off(".tumblelog_popover")},on_mouseover:function(n){var h=e(n.currentTarget);var m=!!(h.attr("data-tumblelog-popover")),o=!!(h.text().replace(/\s+/g," ").length>1);if(!m&&!o){return}if(this.is_open){if(this.current_target!==n.currentTarget){this.queued_event=n;this.animate_out()}return}if(m){this.current_data=e.parseJSON(h.attr("data-tumblelog-popover"));this.current_tumblelog=this.current_data.name.toString()}else{if(o){var i=h.attr("href").replace(/.*?:\/\//g,"");var l=i.split("/");if(l.length>1&&l[1].length&&l[1]!=="post"){return}var k=h.attr("href").match(/([^\/\.]+\/\/)([^\/\.]+)(\..*)/i);var j=k&&k[2];if(j){this.current_tumblelog=j.toLowerCase()}}}if(this.current_tumblelog){this.current_target=n.currentTarget;this.show()}},on_mousemove:function(i){if((this.popover_info&&this.popover_info.is_disabled)||!this.hover_bounds||b.isEmpty(this.hover_bounds)){return}var j=!(this.hover_bounds.left<=i.pageX&&i.pageX<=this.hover_bounds.right),h=!(this.hover_bounds.top<=i.pageY&&i.pageY<=this.hover_bounds.bottom);if(j||h){this.animate_out()}},on_touch_open:function(h){h.preventDefault();h.stopPropagation();(this.is_open)?this.animate_out():this.on_mouseover(h)},on_touch_close:function(h){this.on_mousemove(h.originalEvent)}});a.TumblelogPopover=f})(jQuery,_,Tumblr);
(function(c,b,a){var e=Backbone.Model.extend({modified:{},get_modified:function(){var f=this.get("tumblelog");return this.modified[f]},highlighted_posts:function(){var f=c.ajax({url:"/svc/highlighted_posts/"+this.get("tumblelog"),type:"GET",timeout:10000,data:{form_key:this.get("form_key"),is_tumblelog_popover:true},success:c.proxy(function(g){this.trigger("highlighted_posts:success",g)},this),error:c.proxy(function(){this.trigger("highlighted_posts:failure")},this)});return f},follow:function(){var f=this.get("tumblelog");this.modified[f]=this.modified[f]||{};a.follow({tumblelog:f,source:"FOLLOW_SOURCE_TUMBLELOG_POPOVER"},{success:c.proxy(function(){this.modified[f]["is_following"]=true;this.trigger("follow:success",this)},this),error:c.proxy(function(){this.trigger("follow:failure",this)},this)})},unfollow:function(){var f=this.get("tumblelog");this.modified[f]=this.modified[f]||{};a.unfollow({tumblelog:f,source:"UNFOLLOW_SOURCE_TUMBLELOG_POPOVER"},{success:c.proxy(function(){this.modified[f]["is_following"]=false;this.trigger("unfollow:success",this)},this),error:c.proxy(function(){this.trigger("unfollow:failure",this)},this)})},fan_mail:function(){if(b.isObject(a.FanMail)){var f={href:a.FanMail.make_url_from_tumblelog(this.get("tumblelog"))};a.FanMail.show(f)}},ignore:function(){a.ignore({tumblelog:this.get("tumblelog"),source:"IGNORE_SOURCE_TUMBLELOG_POPOVER"},{success:c.proxy(function(){this.trigger("ignore:success",this)},this),error:c.proxy(function(){this.trigger("ignore:failure",this)},this)})},toggle_spam:function(){var g=this.get("tumblelog");this.modified[g]=this.modified[g]||{};var f=c.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:g,form_key:this.get("form_key")}});f.fail(this.trigger.bind(this,"spam_toggle:failure"));f.done(c.proxy(function(h){this.modified[g]["is_spam"]=h.spammer;this.trigger("spam_toggle:success")},this));return f},toggle_nsfw:function(){var g=this.get("tumblelog");this.modified[g]=this.modified[g]||{};var f=c.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:g,form_key:this.get("form_key")}});f.fail(this.trigger.bind(this,"nsfw_toggle:failure"));f.done(c.proxy(function(h){this.modified[g]["is_nsfw"]=h.nsfw;this.trigger("nsfw_toggle:success")},this));return f}});var d=Backbone.View.extend({el:"body",events:{"click .tumblelog_popover_v1 .follow":"on_follow_click","click .tumblelog_popover_v1 .unfollow":"on_follow_click","click .tumblelog_popover_v1 .tumblelog_menu_btn":"on_menu_click","click .tumblelog_popover_v1 .ask":"on_ask_click","click .tumblelog_popover_v1 .fan_mail":"on_fan_mail_click","click .tumblelog_popover_v1 .ignore":"on_ignore_click","click .tumblelog_popover_v1 .toggle_spam":"on_spam_click","click .tumblelog_popover_v1 .toggle_nsfw":"on_nsfw_click"},initialize:function(f){this.options=f||{};this.template=c.trim(this.options.template||c("#tumblelog_popover_template_v1").html());this.cache_timeout=this.options.cache_timeout||3600000;this.min_load_time=this.options.min_load_time||500;this.$popover_content=null;this.popover_data=null;this.popover=null;this.show_timeout=null;this.hide_timeout=null;this.is_open=false;this.current_target=null;this.xhr=null;this.cache={};this.is_mobile=!!("ontouchstart" in document.documentElement);this.is_disabled=false;this.model=new e({form_key:c("meta[name=tumblr-form-key]").attr("content")});this.model.on("follow:success",c.proxy(this.on_follow_success,this));this.model.on("unfollow:success",c.proxy(this.on_unfollow_success,this));this.model.on("ignore:success",c.proxy(this.on_ignore_success,this));this.model.on("spam_toggle:success",c.proxy(this.on_spam_success,this));this.model.on("nsfw_toggle:success",c.proxy(this.on_nsfw_success,this));this.model.on("highlighted_posts:success",c.proxy(this.on_posts_success,this));this.model.on("highlighted_posts:failure",c.proxy(this.on_posts_error,this));if(this.is_mobile){this.$el.off("click").on("touchstart","a[data-tumblelog-popover]",c.proxy(this.on_touch_start));this.$el.off("click").on("touchend","a[data-tumblelog-popover]",c.proxy(this.on_touch_open,this));this.$el.on("touchend",".tumblelog_popover_glass",c.proxy(this.on_touch_close,this))}else{this.$el.on("mouseover",".tumblelog_popover_v1, a[data-tumblelog-popover]",c.proxy(this.on_tumblelog_mouseover,this));this.$el.on("mouseout",".tumblelog_popover_v1, a[data-tumblelog-popover]",c.proxy(this.on_tumblelog_mouseout,this));this.$el.on("click",".tumblelog_popover_glass",c.proxy(this.on_menu_glass_click,this))}if(window.sessionStorage){try{this.initStorage()}catch(g){}}},initStorage:function(){var i=sessionStorage.getItem("tumblelog_popover");if(i){var h=c.parseJSON(i),f=new Date().getTime();for(var g in h){if(f-h[g].timestamp>this.cache_timeout||!b.has(h[g],"data")){delete h[g]}}this.cache=h}c(window).on("beforeunload",c.proxy(function(){var n=b.size(this.cache),j=50;if(n>j){var m=0;for(var k in this.cache){m++;if(m<=n-j){delete this.cache[k]}}}try{sessionStorage.setItem("tumblelog_popover",JSON.stringify(this.cache))}catch(l){}},this))},show:function(f){if(this.is_open){return}var n=c(f),h=c.parseJSON(n.attr("data-tumblelog-popover")),k=n.offset().top,g=(k-c(window).scrollTop()>300),i,m;this.model.set("tumblelog",h.name);m=this.model.get_modified();if(m!==undefined){var j=b.clone(h);for(var l in m){j[l]=m[l]}if(!b.isEqual(j,h)){h=j;n.attr("data-tumblelog-popover",JSON.stringify(h))}}i=b.template(this.template,h);this.$popover_content=c(i).hide();this.$popover_content.addClass((g)?"nipple_on_bottom":"nipple_on_top");this.popover_data=h;c("body").append(this.$popover_content);if(this.is_mobile){this.$popover_content.addClass("is_mobile")}this.popover=new a.Popover({button:n,popover:this.$popover_content,skip_glass:true,direction:(g)?"up":"down",left:n.offset().left+(n.width()*0.5),top:(g)?k:(k+n.height()),bottom:c(window).height()-k}).show();setTimeout(c.proxy(function(){this.$popover_content.addClass("is_open")},this),100);this.position();this.current_target=f;this.load_posts();this.is_open=true},position:function(){var f=this.$popover_content,i=f.offset().left,h=i+f.width(),g;if(h>c(window).width()-30){f.css({right:c(window).width()-f.offset().left,left:"auto"}).addClass("left")}},hide:function(){if(this.xhr){this.xhr.abort();this.xhr=null}if(this.$popover_content){this.$popover_content.remove();this.$popover_content=null}if(this.popover){this.popover.hide();this.popover=null}this.popover_data=null;this.current_target=null;this.is_open=false;this.is_disabled=false},animate_out:function(){if(this.$popover_content){this.$popover_content.removeClass("is_open")}this.hide_timeout=setTimeout(c.proxy(this.hide,this),250)},load_posts:function(){var g=this.$popover_content.find(".recent_posts"),f=new Date().getTime(),j=this.model.get("tumblelog");if(this.cache[j]&&(f-this.cache[j].timestamp)<this.cache_timeout){var i=this.cache[j].data;if(b.isArray(i.highlighted_posts)){var h=i.highlighted_posts.join("");g.addClass("is_cached").addClass("has_"+c(h).filter(".post").length+"_posts");g.html(h);if(h.length===0){this.$popover_content.addClass("is_empty")}return}}this.xhr=this.model.highlighted_posts()},load_post_images:function(f,n,o){var p=c(f),m=c(n).find("img"),k=0;if(m.length<1){setTimeout(function(){p.addClass("is_loaded").html(n)},this.min_load_time);return}for(var j=0,g=m.length;j<g;j++){var h=new Image();c(h).load(c.proxy(function(){k++;if(k===m.length){setTimeout(function(){p.addClass("is_loaded").html(n)},this.min_load_time);c(h).unbind()}},this));h.src=m[j].src}},update_follow_status:function(f){var g=this.$popover_content.find(".follow_nav");(f)?g.addClass("is_following"):g.removeClass("is_following")},update_menu_toggle:function(g){var f=".toggle_"+g,h="is_"+g;if(!this.$popover_content){return}this.$popover_content.find(f).toggleClass("is_flagged");this.popover_data[h]=!(this.popover_data[h]==true)+"";c(this.current_target).attr("data-tumblelog-popover",JSON.stringify(this.popover_data))},on_tumblelog_mouseover:function(f){this.is_disabled=false;if(this.hide_timeout){clearTimeout(this.hide_timeout);this.hide_timeout=null}if(this.$popover_content){this.$popover_content.addClass("is_open")}if(!c(f.currentTarget).attr("data-tumblelog-popover")){return}if(f.currentTarget!==this.current_target){this.show_timeout=setTimeout(c.proxy(function(){this.hide();this.show(f.currentTarget)},this),350)}},on_tumblelog_mouseout:function(f){if(this.is_disabled){return}if(this.show_timeout){clearTimeout(this.show_timeout);this.show_timeout=null}this.hide_timeout=setTimeout(c.proxy(function(){this.animate_out()},this),150)},on_posts_success:function(f){var h=this.$popover_content.find(".recent_posts"),i=f.join(""),g=new Date().getTime(),j=this.model.get("tumblelog");if(i.length>0&&c(i).filter(".post").length>1){h.addClass("has_"+c(i).filter(".post").length+"_posts");this.load_post_images(h,i)}else{i="";this.on_posts_error()}this.cache[j]={timestamp:g,data:{highlighted_posts:f}}},on_posts_error:function(){setTimeout(c.proxy(function(){this.$popover_content.addClass("is_empty");this.$popover_content.find(".recent_posts").html("")},this),this.min_load_time)},on_follow_success:function(){c("a.reblog_follow_button[data-tumblelog-name='"+this.model.get("tumblelog")+"']").remove();this.update_follow_status(true)},on_unfollow_success:function(){this.update_follow_status(false);a.Posts.whereBy({tumblelog:this.model.get("tumblelog"),sponsored:false}).invoke("dismiss");this.animate_out()},on_ignore_success:function(){a.Posts.whereBy({tumblelog:this.model.get("tumblelog"),sponsored:false}).invoke("dismiss");this.animate_out()},on_spam_success:function(){this.update_menu_toggle("spam")},on_nsfw_success:function(){this.update_menu_toggle("nsfw")},on_touch_start:function(f){f.preventDefault();f.stopPropagation()},on_touch_open:function(f){f.preventDefault();f.stopPropagation();(this.is_open)?this.hide():this.show(f.currentTarget)},on_touch_close:function(f){f.preventDefault();f.stopPropagation();this.hide()},on_follow_click:function(f){f.preventDefault();f.stopPropagation();if(c(f.currentTarget).hasClass("unfollow")){var g=a.TumblelogActions.confirm_unfollow({tumblelog:this.model.get("tumblelog"),avatar_url:this.popover_data.avatar_url});this.is_disabled=true;g.done(c.proxy(this.model.unfollow,this.model))}else{this.model.follow()}},on_menu_click:function(f){f.preventDefault();this.$popover_content.find(".tumblelog_menu").toggleClass("open");if(!this.is_mobile){this.$popover_content.toggleClass("admin_menu_open")}},on_menu_glass_click:function(f){f.preventDefault();this.$popover_content.removeClass("admin_menu_open");this.$popover_content.find(".tumblelog_menu").removeClass("open")},on_ask_click:function(f){this.hide()},on_fan_mail_click:function(f){f.preventDefault();this.hide();this.model.fan_mail()},on_ignore_click:function(f){f.preventDefault();var g=a.TumblelogActions.confirm_ignore({tumblelog:this.model.get("tumblelog"),avatar_url:this.popover_data.avatar_url});this.is_disabled=true;g.done(c.proxy(this.model.ignore,this.model))},on_spam_click:function(f){f.preventDefault();this.model.toggle_spam()},on_nsfw_click:function(f){f.preventDefault();this.model.toggle_nsfw()}});a.TumblelogPopoverV1=d})(jQuery,_,Tumblr);jQuery(function(){Tumblr.Features("tumblelog_popover_v1")(function(){new Tumblr.TumblelogPopoverV1()},function(){})});
